<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RS OMNIVERSE | TRADING TERMINAL</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Kanit:wght@200;300;400;500;600&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Kanit', 'sans-serif'],
                        mono: ['Orbitron', 'monospace'],
                        tech: ['Rajdhani', 'sans-serif']
                    },
                    colors: { 
                        neonCyan: '#00F0FF', 
                        neonPurple: '#BC13FE',
                        neonGreen: '#00FF9F',
                        neonRed: '#FF0055',
                        darkBg: '#050505',
                        glass: 'rgba(10, 15, 30, 0.75)',
                        glassBorder: 'rgba(0, 240, 255, 0.2)'
                    },
                    backgroundImage: {
                        'grid-pattern': "linear-gradient(to right, #111 1px, transparent 1px), linear-gradient(to bottom, #111 1px, transparent 1px)",
                    },
                    animation: {
                        'spin-slow': 'spin 10s linear infinite',
                        'pulse-glow': 'pulseGlow 2s infinite',
                        'scan': 'scan 3s linear infinite'
                    },
                    keyframes: {
                        pulseGlow: { '0%, 100%': { boxShadow: '0 0 10px #00F0FF' }, '50%': { boxShadow: '0 0 25px #00F0FF, 0 0 50px #00F0FF' } },
                        scan: { '0%': { backgroundPosition: '0% 0%' }, '100%': { backgroundPosition: '0% 100%' } }
                    }
                }
            }
        }
    </script>

    <style>
        /* üåå GLOBAL UNIVERSE STYLES */
        body { 
            background-color: #020204; 
            color: #E0E0E0; 
            height: 100vh; 
            overflow: hidden; 
            /* Cyber Grid Background */
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(0, 240, 255, 0.05) 0%, transparent 60%),
                linear-gradient(rgba(0, 255, 159, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 159, 0.03) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
        }

        /* üíé Holographic Glass Panels */
        .holo-card {
            background: rgba(8, 10, 16, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 240, 255, 0.15);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5), inset 0 0 20px rgba(0, 240, 255, 0.02);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }
        .holo-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--neonCyan), transparent);
            opacity: 0.5;
        }

        /* üîò Quantum Buttons */
        .btn-quantum {
            position: relative;
            background: linear-gradient(180deg, rgba(0,240,255,0.1), rgba(0,240,255,0.05));
            border: 1px solid rgba(0,240,255,0.3);
            color: #00F0FF;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            overflow: hidden;
            transition: all 0.3s;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .btn-quantum:hover {
            background: rgba(0,240,255,0.2);
            box-shadow: 0 0 20px rgba(0,240,255,0.4);
            text-shadow: 0 0 8px rgba(0,240,255,0.8);
            border-color: #00F0FF;
        }
        .btn-quantum:active { transform: scale(0.98); }

        /* üîã Tier Selector */
        .tier-card {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.1);
            transition: 0.3s;
            cursor: pointer;
        }
        .tier-card.active {
            border-color: var(--neonGreen);
            background: rgba(0, 255, 159, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 159, 0.2);
        }
        .tier-card.active .price { color: var(--neonGreen); }

        /* üìü Inputs */
        .input-cyber {
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            font-family: 'Orbitron', sans-serif;
            transition: 0.3s;
        }
        .input-cyber:focus {
            border-color: var(--neonCyan);
            box-shadow: 0 0 10px rgba(0,240,255,0.2);
            outline: none;
        }

        /* üñ±Ô∏è Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--neonCyan); }

        /* Animation Classes */
        .scan-laser {
            position: absolute; width: 100%; height: 2px; background: var(--neonCyan);
            box-shadow: 0 0 15px var(--neonCyan);
            animation: scanDown 1.5s infinite ease-in-out;
        }
        @keyframes scanDown { 0%{top:0;opacity:0} 50%{opacity:1} 100%{top:100%;opacity:0} }

        .hidden-vis { display: none !important; }
    </style>
</head>
<body class="flex flex-col antialiased">

    <div id="loader" class="fixed inset-0 z-[9999] bg-darkBg flex flex-col items-center justify-center transition-all duration-700">
        <div class="relative w-40 h-40">
            <div class="absolute inset-0 border-4 border-gray-800 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-neonCyan rounded-full border-t-transparent animate-spin"></div>
            <div class="absolute inset-4 border-4 border-neonPurple rounded-full border-b-transparent animate-spin" style="animation-duration: 3s; animation-direction: reverse;"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i class="fas fa-fingerprint text-4xl text-white animate-pulse"></i>
            </div>
        </div>
        <h2 class="mt-8 text-2xl font-mono font-bold text-white tracking-[0.5em] animate-pulse">INITIALIZING</h2>
        <p class="text-neonCyan text-[10px] uppercase mt-2">Connecting to Global Neural Network...</p>
    </div>

    <div id="authPage" class="hidden fixed inset-0 z-[5000] bg-darkBg flex flex-col justify-center items-center p-6">
        <div class="w-full max-w-sm holo-card p-8 text-center relative">
            <div class="absolute -top-10 -left-10 w-32 h-32 bg-neonCyan/20 rounded-full blur-3xl"></div>
            
            <h1 class="text-4xl font-mono font-black italic text-white mb-2 relative z-10">RS <span class="text-neonCyan">OMNI</span></h1>
            <p class="text-gray-400 text-xs font-tech tracking-[0.3em] mb-10 relative z-10">ELITE TRADING TERMINAL</p>
            
            <div id="loginForm" class="space-y-4 relative z-10">
                <input id="lEmail" type="email" class="input-cyber w-full p-4 rounded-lg text-sm" placeholder="ACCESS ID (EMAIL)">
                <input id="lPass" type="password" class="input-cyber w-full p-4 rounded-lg text-sm" placeholder="SECURITY KEY">
                <button onclick="app.login()" class="btn-quantum w-full py-4 mt-2 text-sm">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <div class="mt-6 border-t border-white/10 pt-4">
                    <button onclick="ui.toggleAuth(false)" class="text-neonGreen text-xs hover:underline">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà (Start Balance 0)</button>
                </div>
            </div>

            <div id="regForm" class="hidden space-y-4 relative z-10">
                <input id="rName" class="input-cyber w-full p-4 rounded-lg text-sm" placeholder="CODENAME (‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô)">
                <input id="rPhone" type="tel" class="input-cyber w-full p-4 rounded-lg text-sm" placeholder="LINKED PHONE NO.">
                <input id="rEmail" type="email" class="input-cyber w-full p-4 rounded-lg text-sm" placeholder="EMAIL">
                <input id="rPass" type="password" class="input-cyber w-full p-4 rounded-lg text-sm" placeholder="PASSWORD">
                <button onclick="app.register()" class="btn-quantum w-full py-4 mt-2 text-sm text-neonGreen border-neonGreen">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                <button onclick="ui.toggleAuth(true)" class="text-gray-500 text-xs mt-4 hover:text-white">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>
    </div>

    <div id="mainPage" class="hidden flex-1 flex flex-col h-screen overflow-hidden bg-darkBg">
        
        <header class="h-16 px-6 flex justify-between items-center bg-darkBg/90 backdrop-blur border-b border-white/5 z-20">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded bg-gradient-to-br from-neonCyan to-blue-600 flex items-center justify-center shadow-lg shadow-neonCyan/20">
                    <i class="fas fa-layer-group text-black text-lg"></i>
                </div>
                <div>
                    <h2 class="font-mono font-bold text-white text-sm leading-none">TERMINAL</h2>
                    <div class="flex items-center gap-2 mt-1">
                        <div class="w-1.5 h-1.5 rounded-full bg-neonGreen animate-pulse"></div>
                        <p id="navBalance" class="text-[10px] font-mono text-neonCyan">‡∏ø0.00</p>
                    </div>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="ui.openSearch()" class="w-10 h-10 rounded-lg border border-white/10 flex items-center justify-center text-gray-400 hover:text-white hover:border-white/30 transition-all"><i class="fas fa-search"></i></button>
                <button onclick="app.logout()" class="w-10 h-10 rounded-lg border border-red-900/30 flex items-center justify-center text-red-500 hover:bg-red-900/20 transition-all"><i class="fas fa-power-off"></i></button>
            </div>
        </header>

        <div class="flex-1 relative overflow-hidden">
            
            <div id="tradingview-widget-container" class="absolute inset-0 z-0"></div>

            <div id="controls-layer" class="absolute inset-x-0 bottom-0 z-10 pointer-events-none flex flex-col justify-end">
                
                <div class="px-4 mb-4 pointer-events-auto">
                    <div class="holo-card p-4 flex justify-between items-center animate-pulse-glow">
                        <div class="flex items-center gap-4">
                            <div class="text-left">
                                <p class="text-[10px] text-gray-400 font-tech uppercase">Active Asset</p>
                                <h1 id="assetName" class="text-2xl font-mono font-bold text-white">BTCUSDT</h1>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] text-gray-400 font-tech uppercase">Live Price</p>
                            <p id="livePrice" class="text-xl font-mono font-bold text-neonGreen">Loading...</p>
                        </div>
                    </div>
                </div>

                <div class="bg-[#080a10]/95 backdrop-blur-xl border-t border-white/10 rounded-t-3xl p-6 pointer-events-auto space-y-6 shadow-[0_-10px_50px_rgba(0,0,0,0.8)]">
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <h3 class="text-[10px] font-bold text-gray-500 font-mono tracking-widest">AI INTELLIGENCE LEVEL</h3>
                            <span id="trialBadge" class="hidden text-[9px] bg-red-500/20 text-red-500 px-2 py-1 rounded font-bold">USED</span>
                        </div>

                        <button onclick="app.setMode('TRIAL', 0)" id="btn-trial" class="w-full p-3 rounded-xl border border-dashed border-gray-600 flex justify-between items-center group hover:border-neonCyan transition-all bg-transparent">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-gift text-neonCyan"></i>
                                <div class="text-left">
                                    <p class="text-sm font-bold text-white font-tech">Free Trial Access</p>
                                    <p class="text-[10px] text-gray-500">1 Time Use / 1 Minute Limit</p>
                                </div>
                            </div>
                            <span class="text-[10px] font-bold bg-white text-black px-2 py-1 rounded">FREE</span>
                        </button>

                        <div class="grid grid-cols-4 gap-2">
                            <div onclick="app.setMode('STD', 10)" id="mode-STD" class="tier-card p-2 rounded-xl text-center active">
                                <p class="text-[9px] text-gray-400 uppercase">Basic</p>
                                <p class="price font-mono font-bold text-white">‡∏ø10</p>
                            </div>
                            <div onclick="app.setMode('PRO', 45)" id="mode-PRO" class="tier-card p-2 rounded-xl text-center">
                                <p class="text-[9px] text-gray-400 uppercase">Pro</p>
                                <p class="price font-mono font-bold text-white">‡∏ø45</p>
                            </div>
                            <div onclick="app.setMode('VIP', 90)" id="mode-VIP" class="tier-card p-2 rounded-xl text-center">
                                <p class="text-[9px] text-gray-400 uppercase">VIP</p>
                                <p class="price font-mono font-bold text-white">‡∏ø90</p>
                            </div>
                            <div onclick="app.setMode('GOD', 200)" id="mode-GOD" class="tier-card p-2 rounded-xl text-center border-neonPurple/30">
                                <p class="text-[9px] text-neonPurple uppercase">GOD</p>
                                <p class="price font-mono font-bold text-neonPurple">‡∏ø200</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <div class="relative w-1/3">
                            <input type="number" id="customDur" class="w-full h-14 bg-black border border-gray-800 rounded-xl text-center text-2xl font-mono font-bold text-white focus:border-neonCyan outline-none" value="5" min="1">
                            <span class="absolute top-1 right-2 text-[8px] text-gray-500 font-bold">MIN</span>
                        </div>
                        <button onclick="app.confirmScan()" class="flex-1 btn-quantum text-lg tracking-widest shadow-lg hover:shadow-neonCyan/50 flex items-center justify-center gap-3">
                            <i class="fas fa-bolt animate-pulse"></i> START AI SCAN
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div id="searchModal" class="hidden fixed inset-0 z-[4000] bg-darkBg/95 backdrop-blur-xl p-6 flex flex-col">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-mono font-bold text-white">MARKET <span class="text-neonCyan">FINDER</span></h2>
            <button onclick="ui.closeSearch()" class="w-10 h-10 rounded-full border border-gray-800 flex items-center justify-center text-gray-400 hover:text-white hover:border-white transition-all"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="relative mb-6">
            <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-neonCyan"></i>
            <input id="searchInput" oninput="ui.searchAsset(this.value)" class="w-full bg-[#111] border border-gray-800 rounded-xl p-4 pl-12 text-white font-mono focus:border-neonCyan outline-none" placeholder="Search Symbol (e.g. SOL, GOLD)...">
        </div>

        <div class="flex gap-2 mb-4 overflow-x-auto no-scrollbar">
            <button onclick="ui.filterCat('ALL')" class="px-4 py-2 rounded-full bg-white/10 text-xs font-bold text-white hover:bg-neonCyan hover:text-black transition-all">ALL</button>
            <button onclick="ui.filterCat('CRYPTO')" class="px-4 py-2 rounded-full bg-white/5 text-xs font-bold text-gray-400 hover:bg-neonCyan hover:text-black transition-all">CRYPTO</button>
            <button onclick="ui.filterCat('FOREX')" class="px-4 py-2 rounded-full bg-white/5 text-xs font-bold text-gray-400 hover:bg-neonCyan hover:text-black transition-all">FOREX</button>
        </div>

        <div id="searchResults" class="flex-1 overflow-y-auto no-scrollbar space-y-2 pb-10">
            </div>
    </div>

    <div id="aiModal" class="hidden fixed inset-0 z-[6000] bg-black/95 backdrop-blur-lg flex flex-col items-center justify-center p-6 text-center">
        
        <div id="scan-ui" class="w-full max-w-xs space-y-8">
            <div class="relative w-56 h-56 mx-auto rounded-full border border-neonCyan/20 bg-black/50 flex items-center justify-center shadow-[0_0_50px_rgba(0,240,255,0.2)]">
                <div class="scan-laser"></div>
                <div class="absolute inset-0 border-t-2 border-neonCyan rounded-full animate-spin"></div>
                <i class="fas fa-brain text-neonCyan text-7xl animate-pulse"></i>
            </div>
            <div>
                <h2 class="text-3xl font-mono font-black text-white italic tracking-tighter">PROCESSING...</h2>
                <p id="aiLogText" class="text-neonCyan text-xs mt-2 font-tech uppercase tracking-widest">Connecting to Neural Nodes...</p>
            </div>
        </div>

        <div id="result-ui" class="hidden w-full max-w-sm space-y-6">
            <div id="resultCard" class="holo-card p-8 transition-all duration-500">
                <div class="flex justify-between items-start mb-6">
                    <div class="text-left">
                        <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">STATUS</p>
                        <div id="statusBadge" class="flex items-center gap-2 mt-1">
                            <span class="w-2 h-2 rounded-full bg-gray-500 animate-pulse"></span>
                            <span class="text-sm font-bold text-white">PENDING</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest">TIME LEFT</p>
                        <p id="countdown" class="text-xl font-mono font-bold text-white">00:00</p>
                    </div>
                </div>

                <h1 id="resType" class="text-8xl font-black italic text-white drop-shadow-2xl mb-2">...</h1>
                <p id="resPair" class="text-sm font-bold text-neonCyan uppercase mb-8 tracking-[0.2em]">BTCUSDT</p>
                
                <div class="grid grid-cols-2 gap-4 border-t border-white/10 pt-6">
                    <div class="text-left">
                        <p class="text-[9px] text-gray-500 font-bold uppercase">ENTRY PRICE</p>
                        <p id="resEntry" class="text-sm font-mono font-bold text-neonCyan">...</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[9px] text-gray-500 font-bold uppercase">MARKET PRICE</p>
                        <p id="resCurrent" class="text-sm font-mono font-bold text-white">...</p>
                    </div>
                </div>

                <div class="mt-6 bg-white/5 p-3 rounded-lg border border-white/5">
                    <p id="aiMessage" class="text-xs italic text-gray-300">"AI is monitoring the market..."</p>
                </div>
            </div>
            
            <button id="finishBtn" onclick="app.finishSession()" class="hidden w-full py-5 rounded-xl bg-neonGreen text-black font-black text-sm uppercase tracking-[0.2em] shadow-[0_0_30px_rgba(0,255,159,0.4)] hover:scale-[1.02] transition-all">
                CLAIM PROFIT <i class="fas fa-check ml-2"></i>
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc, serverTimestamp, setDoc, runTransaction, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // üî•üî•üî• PASTE YOUR FIREBASE CONFIG HERE üî•üî•üî•
        const firebaseConfig = { 
            apiKey: "AIzaSyBNfTBQthLLRbJP9BXZ-UQptFsdU324Mv0", 
            authDomain: "fafada-d9899.firebaseapp.com", 
            projectId: "fafada-d9899", 
            storageBucket: "fafada-d9899.firebasestorage.app", 
            messagingSenderId: "484777586908", 
            appId: "1:484777586908:web:16a8f0367ad15737364419" 
        };
        
        const fb_app = initializeApp(firebaseConfig);
        const auth = getAuth(fb_app);
        const db = getFirestore(fb_app);

        let user=null, userData=null, curAsset='BTCUSDT', curMode='STD', curCost=10, timerInt, chartWidget;
        
        // üåç Massive Asset Database
        const assetDB = [
            {s:'BTCUSDT',n:'Bitcoin',c:'CRYPTO'}, {s:'ETHUSDT',n:'Ethereum',c:'CRYPTO'}, {s:'BNBUSDT',n:'Binance Coin',c:'CRYPTO'},
            {s:'SOLUSDT',n:'Solana',c:'CRYPTO'}, {s:'XRPUSDT',n:'Ripple',c:'CRYPTO'}, {s:'ADAUSDT',n:'Cardano',c:'CRYPTO'},
            {s:'DOGEUSDT',n:'Dogecoin',c:'CRYPTO'}, {s:'SHIBUSDT',n:'Shiba Inu',c:'CRYPTO'}, {s:'DOTUSDT',n:'Polkadot',c:'CRYPTO'},
            {s:'XAUUSD',n:'Gold Spot',c:'FOREX'}, {s:'EURUSD',n:'Euro/USD',c:'FOREX'}, {s:'GBPUSD',n:'GBP/USD',c:'FOREX'},
            {s:'USDJPY',n:'USD/JPY',c:'FOREX'}, {s:'AUDUSD',n:'AUD/USD',c:'FOREX'}, {s:'USDCAD',n:'USD/CAD',c:'FOREX'},
            {s:'SPX500USD',n:'S&P 500',c:'FOREX'}, {s:'NAS100USD',n:'Nasdaq 100',c:'FOREX'}
        ];

        // üß† AI Personality
        const aiQuotes = {
            win: ["‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏ß‡∏¢‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏´‡πá‡∏ô‡πÜ", "‡∏ó‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏¢‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô", "AI ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ 99%", "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢"],
            loss: ["‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏™‡∏π‡∏á‡∏Ñ‡∏£‡∏±‡∏ö", "‡πÉ‡∏à‡πÄ‡∏¢‡πá‡∏ô‡πÜ AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÄ‡∏Å‡∏°", "‡∏ñ‡∏∑‡∏≠‡∏ï‡πà‡∏≠‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏±‡∏ß", "‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ï‡∏Å‡πÉ‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏¢‡∏π‡πà"]
        };

        const sfx = { click: new Audio('https://www.soundjay.com/buttons/sounds/button-16.mp3'), success: new Audio('https://www.soundjay.com/human/sounds/applause-01.mp3'), alert: new Audio('https://www.soundjay.com/buttons/sounds/button-10.mp3'), processing: new Audio('https://www.soundjay.com/communication/sounds/digital-scanning-1.mp3') };

        window.ui = {
            toggleAuth: (login) => { document.getElementById('loginForm').classList.toggle('hidden', !login); document.getElementById('regForm').classList.toggle('hidden', login); },
            hideLoader: () => { document.getElementById('loader').classList.add('opacity-0'); setTimeout(()=>document.getElementById('loader').classList.add('hidden'), 500); },
            
            // Search System
            openSearch: () => { document.getElementById('searchModal').classList.remove('hidden'); ui.renderSearch(assetDB); document.getElementById('searchInput').focus(); },
            closeSearch: () => document.getElementById('searchModal').classList.add('hidden'),
            searchAsset: (val) => {
                const filtered = assetDB.filter(a => a.s.includes(val.toUpperCase()) || a.n.toUpperCase().includes(val.toUpperCase()));
                ui.renderSearch(filtered);
            },
            filterCat: (cat) => {
                const filtered = cat === 'ALL' ? assetDB : assetDB.filter(a => a.c === cat);
                ui.renderSearch(filtered);
            },
            renderSearch: (list) => {
                const el = document.getElementById('searchResults'); el.innerHTML = '';
                list.forEach(a => {
                    const icon = a.c === 'CRYPTO' ? 'fa-brands fa-bitcoin' : 'fa-solid fa-dollar-sign';
                    el.innerHTML += `
                    <div onclick="app.select('${a.s}', '${a.n}')" class="p-4 bg-[#151a25] border border-gray-800 rounded-xl flex justify-between items-center cursor-pointer hover:border-neonCyan hover:bg-[#1a202e] transition-all group">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center group-hover:text-neonCyan transition-colors"><i class="${icon}"></i></div>
                            <div>
                                <p class="font-mono font-bold text-white text-sm">${a.s}</p>
                                <p class="text-[10px] text-gray-500 font-tech">${a.n}</p>
                            </div>
                        </div>
                        <span class="text-[9px] bg-white/5 px-2 py-1 rounded text-gray-400">${a.c}</span>
                    </div>`;
                });
            },

            speak: (txt) => { if('speechSynthesis' in window){ window.speechSynthesis.cancel(); const msg=new SpeechSynthesisUtterance(txt); msg.lang='th-TH'; msg.rate=1.1; window.speechSynthesis.speak(msg); } },
            
            // Restore Session Logic
            restoreSession: () => {
                const saved = localStorage.getItem('rs_omni_session');
                if(!saved) return;
                const data = JSON.parse(saved);
                app.showResultUI(data);
            }
        };

        window.app = {
            login: async () => { const e = document.getElementById('lEmail').value, p = document.getElementById('lPass').value; try { await signInWithEmailAndPassword(auth, e, p); } catch(err){ Swal.fire('Error','Login Failed','error'); } },
            register: async () => {
                const n = document.getElementById('rName').value, ph = document.getElementById('rPhone').value, e = document.getElementById('rEmail').value, p = document.getElementById('rPass').value;
                if(!ph) return Swal.fire('Required','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå','warning');
                try { const res = await createUserWithEmailAndPassword(auth, e, p); await setDoc(doc(db, "users", res.user.uid), { displayName: n, phone: ph, email: e, balance: 0, hasUsedTrial: false, createdAt: serverTimestamp() }); location.reload(); } catch(err){ Swal.fire('Error', err.message, 'error'); }
            },
            logout: () => signOut(auth).then(()=>location.reload()),
            
            select: (s, n) => { 
                curAsset = s; sfx.click.play(); 
                document.getElementById('assetName').innerText = s; 
                app.initChart(s); ui.closeSearch(); 
            },
            
            setMode: (m, p) => {
                curMode = m; curCost = p; sfx.click.play();
                document.querySelectorAll('.tier-card').forEach(b => b.classList.remove('active'));
                
                // Trial Logic
                document.getElementById('btn-trial').classList.remove('border-neonCyan', 'bg-neonCyan/10');
                
                if(m === 'TRIAL') {
                    if(userData.hasUsedTrial) return Swal.fire('Sorry', '‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏ü‡∏£‡∏µ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß', 'error');
                    document.getElementById('btn-trial').classList.add('border-neonCyan', 'bg-neonCyan/10');
                    document.getElementById('customDur').value = 1; 
                    document.getElementById('customDur').disabled = true;
                } else {
                    document.getElementById('mode-'+m).classList.add('active'); 
                    document.getElementById('customDur').disabled = false;
                }
            },

            // üìä TRADINGVIEW WIDGET (FULLSCREEN)
            initChart: (s) => {
                let symbol = s;
                if (s.includes('USD') && !s.includes('USDT')) symbol = `FX:${s}`; // Forex
                else symbol = `BINANCE:${s}`; // Crypto

                if (chartWidget) {
                    chartWidget.remove();
                    chartWidget = null;
                }

                // Create new widget
                new TradingView.widget({
                    "autosize": true,
                    "symbol": symbol,
                    "interval": "15",
                    "timezone": "Asia/Bangkok",
                    "theme": "dark",
                    "style": "1",
                    "locale": "th",
                    "toolbar_bg": "#f1f3f6",
                    "enable_publishing": false,
                    "hide_top_toolbar": true,
                    "hide_side_toolbar": false,
                    "container_id": "tradingview-widget-container",
                    "disabled_features": ["use_localstorage_for_settings"]
                });
                
                app.fetchPrice(s);
            },

            fetchPrice: async (s) => {
                try {
                    // Using Binance Public API for Price (Proxy for simplicity)
                    // For Forex, this is a mock fetch since public Forex APIs are paid/complex.
                    // In real app, use WebSocket.
                    const pair = s.includes('USDT') ? s : 'BTCUSDT'; // Fallback for demo logic
                    const res = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${pair}`);
                    const d = await res.json();
                    let price = parseFloat(d.price);
                    
                    // Random fluctuation simulation for Forex pairs (Demo purposes)
                    if(!s.includes('USDT')) price = 1000 + Math.random() * 50; 

                    document.getElementById('livePrice').innerText = price.toLocaleString(undefined, {minimumFractionDigits:2});
                    return price;
                } catch(e) { return 0; }
            },

            confirmScan: async () => {
                if(localStorage.getItem('rs_omni_session')) return Swal.fire('Busy', 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà', 'warning');
                
                let mins = parseInt(document.getElementById('customDur').value) || 5;
                if(curMode === 'TRIAL') mins = 1;

                if(curMode === 'TRIAL' && userData.hasUsedTrial) return Swal.fire('Error', '‡∏´‡∏°‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡πâ‡∏ß', 'error');
                if(curMode !== 'TRIAL' && userData.balance < curCost) return Swal.fire('Low Balance', '‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏û‡∏≠', 'error');

                const result = await Swal.fire({
                    title: 'AUTHORIZE SCAN?',
                    html: `Target: <b style="color:#00F0FF">${curAsset}</b><br>Mode: <b>${curMode}</b><br>Time: <b>${mins} Min</b>`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'EXECUTE',
                    confirmButtonColor: '#00F0FF',
                    background: '#0B0F17', color: '#fff'
                });

                if(result.isConfirmed) app.startProcess(mins);
            },

            startProcess: async (mins) => {
                sfx.processing.loop = true; sfx.processing.play();
                document.getElementById('aiModal').classList.remove('hidden');
                document.getElementById('scan-ui').classList.remove('hidden');
                document.getElementById('result-ui').classList.add('hidden');

                const logs = ["Connecting to Neural Net...", "Analyzing Volume...", "Calculating RSI Divergence...", "Checking Global Trends..."];
                for (let l of logs) { document.getElementById('aiLogText').innerText = l; await new Promise(r => setTimeout(r, 800)); }

                sfx.processing.pause();

                try {
                    // Transaction
                    if(curMode === 'TRIAL') await updateDoc(doc(db, "users", auth.currentUser.uid), { hasUsedTrial: true });
                    else await runTransaction(db, async (tx) => { 
                        const uRef = doc(db, "users", auth.currentUser.uid); 
                        const s = await tx.get(uRef); 
                        tx.update(uRef, { balance: s.data().balance - curCost }); 
                    });

                    const entryPrice = await app.fetchPrice(curAsset);
                    const type = Math.random() > 0.5 ? 'BUY' : 'SELL';
                    const endTime = Date.now() + (mins * 60 * 1000);
                    
                    const sessionData = { asset: curAsset, type: type, entryPrice: entryPrice, endTime: endTime, duration: mins, attempt: 1 };
                    localStorage.setItem('rs_omni_session', JSON.stringify(sessionData));
                    
                    await addDoc(collection(db, "signals"), { uid: auth.currentUser.uid, name: curAsset, type: type, entry: entryPrice, timestamp: serverTimestamp() });
                    
                    app.showResultUI(sessionData);

                } catch(e) { document.getElementById('aiModal').classList.add('hidden'); Swal.fire('Error', 'Connection Failed', 'error'); }
            },

            showResultUI: (data) => {
                document.getElementById('scan-ui').classList.add('hidden');
                document.getElementById('result-ui').classList.remove('hidden');
                document.getElementById('aiModal').classList.remove('hidden');

                document.getElementById('resType').innerText = data.type;
                document.getElementById('resType').className = `text-8xl font-black italic drop-shadow-2xl mb-2 ${data.type==='BUY'?'text-success':'text-danger'}`;
                document.getElementById('resEntry').innerText = data.entryPrice.toFixed(2);
                document.getElementById('resPair').innerText = data.asset;
                
                document.getElementById('finishBtn').classList.add('hidden');
                ui.speak(`‡πÄ‡∏õ‡∏¥‡∏î ${data.type} ‡∏Ñ‡∏π‡πà ${data.asset} ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞`);

                const card = document.getElementById('resultCard');
                const status = document.getElementById('statusBadge');
                const msg = document.getElementById('aiMessage');

                clearInterval(timerInt);
                timerInt = setInterval(async () => {
                    const diff = Math.floor((data.endTime - Date.now()) / 1000);
                    const currentPrice = await app.fetchPrice(data.asset);
                    document.getElementById('resCurrent').innerText = currentPrice.toFixed(2);

                    // üî• Real-time PnL & Emotion
                    const isWin = (data.type === 'BUY' && currentPrice > data.entryPrice) || (data.type === 'SELL' && currentPrice < data.entryPrice);
                    
                    if(isWin) {
                        card.style.borderColor = '#00FF9F';
                        status.innerHTML = `<span class="w-2 h-2 rounded-full bg-neonGreen animate-pulse"></span> <span class="text-sm font-bold text-neonGreen">WINNING</span>`;
                        msg.innerText = aiQuotes.win[Math.floor(Date.now()/5000) % aiQuotes.win.length];
                    } else {
                        card.style.borderColor = '#FF0055';
                        status.innerHTML = `<span class="w-2 h-2 rounded-full bg-neonRed animate-pulse"></span> <span class="text-sm font-bold text-neonRed">RECOVERING</span>`;
                        msg.innerText = aiQuotes.loss[Math.floor(Date.now()/5000) % aiQuotes.loss.length];
                    }

                    if(diff <= 0) {
                        clearInterval(timerInt);
                        document.getElementById('countdown').innerText = "00:00";
                        app.checkOutcome(data, currentPrice);
                    } else {
                        const m = Math.floor(diff / 60), s = diff % 60;
                        document.getElementById('countdown').innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                    }
                }, 1000);
            },

            // üß† AUTO-RECOVERY LOGIC
            checkOutcome: (data, currentPrice) => {
                const isWin = (data.type === 'BUY' && currentPrice > data.entryPrice) || (data.type === 'SELL' && currentPrice < data.entryPrice);
                
                if (isWin) {
                    // ‚úÖ Win: Allow Exit
                    sfx.success.play();
                    ui.speak("‡∏Å‡∏≥‡πÑ‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ‡∏Å‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢");
                    localStorage.removeItem('rs_omni_session');
                    document.getElementById('finishBtn').classList.remove('hidden');
                    document.getElementById('aiMessage').innerText = "üéâ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ó‡∏≥‡∏Å‡∏≥‡πÑ‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                } else {
                    // ‚ùå Loss: Auto Extend
                    sfx.alert.play();
                    const extraMins = data.duration;
                    data.endTime = Date.now() + (extraMins * 60 * 1000);
                    data.attempt += 1;
                    
                    localStorage.setItem('rs_omni_session', JSON.stringify(data));
                    ui.speak(`‡∏Å‡∏£‡∏≤‡∏ü‡∏ú‡∏¥‡∏î‡∏ó‡∏≤‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å ${extraMins} ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÄ‡∏Å‡∏°‡∏Ñ‡πà‡∏∞`);
                    
                    // Visual feedback for recovery
                    const card = document.getElementById('resultCard');
                    card.classList.add('animate-pulse');
                    setTimeout(() => card.classList.remove('animate-pulse'), 1000);
                    
                    app.showResultUI(data); 
                }
            },

            finishSession: () => {
                document.getElementById('aiModal').classList.add('hidden');
                sfx.click.play();
            }
        };

        // Init Logic
        onAuthStateChanged(auth, u => {
            if(u) {
                user = u;
                document.getElementById('authPage').classList.add('hidden');
                onSnapshot(doc(db, "users", u.uid), s => {
                    if(s.exists()){
                        userData = s.data();
                        document.getElementById('navBalance').innerText = `‡∏ø${userData.balance.toLocaleString()}`;
                        document.getElementById('mainPage').classList.remove('hidden');
                        
                        if(userData.hasUsedTrial) {
                            document.getElementById('btn-trial').classList.add('opacity-50', 'pointer-events-none', 'grayscale');
                            document.getElementById('trialBadge').classList.remove('hidden');
                        }

                        ui.hideLoader(); app.initChart('BTCUSDT'); app.setMode('STD', 10); ui.restoreSession();
                    }
                });
            } else { document.getElementById('authPage').classList.remove('hidden'); ui.hideLoader(); }
        });
        
        // Failsafe Loader
        setTimeout(() => { if(!document.getElementById('loader').classList.contains('hidden')) ui.hideLoader(); }, 5000);
    </script>
</body>
</html>
