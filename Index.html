<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RS TRACKING | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600&family=Prompt:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/th.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Kanit', 'sans-serif'], title: ['Prompt', 'sans-serif'] },
                    colors: { brand: '#0052FF', luxury: '#1E293B', bgSoft: '#F8F9FA' }
                }
            }
        }
    </script>

    <style>
        * { touch-action: manipulation; -webkit-tap-highlight-color: transparent; outline: none !important; }
        body { background-color: #FFFFFF; color: #1E293B; height: 100vh; overflow: hidden; font-family: 'Kanit', sans-serif; }
        .font-title { font-family: 'Prompt', sans-serif; }

        .luxury-card {
            background: #FFFFFF;
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);
            border-radius: 2.5rem;
            border: 1px solid #F1F5F9;
        }

        #map { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; }

        .btn-luxury { transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .btn-luxury:active { transform: scale(0.95); opacity: 0.8; }

        /* Timeline Style */
        .step-dot { width: 12px; height: 12px; border-radius: 50%; background: #E2E8F0; position: relative; z-index: 2; transition: 0.5s; }
        .step-dot.active { background: #0052FF; box-shadow: 0 0 10px rgba(0,82,255,0.5); }
        .step-line { position: absolute; top: 50%; left: 0; width: 100%; height: 2px; background: #F1F5F9; z-index: 1; transform: translateY(-50%); }
        .step-line-active { position: absolute; top: 50%; left: 0; height: 2px; background: #0052FF; z-index: 1; transform: translateY(-50%); transition: 0.5s; width: 0%; }

        .fade-slide { animation: fadeSlide 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
        @keyframes fadeSlide { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .pulse-driver { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(0, 82, 255, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(0, 82, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 82, 255, 0); } }
    </style>
</head>
<body class="flex flex-col">

    <div id="loader" class="fixed inset-0 z-[1000] bg-white flex flex-col items-center justify-center transition-all duration-700">
        <div class="w-20 h-20 bg-luxury rounded-[1.8rem] flex items-center justify-center shadow-2xl animate-pulse mb-6">
            <span class="text-white font-black italic text-xl font-title">RS</span>
        </div>
        <p class="text-slate-400 font-bold tracking-[0.3em] text-[10px] uppercase animate-pulse">Initializing Real-time GPS...</p>
    </div>

    <div id="authPage" class="hidden fixed inset-0 z-[600] bg-white flex flex-col justify-center items-center p-10">
        <div class="w-full max-w-sm text-center fade-slide">
            <h1 class="text-3xl font-black text-luxury italic tracking-tighter uppercase mb-2 font-title">RS <span class="text-brand">TRACKING</span></h1>
            <p class="text-slate-400 text-[10px] font-bold uppercase tracking-[0.2em] mb-12">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
            <form onsubmit="app.login(event)" class="space-y-4">
                <input id="lEmail" type="email" required class="w-full px-7 py-4 bg-bgSoft border-none rounded-2xl font-bold outline-none focus:ring-2 focus:ring-brand/10" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                <input id="lPass" type="password" required class="w-full px-7 py-4 bg-bgSoft border-none rounded-2xl font-bold outline-none focus:ring-2 focus:ring-brand/10" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                <button class="w-full bg-luxury text-white py-5 rounded-2xl font-black uppercase text-xs shadow-2xl mt-6 btn-luxury">Verify Identity</button>
            </form>
        </div>
    </div>

    <div id="mainPage" class="hidden flex-1 flex flex-col overflow-hidden">
        
        <main id="view-tracking" class="flex-1 relative overflow-hidden">
            <div id="map"></div> <div class="absolute top-8 left-0 w-full px-6 z-10 fade-slide">
                <div class="glass-pill h-16 rounded-[1.5rem] flex items-center justify-between px-6 bg-white/90 backdrop-blur-md border border-white">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-luxury rounded-xl flex items-center justify-center text-white text-[10px] font-black italic shadow-lg">RS</div>
                        <div>
                            <h2 class="font-black text-luxury text-sm leading-none font-title uppercase">Order <span id="displayOrderID">#...</span></h2>
                            <p id="displayStatus" class="text-[9px] font-bold text-brand uppercase tracking-widest mt-1.5 animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                        </div>
                    </div>
                    <button onclick="app.logout()" class="text-slate-300 hover:text-danger transition-colors"><i class="fas fa-power-off"></i></button>
                </div>
            </div>

            <div class="absolute bottom-32 left-0 w-full px-6 z-10">
                <div class="luxury-card p-8 bg-white fade-slide">
                    <div class="relative flex justify-between items-center mb-8 px-2">
                        <div class="step-line"></div>
                        <div id="timelineProgress" class="step-line-active"></div>
                        <div class="flex flex-col items-center gap-2"><div id="dot1" class="step-dot active"></div><span class="text-[8px] font-bold uppercase text-slate-400">Order</span></div>
                        <div class="flex flex-col items-center gap-2"><div id="dot2" class="step-dot"></div><span class="text-[8px] font-bold uppercase text-slate-400">Prepare</span></div>
                        <div class="flex flex-col items-center gap-2"><div id="dot3" class="step-dot"></div><span class="text-[8px] font-bold uppercase text-slate-400">Ship</span></div>
                        <div class="flex flex-col items-center gap-2"><div id="dot4" class="step-dot"></div><span class="text-[8px] font-bold uppercase text-slate-400">Done</span></div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 rounded-2xl bg-bgSoft border border-slate-100 flex items-center justify-center overflow-hidden">
                                <img id="driverImg" src="" class="w-full h-full object-cover">
                            </div>
                            <div>
                                <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest leading-none mb-1.5">‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á</p>
                                <h3 id="driverName" class="font-black text-luxury text-base font-title leading-none uppercase">...</h3>
                            </div>
                        </div>
                        <a id="callDriver" href="#" class="w-12 h-12 bg-emerald-50 text-emerald-500 rounded-2xl flex items-center justify-center shadow-sm border border-emerald-100 btn-luxury"><i class="fas fa-phone-alt"></i></a>
                    </div>
                </div>
            </div>
        </main>

        <main id="view-driver" class="hidden flex-1 overflow-y-auto px-8 py-10 space-y-10 no-scrollbar pb-40 fade-slide">
            <div class="space-y-2">
                <h1 class="text-3xl font-black text-luxury italic uppercase font-title leading-none">Driver <span class="text-brand">Panel</span></h1>
                <p class="text-slate-400 text-xs font-bold uppercase tracking-widest">‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á</p>
            </div>

            <div id="driverStatusCard" class="p-8 rounded-[2.5rem] bg-bgSoft border border-slate-100 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div id="statusPulse" class="w-3 h-3 bg-slate-300 rounded-full"></div>
                    <div>
                        <p id="onlineText" class="text-xs font-black text-slate-600 uppercase italic leading-none">Offline</p>
                        <p class="text-[9px] font-bold text-slate-400 uppercase mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏£‡πå‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</p>
                    </div>
                </div>
                <button id="toggleOnline" onclick="driver.toggleOnline()" class="px-6 py-2.5 bg-luxury text-white rounded-full font-black text-[10px] uppercase tracking-widest btn-luxury shadow-xl">Go Online</button>
            </div>

            <div class="space-y-6">
                <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] border-l-2 border-brand pl-4">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</h3>
                <div id="jobList" class="space-y-4">
                    </div>
            </div>
        </main>

        <main id="view-profile" class="hidden flex-1 overflow-y-auto px-8 py-10 space-y-8 no-scrollbar pb-40 fade-slide">
            <div class="bg-bgSoft p-12 rounded-[4rem] text-center border border-slate-50 shadow-inner">
                <div class="w-32 h-32 bg-white rounded-[3rem] mx-auto mb-6 border-4 border-white shadow-2xl flex items-center justify-center overflow-hidden">
                    <img id="pImgMain" src="" class="w-full h-full object-cover">
                </div>
                <h2 id="pName" class="text-2xl font-black text-luxury italic uppercase font-title leading-tight">...</h2>
                <div class="mt-4 flex flex-col items-center">
                    <div class="bg-white px-5 py-2 rounded-xl border border-slate-100 flex items-center gap-4">
                        <span class="text-[9px] font-bold text-slate-400 uppercase">Role</span>
                        <p id="pRole" class="text-[10px] font-black text-brand uppercase tracking-widest">...</p>
                    </div>
                </div>
            </div>
            
            <button onclick="app.logout()" class="w-full bg-rose-50 text-rose-500 py-6 rounded-[2rem] font-black text-xs uppercase tracking-widest border border-rose-100 btn-luxury">Log Out from Secure Hub</button>
        </main>
        
        <nav class="bg-white/90 backdrop-blur-xl fixed bottom-0 w-full px-12 py-5 pb-12 border-t border-slate-50 flex justify-between items-center z-40 rounded-t-[4rem] shadow-[0_-15px_50px_rgba(0,0,0,0.04)]">
            <button onclick="ui.changeView('tracking')" id="n-tracking" class="nav-link active flex flex-col items-center gap-2 transition-all opacity-100">
                <i class="fas fa-location-dot text-xl"></i><span class="text-[9px] font-bold uppercase">Tracking</span>
            </button>
            <button onclick="ui.changeView('driver')" id="n-driver" class="hidden nav-link flex flex-col items-center gap-2 transition-all opacity-30">
                <i class="fas fa-truck-fast text-xl"></i><span class="text-[9px] font-bold uppercase">Driver</span>
            </button>
            <button onclick="ui.changeView('profile')" id="n-profile" class="nav-link flex flex-col items-center gap-2 opacity-30 transition-all">
                <i class="fas fa-circle-user text-xl"></i><span class="text-[9px] font-bold uppercase">Profile</span>
            </button>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, updateDoc, collection, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // üî• FIREBASE CONFIG
        const firebaseConfig = { apiKey: "AIzaSyBNfTBQthLLRbJP9BXZ-UQptFsdU324Mv0", authDomain: "fafada-d9899.firebaseapp.com", projectId: "fafada-d9899", storageBucket: "fafada-d9899.firebasestorage.app", messagingSenderId: "484777586908", appId: "1:484777586908:web:16a8f0367ad15737364419" };
        const app_fb = initializeApp(firebaseConfig);
        const auth = getAuth(app_fb);
        const db = getFirestore(app_fb);

        let user = null, userData = null, map = null, driverMarker = null, watchID = null, activeShipment = null;

        window.ui = {
            changeView: (v) => {
                document.querySelectorAll('main').forEach(m => m.classList.add('hidden'));
                document.getElementById('view-'+v).classList.remove('hidden');
                ['tracking', 'driver', 'profile'].forEach(nav => {
                    const el = document.getElementById('n-'+nav);
                    if(el) { el.classList.toggle('active', nav===v); el.classList.toggle('opacity-100', nav===v); el.classList.toggle('opacity-30', nav!==v); }
                });
            },
            hideLoader: () => { document.getElementById('loader').classList.add('opacity-0'); setTimeout(()=> document.getElementById('loader').classList.add('hidden'), 700); },
            updateTimeline: (status) => {
                const steps = { 'pending': 1, 'preparing': 2, 'shipping': 3, 'delivered': 4 };
                const step = steps[status] || 1;
                document.getElementById('timelineProgress').style.width = `${(step-1) * 33.33}%`;
                for(let i=1; i<=4; i++) document.getElementById('dot'+i).classList.toggle('active', step >= i);
                const statusTexts = { 'pending': '‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß', 'preparing': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'shipping': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏™‡πà‡∏á', 'delivered': '‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß' };
                document.getElementById('displayStatus').innerText = statusTexts[status] || status;
            }
        };

        window.app = {
            logout: ()=>signOut(auth).then(()=>location.reload()),
            login: async (e) => {
                e.preventDefault();
                Swal.showLoading();
                try { await signInWithEmailAndPassword(auth, document.getElementById('lEmail').value.trim(), document.getElementById('lPass').value.trim()); } 
                catch(err) { Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î', 'error'); }
            }
        };

        // üöõ Driver-Specific Functions
        window.driver = {
            isOnline: false,
            toggleOnline: () => {
                driver.isOnline = !driver.isOnline;
                const btn = document.getElementById('toggleOnline');
                const pulse = document.getElementById('statusPulse');
                const txt = document.getElementById('onlineText');
                
                if(driver.isOnline) {
                    btn.innerText = "Go Offline"; btn.classList.replace('bg-luxury', 'bg-rose-500');
                    pulse.classList.replace('bg-slate-300', 'bg-brand'); pulse.classList.add('pulse-driver');
                    txt.innerText = "Online"; txt.classList.replace('text-slate-600', 'text-brand');
                    driver.startTracking();
                } else {
                    btn.innerText = "Go Online"; btn.classList.replace('bg-rose-500', 'bg-luxury');
                    pulse.classList.replace('bg-brand', 'bg-slate-300'); pulse.classList.remove('pulse-driver');
                    txt.innerText = "Offline"; txt.classList.replace('text-brand', 'text-slate-600');
                    driver.stopTracking();
                }
            },
            startTracking: () => {
                if ("geolocation" in navigator) {
                    watchID = navigator.geolocation.watchPosition(async (pos) => {
                        const { latitude, longitude } = pos.coords;
                        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡πÉ‡∏ô DB (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï shipment ‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏≠‡∏¢‡∏π‡πà)
                        const activeJob = allShipments.find(s => s.status === 'shipping');
                        if(activeJob) {
                            await updateDoc(doc(db, "shipments", activeJob.id), { driverLat: latitude, driverLng: longitude });
                        }
                    }, (err) => console.error(err), { enableHighAccuracy: true });
                }
            },
            stopTracking: () => { if(watchID) navigator.geolocation.clearWatch(watchID); },
            updateJob: async (shipID, nextStatus) => {
                Swal.showLoading();
                await updateDoc(doc(db, "shipments", shipID), { status: nextStatus });
                Swal.fire({ icon:'success', title:'Updated Status', toast:true, position:'top', showConfirmButton:false, timer:2000 });
            }
        };

        // üó∫Ô∏è Google Maps Initialization
        window.initMap = () => {
            const defaultPos = { lat: 13.7563, lng: 100.5018 }; // Bangkok
            map = new google.maps.Map(document.getElementById("map"), {
                center: defaultPos, zoom: 15, disableDefaultUI: true,
                styles: [ { "featureType": "all", "elementType": "labels.text.fill", "color": "#1e293b" }, { "featureType": "water", "elementType": "all", "color": "#f0f4f8" } ]
            });
            driverMarker = new google.maps.Marker({ map: map, icon: { url: 'https://cdn-icons-png.flaticon.com/512/2830/2830284.png', scaledSize: new google.maps.Size(40, 40) } });
        };

        let allShipments = [];
        onAuthStateChanged(auth, u => {
            if(u) {
                user = u;
                document.getElementById('authPage').classList.add('hidden');
                
                onSnapshot(doc(db,"users",u.uid), s => {
                    if(s.exists()){
                        userData = s.data();
                        document.getElementById('navName').innerText = userData.displayName || 'Client';
                        document.getElementById('pName').innerText = userData.displayName || 'Client';
                        document.getElementById('pRole').innerText = userData.role || 'Customer';
                        document.getElementById('navAvatar').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${u.uid}`;
                        document.getElementById('pImgMain').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${u.uid}`;
                        
                        // ‡∏õ‡∏£‡∏±‡∏ö UI ‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó
                        if(userData.role === 'driver') {
                            document.getElementById('n-driver').classList.remove('hidden');
                            ui.changeView('driver');
                        }
                        ui.hideLoader();
                    }
                });

                // Listen for shipments
                const q = (userData?.role === 'driver') ? query(collection(db,"shipments"), where("driverID","==",u.uid)) : query(collection(db,"shipments"), where("customerID","==",u.uid));
                onSnapshot(collection(db, "shipments"), s => {
                    allShipments = []; s.forEach(d => { const data = d.data(); data.id = d.id; allShipments.push(data); });
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Driver
                    if(userData?.role === 'driver') {
                        const jl = document.getElementById('jobList'); jl.innerHTML = '';
                        allShipments.forEach(job => {
                            jl.innerHTML += `
                            <div class="luxury-card p-6 flex flex-col gap-4">
                                <div class="flex justify-between">
                                    <span class="text-[10px] font-black text-brand uppercase tracking-tighter">ID: #${job.id.slice(0,6)}</span>
                                    <span class="status-pill status-${job.status}">${job.status}</span>
                                </div>
                                <div class="space-y-1">
                                    <p class="text-[10px] text-slate-400 uppercase font-bold">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
                                    <p class="text-sm font-bold text-luxury">${job.address}</p>
                                </div>
                                <div class="grid grid-cols-2 gap-3 mt-2">
                                    <button onclick="driver.updateJob('${job.id}', 'shipping')" class="py-3 bg-brand text-white rounded-xl text-[10px] font-black uppercase">Start Shipping</button>
                                    <button onclick="driver.updateJob('${job.id}', 'delivered')" class="py-3 bg-emerald-500 text-white rounded-xl text-[10px] font-black uppercase">Delivered</button>
                                </div>
                            </div>`;
                        });
                    }

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Tracking
                    const activeJob = allShipments.find(ship => ship.status !== 'delivered');
                    if(activeJob) {
                        document.getElementById('displayOrderID').innerText = '#' + activeJob.id.slice(0, 8).toUpperCase();
                        ui.updateTimeline(activeJob.status);
                        document.getElementById('driverName').innerText = activeJob.driverName || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢';
                        document.getElementById('driverImg').src = `https://api.dicebear.com/7.x/avataaars/svg?seed=${activeJob.driverID}`;
                        
                        if(activeJob.driverLat && activeJob.driverLng) {
                            const driverPos = { lat: activeJob.driverLat, lng: activeJob.driverLng };
                            driverMarker.setPosition(driverPos);
                            map.panTo(driverPos);
                        }
                    } else {
                        document.getElementById('noData').classList.remove('hidden');
                    }
                });

            } else { document.getElementById('authPage').classList.remove('hidden'); ui.hideLoader(); }
        });
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer></script>
</body>
</html>
