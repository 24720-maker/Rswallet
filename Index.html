<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RS QUANTUM - AI TRADING</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <style>
        /* --- COSMIC LUXURY THEME --- */
        :root {
            --primary: #D4AF37; /* Luxury Gold */
            --primary-glow: rgba(212, 175, 55, 0.5);
            --bg-dark: #080808;
            --glass: rgba(20, 20, 20, 0.85);
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            height: 100dvh;
            overflow: hidden;
            /* Animated Background */
            background: radial-gradient(circle at 50% -20%, #1a1a1a, #000000);
        }

        .font-eng { font-family: 'Outfit', sans-serif; }
        
        /* Particle Background Animation */
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(1px 1px at 20px 30px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 40px 70px, #fff, rgba(0,0,0,0)),
                radial-gradient(1px 1px at 50px 160px, #fff, rgba(0,0,0,0)),
                radial-gradient(2px 2px at 90px 40px, #ffffff, rgba(0,0,0,0));
            background-size: 200px 200px;
            animation: starsAnim 100s linear infinite;
            opacity: 0.3; z-index: -1;
        }
        @keyframes starsAnim { from {transform: translateY(0);} to {transform: translateY(-1000px);} }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .glass-panel {
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.15);
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        /* Buttons */
        .btn-gold {
            background: linear-gradient(135deg, #D4AF37 0%, #AA8A2E 100%);
            color: black;
            box-shadow: 0 0 20px var(--primary-glow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-gold:active { transform: scale(0.96); box-shadow: 0 0 10px var(--primary-glow); }

        /* Animations */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(1.3); opacity: 0; }
        }
        .pulse-anim::before {
            content: ''; absolute; inset: -10px; border-radius: 50%;
            border: 2px solid var(--primary);
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        .hide-scroll::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div class="stars"></div>

    <audio id="sfx-hover" src="https://assets.mixkit.co/active_storage/sfx/2573/2573-preview.mp3"></audio>
    <audio id="sfx-scan" src="https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3"></audio>
    <audio id="sfx-done" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

    <div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center p-6 bg-black">
        <div class="absolute inset-0 bg-[url('https://media.giphy.com/media/xT9IgN8YKRhByRBzMI/giphy.gif')] opacity-10 bg-cover bg-center"></div>
        
        <div class="relative glass-panel w-full max-w-sm p-8 rounded-2xl border-t-4 border-yellow-600 animate-[fadeIn_1s]">
            <div class="text-center mb-8">
                <i class="fa-solid fa-atom text-5xl text-yellow-500 animate-spin-slow" style="animation-duration: 10s;"></i>
                <h1 class="text-4xl font-eng font-black mt-4 tracking-tighter text-white">RS <span class="text-yellow-500">QUANTUM</span></h1>
                <p class="text-xs text-gray-500 font-eng tracking-[0.3em] uppercase">Artificial Intelligence V9</p>
            </div>
            
            <form id="auth-form" class="space-y-5">
                <div class="relative group">
                    <i class="fa-solid fa-envelope absolute left-4 top-4 text-gray-500 group-focus-within:text-yellow-500 transition"></i>
                    <input type="email" id="inp-email" required placeholder="Email Address" class="w-full bg-black/50 border border-gray-700 rounded-xl py-3 pl-12 text-white outline-none focus:border-yellow-500 transition font-eng">
                </div>
                <div class="relative group">
                    <i class="fa-solid fa-key absolute left-4 top-4 text-gray-500 group-focus-within:text-yellow-500 transition"></i>
                    <input type="password" id="inp-password" required placeholder="Access Code" class="w-full bg-black/50 border border-gray-700 rounded-xl py-3 pl-12 text-white outline-none focus:border-yellow-500 transition font-eng">
                </div>
                <button type="submit" class="btn-gold w-full py-4 rounded-xl font-bold font-eng text-lg tracking-wider">INITIALIZE SYSTEM</button>
            </form>
        </div>
    </div>

    <div id="app-container" class="hidden flex flex-col h-full relative z-10">
        
        <header class="h-16 glass flex justify-between items-center px-5 z-20">
            <div class="flex items-center gap-3">
                <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-yellow-500 to-yellow-700 flex items-center justify-center text-black font-bold font-eng">RS</div>
                <div>
                    <div id="user-name" class="font-bold text-sm text-gray-100">Loading...</div>
                    <div id="user-status" class="text-[10px] text-green-400 font-eng tracking-wider">SYSTEM ONLINE</div>
                </div>
            </div>
            <button onclick="logout()" class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:text-red-500 transition"><i class="fa-solid fa-power-off"></i></button>
        </header>

        <main class="flex-1 overflow-y-auto hide-scroll pb-24">
            
            <div id="tab-home" class="p-5 space-y-6 animate-[fadeIn_0.5s]">
                
                <div class="glass-panel p-1 rounded-xl overflow-hidden relative group">
                    <div class="absolute top-3 left-3 z-10 bg-black/60 backdrop-blur px-2 py-1 rounded text-[10px] text-yellow-500 border border-yellow-500/30 font-eng">
                        LIVE: <span id="home-pair-name">BTC/USDT</span>
                    </div>
                    <div class="h-[240px] w-full bg-[#050505]">
                        <div id="tv-mini-chart" class="w-full h-full opacity-90 transition group-hover:opacity-100"></div>
                    </div>
                </div>

                <div class="flex flex-col items-center py-6">
                    <button onclick="openScanner()" class="relative w-48 h-48 rounded-full flex items-center justify-center group outline-none">
                        <div class="absolute inset-[-10px] border border-gray-700/50 rounded-full animate-[spin_10s_linear_infinite]"></div>
                        <div class="absolute inset-[-2px] border-2 border-dashed border-yellow-500/30 rounded-full animate-[spin_20s_linear_reverse_infinite]"></div>
                        
                        <div class="w-full h-full rounded-full bg-gradient-to-b from-[#1a1a1a] to-black border border-gray-700 shadow-[0_0_40px_rgba(212,175,55,0.1)] group-hover:shadow-[0_0_60px_rgba(212,175,55,0.4)] transition-all duration-500 flex flex-col items-center justify-center z-10 pulse-anim">
                            <i class="fa-solid fa-dna text-4xl text-gray-400 group-hover:text-yellow-400 transition mb-2"></i>
                            <span class="text-xl font-eng font-black text-white tracking-widest">AI SCAN</span>
                            <span class="text-[9px] text-yellow-600 mt-1">TAP TO ANALYZE</span>
                        </div>
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="glass p-3 rounded-xl border-l-2 border-green-500">
                        <div class="text-[10px] text-gray-400 font-eng">AI ACCURACY</div>
                        <div class="text-xl font-bold text-white font-eng">94.2%</div>
                    </div>
                    <div class="glass p-3 rounded-xl border-l-2 border-blue-500">
                        <div class="text-[10px] text-gray-400 font-eng">ACTIVE USERS</div>
                        <div class="text-xl font-bold text-white font-eng">1,208</div>
                    </div>
                </div>
            </div>

            <div id="tab-chart" class="hidden h-full flex flex-col animate-[fadeIn_0.5s]">
                <div id="tv-full-chart" class="flex-1 bg-black"></div>
            </div>

            <div id="tab-profile" class="hidden p-6 space-y-6 animate-[fadeIn_0.5s]">
                <div class="text-center">
                    <div class="w-20 h-20 mx-auto rounded-full p-1 border-2 border-yellow-500 shadow-[0_0_20px_rgba(212,175,55,0.3)]">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full rounded-full bg-gray-800">
                    </div>
                    <h2 id="pf-name" class="mt-3 text-xl font-bold text-white">...</h2>
                    <span class="px-3 py-1 bg-yellow-500/10 text-yellow-500 text-[10px] rounded-full border border-yellow-500/20 font-eng">PREMIUM MEMBER</span>
                </div>

                <div class="glass-panel p-5 rounded-xl space-y-4">
                    <div class="flex justify-between items-center border-b border-gray-800 pb-2">
                        <span class="text-gray-400 text-sm">UID</span>
                        <span id="pf-uid" class="font-eng text-white">...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400 text-sm">License Expire</span>
                        <span id="pf-exp" class="font-eng font-bold text-green-400">...</span>
                    </div>
                </div>

                <div class="space-y-3">
                    <a id="link-line" href="#" target="_blank" class="block w-full py-3 bg-[#06C755]/10 border border-[#06C755]/30 text-[#06C755] text-center rounded-xl font-bold hover:bg-[#06C755] hover:text-white transition flex items-center justify-center gap-2">
                        <i class="fa-brands fa-line text-xl"></i> Contact Support
                    </a>
                    <a id="link-fb" href="#" target="_blank" class="block w-full py-3 bg-[#1877F2]/10 border border-[#1877F2]/30 text-[#1877F2] text-center rounded-xl font-bold hover:bg-[#1877F2] hover:text-white transition flex items-center justify-center gap-2">
                        <i class="fa-brands fa-facebook text-xl"></i> Community Group
                    </a>
                </div>
            </div>
        </main>

        <nav class="h-20 bg-black/90 backdrop-blur border-t border-gray-800 grid grid-cols-3 items-center pb-2 z-30">
            <button onclick="nav('home')" id="nav-home" class="flex flex-col items-center gap-1 text-yellow-500 transition-colors">
                <i class="fa-solid fa-compass text-xl"></i>
                <span class="text-[10px] font-eng tracking-wider">HOME</span>
            </button>
            <button onclick="nav('chart')" id="nav-chart" class="flex flex-col items-center gap-1 text-gray-600 hover:text-white transition-colors">
                <i class="fa-solid fa-chart-gantt text-xl"></i>
                <span class="text-[10px] font-eng tracking-wider">CHART</span>
            </button>
            <button onclick="nav('profile')" id="nav-profile" class="flex flex-col items-center gap-1 text-gray-600 hover:text-white transition-colors">
                <i class="fa-solid fa-user-astronaut text-xl"></i>
                <span class="text-[10px] font-eng tracking-wider">PROFILE</span>
            </button>
        </nav>

    </div>

    <div id="modal-search" class="hidden fixed inset-0 z-40 bg-black/95 backdrop-blur-md flex flex-col p-4">
        <div class="flex items-center gap-3 mb-4">
            <button onclick="closeModal('modal-search')" class="w-10 h-10 rounded-full bg-gray-800 text-white"><i class="fa-solid fa-arrow-left"></i></button>
            <div class="flex-1 bg-gray-900 rounded-full flex items-center px-4 border border-gray-700 focus-within:border-yellow-500 transition">
                <i class="fa-solid fa-magnifying-glass text-gray-500"></i>
                <input type="text" id="inp-search" onkeyup="filterAssets()" placeholder="Search (Gold, BTC, EUR)..." class="w-full bg-transparent border-none text-white py-3 px-3 outline-none font-eng uppercase">
            </div>
        </div>
        <div id="asset-list" class="flex-1 overflow-y-auto space-y-2 pb-10">
            </div>
    </div>

    <div id="modal-config" class="hidden fixed inset-0 z-50 bg-black/80 flex items-end sm:items-center justify-center">
        <div class="w-full max-w-sm bg-[#111] border-t sm:border border-gray-700 rounded-t-2xl sm:rounded-2xl p-6 animate-[slideUp_0.3s]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white font-eng">STRATEGY SETUP</h3>
                <button onclick="closeModal('modal-config')" class="text-gray-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <div class="space-y-4">
                <div class="flex justify-between p-3 bg-gray-900 rounded-lg">
                    <span class="text-gray-400 text-sm">Selected Asset</span>
                    <span id="cfg-asset" class="font-bold text-yellow-500 font-eng">XAUUSD</span>
                </div>
                
                <div>
                    <label class="text-xs text-gray-500 uppercase">Capital ($)</label>
                    <input type="number" id="cfg-balance" value="1000" class="w-full mt-1 bg-black border border-gray-700 rounded-lg p-3 text-white font-eng focus:border-yellow-500 outline-none">
                </div>

                <button onclick="runAI()" class="btn-gold w-full py-3 rounded-xl font-bold font-eng text-lg mt-4">
                    <i class="fa-solid fa-microchip mr-2"></i> START ENGINE
                </button>
            </div>
        </div>
    </div>

    <div id="loader" class="hidden fixed inset-0 z-[60] bg-black flex flex-col items-center justify-center">
        <div class="relative w-32 h-32">
            <div class="absolute inset-0 rounded-full border-t-2 border-yellow-500 animate-spin"></div>
            <div class="absolute inset-4 rounded-full border-r-2 border-white animate-spin" style="animation-direction: reverse;"></div>
        </div>
        <div class="mt-8 text-2xl font-eng font-black text-white tracking-widest" id="load-pct">0%</div>
        <div class="text-xs text-yellow-500 font-eng animate-pulse mt-2">CALCULATING PROBABILITIES</div>
    </div>

    <div id="modal-result" class="hidden fixed inset-0 z-[70] bg-black/95 flex items-center justify-center p-4">
        <div class="w-full max-w-md glass-panel p-0 rounded-2xl overflow-hidden border border-gray-700 animate-[zoomIn_0.4s]">
            <div class="bg-gradient-to-r from-gray-900 to-black p-5 border-b border-gray-800 flex justify-between items-center">
                <span class="text-xs font-eng text-gray-500">AI PREDICTION RESULT</span>
                <span id="res-pair" class="font-bold text-white font-eng">BTC/USDT</span>
            </div>
            
            <div class="p-6 text-center">
                <div id="res-signal" class="inline-block px-8 py-2 text-3xl font-black font-eng italic tracking-widest mb-6 rounded bg-green-500 text-black shadow-[0_0_20px_rgba(0,255,0,0.4)]">
                    BUY
                </div>

                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gray-800/50 p-3 rounded-xl border border-gray-700">
                        <div class="text-[10px] text-gray-400 uppercase">Total Lot</div>
                        <div id="res-lot" class="text-xl font-bold text-white font-eng">1.00</div>
                    </div>
                    <div class="bg-gray-800/50 p-3 rounded-xl border border-gray-700">
                        <div class="text-[10px] text-gray-400 uppercase">Est. Profit</div>
                        <div id="res-profit" class="text-xl font-bold text-green-400 font-eng">+$150</div>
                    </div>
                </div>

                <div class="text-left bg-yellow-500/5 border border-yellow-500/20 rounded-xl p-4 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 opacity-10"><i class="fa-solid fa-layer-group text-4xl text-yellow-500"></i></div>
                    <h4 class="text-yellow-500 text-xs font-bold font-eng mb-2">SMART LAYERING (DIVIDE ORDERS)</h4>
                    <ul id="res-layers" class="space-y-2 text-sm text-gray-300 font-eng">
                        </ul>
                </div>

                <div class="mt-6 flex gap-3">
                    <div class="flex-1 p-2 border border-red-500/30 bg-red-900/10 rounded text-center">
                        <span class="text-[10px] text-red-400 block">STOP LOSS</span>
                        <span id="res-sl" class="font-bold text-white">...</span>
                    </div>
                    <div class="flex-1 p-2 border border-green-500/30 bg-green-900/10 rounded text-center">
                        <span class="text-[10px] text-green-400 block">TAKE PROFIT</span>
                        <span id="res-tp" class="font-bold text-white">...</span>
                    </div>
                </div>
            </div>
            
            <button onclick="closeModal('modal-result')" class="w-full py-4 bg-gray-800 hover:bg-gray-700 text-white font-bold font-eng transition">CLOSE REPORT</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBNfTBQthLLRbJP9BXZ-UQptFsdU324Mv0", // <-- แก้ Key ของคุณ
            authDomain: "fafada-d9899.firebaseapp.com",
            projectId: "fafada-d9899",
            storageBucket: "fafada-d9899.appspot.com",
            messagingSenderId: "484777586908",
            appId: "1:484777586908:web:16a8f0367ad15737364419"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DATASETS
        const assets = [
            { s: 'XAUUSD', n: 'Gold Spot', t: 'METAL', c: 'text-yellow-500' },
            { s: 'BTCUSDT', n: 'Bitcoin', t: 'CRYPTO', c: 'text-orange-500' },
            { s: 'ETHUSDT', n: 'Ethereum', t: 'CRYPTO', c: 'text-purple-500' },
            { s: 'EURUSD', n: 'Euro/USD', t: 'FOREX', c: 'text-blue-400' },
            { s: 'GBPUSD', n: 'Pound/USD', t: 'FOREX', c: 'text-indigo-400' },
            { s: 'USDJPY', n: 'USD/Yen', t: 'FOREX', c: 'text-red-400' },
            { s: 'US30', n: 'Dow Jones', t: 'INDEX', c: 'text-green-500' },
            { s: 'NAS100', n: 'Nasdaq 100', t: 'INDEX', c: 'text-cyan-500' }
        ];

        let currentAsset = 'BTCUSDT';

        // AUTH
        document.getElementById('auth-form').addEventListener('submit', async(e)=>{
            e.preventDefault();
            try {
                await signInWithEmailAndPassword(auth, 
                    document.getElementById('inp-email').value, 
                    document.getElementById('inp-password').value
                );
            } catch(err) { alert("Access Denied: " + err.message); }
        });

        onAuthStateChanged(auth, (user) => {
            if(user) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                loadUserData(user.uid);
                loadSystemConfig();
                initChart('BTCUSDT', 'tv-mini-chart', true);
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
            }
        });

        window.logout = () => signOut(auth);

        // DATA LOADING
        function loadUserData(uid) {
            onSnapshot(doc(db, "users", uid), (snap) => {
                if(snap.exists()) {
                    const d = snap.data();
                    document.getElementById('user-name').innerText = d.username;
                    document.getElementById('pf-name').innerText = d.username;
                    document.getElementById('pf-uid').innerText = uid.slice(0,6).toUpperCase();
                    
                    const expDate = d.expiryDate.toDate();
                    document.getElementById('pf-exp').innerText = expDate.toLocaleDateString();
                    
                    if(expDate < new Date()) {
                        document.getElementById('pf-exp').className = "font-eng font-bold text-red-500";
                        document.getElementById('pf-exp').innerText += " (EXPIRED)";
                    }
                }
            });
        }

        async function loadSystemConfig() {
            // ดึงลิงก์จาก Admin (Firestore: system_config -> contact_links)
            try {
                const docRef = doc(db, "system_config", "contact_links");
                const snap = await getDoc(docRef);
                if (snap.exists()) {
                    const data = snap.data();
                    if(data.line) document.getElementById('link-line').href = data.line;
                    if(data.facebook) document.getElementById('link-fb').href = data.facebook;
                }
            } catch(e) { console.log("No config found, using default"); }
        }

        // NAVIGATION & CHARTS
        window.nav = (page) => {
            ['home', 'chart', 'profile'].forEach(p => {
                document.getElementById('tab-'+p).classList.add('hidden');
                document.getElementById('nav-'+p).classList.remove('text-yellow-500');
                document.getElementById('nav-'+p).classList.add('text-gray-600');
            });
            document.getElementById('tab-'+page).classList.remove('hidden');
            document.getElementById('nav-'+page).classList.add('text-yellow-500');
            document.getElementById('nav-'+page).classList.remove('text-gray-600');

            if(page === 'chart') initChart(currentAsset, 'tv-full-chart');
        };

        window.initChart = (symbol, div, mini=false) => {
            let tvSym = "BINANCE:" + symbol;
            if(symbol === 'XAUUSD') tvSym = "OANDA:XAUUSD";
            if(symbol.includes('USD') && !symbol.includes('T')) tvSym = "FX:" + symbol;

            new TradingView.widget({
                "container_id": div,
                "autosize": true,
                "symbol": tvSym,
                "interval": "15",
                "timezone": "Asia/Bangkok",
                "theme": "dark",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#000",
                "enable_publishing": false,
                "hide_top_toolbar": mini,
                "hide_legend": mini,
                "save_image": false,
                "backgroundColor": "rgba(0,0,0,1)"
            });
        };

        // SCANNER & AI LOGIC
        window.openScanner = () => {
            document.getElementById('modal-search').classList.remove('hidden');
            renderAssets(assets);
        };

        window.filterAssets = () => {
            const v = document.getElementById('inp-search').value.toUpperCase();
            const f = assets.filter(a => a.s.includes(v) || a.n.toUpperCase().includes(v));
            renderAssets(f);
        };

        function renderAssets(list) {
            const container = document.getElementById('asset-list');
            container.innerHTML = '';
            list.forEach(a => {
                const el = document.createElement('div');
                el.className = "flex items-center justify-between p-3 bg-gray-900 border border-gray-800 rounded-xl hover:border-yellow-500 cursor-pointer transition";
                el.onclick = () => selectAsset(a.s);
                el.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center ${a.c} font-bold text-xs shadow-inner shadow-black">${a.s[0]}</div>
                        <div>
                            <div class="font-bold text-white text-sm font-eng">${a.s}</div>
                            <div class="text-[10px] text-gray-500">${a.n}</div>
                        </div>
                    </div>
                    <span class="text-[9px] font-eng bg-gray-800 px-2 py-1 rounded text-gray-400">${a.t}</span>
                `;
                container.appendChild(el);
            });
        }

        window.selectAsset = (sym) => {
            currentAsset = sym;
            document.getElementById('home-pair-name').innerText = sym;
            document.getElementById('cfg-asset').innerText = sym;
            initChart(sym, 'tv-mini-chart', true);
            closeModal('modal-search');
            document.getElementById('modal-config').classList.remove('hidden');
        };

        window.runAI = () => {
            closeModal('modal-config');
            document.getElementById('loader').classList.remove('hidden');
            
            // Sound
            const sfx = document.getElementById('sfx-scan');
            sfx.currentTime = 0; sfx.play().catch(()=>{});

            let pct = 0;
            const intv = setInterval(() => {
                pct += 2;
                document.getElementById('load-pct').innerText = pct + "%";
                if(pct >= 100) {
                    clearInterval(intv);
                    document.getElementById('loader').classList.add('hidden');
                    document.getElementById('sfx-done').play().catch(()=>{});
                    displayResult();
                }
            }, 60); // 3 seconds
        };

        function displayResult() {
            const bal = parseFloat(document.getElementById('cfg-balance').value);
            const isBuy = Math.random() > 0.5;
            
            // Calc Logic
            const riskAmt = bal * 0.02; // 2% Risk
            const totalLot = (riskAmt / 200).toFixed(2); // Approximate
            
            // UI
            document.getElementById('res-pair').innerText = currentAsset;
            const sig = document.getElementById('res-signal');
            if(isBuy) {
                sig.innerText = "BUY";
                sig.className = "inline-block px-8 py-2 text-3xl font-black font-eng italic tracking-widest mb-6 rounded bg-green-500 text-black shadow-[0_0_20px_rgba(0,255,0,0.4)]";
                document.getElementById('res-tp').innerText = "Upper Zone";
                document.getElementById('res-sl').innerText = "Lower Support";
            } else {
                sig.innerText = "SELL";
                sig.className = "inline-block px-8 py-2 text-3xl font-black font-eng italic tracking-widest mb-6 rounded bg-red-500 text-black shadow-[0_0_20px_rgba(255,0,0,0.4)]";
                document.getElementById('res-tp').innerText = "Lower Zone";
                document.getElementById('res-sl').innerText = "Upper Resist";
            }

            document.getElementById('res-lot').innerText = totalLot;
            document.getElementById('res-profit').innerText = "+$" + (riskAmt * 2).toFixed(0);

            // Layering Generation
            const l1 = (totalLot * 0.5).toFixed(2);
            const l2 = (totalLot * 0.3).toFixed(2);
            const l3 = (totalLot * 0.2).toFixed(2);
            
            const layers = document.getElementById('res-layers');
            layers.innerHTML = `
                <li class="flex justify-between p-2 bg-gray-800/50 rounded">
                    <span>Entry 1 (Market):</span> <span class="text-white font-bold">${l1} Lot</span>
                </li>
                <li class="flex justify-between p-2 bg-gray-800/50 rounded">
                    <span>Entry 2 (Correction):</span> <span class="text-white font-bold">${l2} Lot</span>
                </li>
                <li class="flex justify-between p-2 bg-gray-800/50 rounded">
                    <span>Entry 3 (Sniper):</span> <span class="text-white font-bold">${l3} Lot</span>
                </li>
            `;

            document.getElementById('modal-result').classList.remove('hidden');
        }

        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
    </script>
</body>
</html>
