<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOADING...</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600;700&family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --gold: #D4AF37; --gold-light: #F8E79B; --gold-dark: #8a6d1c;
            --bg: #050505; --card: #121212; --glass: rgba(20, 20, 20, 0.95);
        }
        body { font-family: 'Kanit', sans-serif; background-color: var(--bg); color: #fff; overflow-x: hidden; }
        
        /* Premium UI */
        .gold-text { background: linear-gradient(to bottom, #fff, var(--gold)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gold-border { border: 1px solid rgba(212, 175, 55, 0.3); box-shadow: 0 0 15px rgba(212, 175, 55, 0.1); }
        
        .glass-panel {
            background: var(--glass); backdrop-filter: blur(20px); border-radius: 24px;
            border-top: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        .btn-premium {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: #000; font-weight: 800; border: none; padding: 12px; border-radius: 12px;
            position: relative; overflow: hidden; transition: 0.3s;
        }
        .btn-premium::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: 0.5s;
        }
        .btn-premium:hover::after { left: 100%; }
        .btn-premium:active { transform: scale(0.96); }

        .input-lux {
            background: #0a0a0a; border: 1px solid #333; color: var(--gold);
            padding: 14px; border-radius: 12px; width: 100%; transition: 0.3s; outline: none;
        }
        .input-lux:focus { border-color: var(--gold); box-shadow: 0 0 15px rgba(212, 175, 55, 0.2); }

        /* Animations */
        .page-enter { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Loader */
        .loader-wrap { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .diamond { width: 50px; height: 50px; background: var(--gold); transform: rotate(45deg); animation: pulseDiamond 1s infinite; }
        @keyframes pulseDiamond { 0% { transform: rotate(45deg) scale(1); opacity: 1; } 50% { transform: rotate(45deg) scale(0.8); opacity: 0.5; } 100% { transform: rotate(45deg) scale(1); opacity: 1; } }

        /* Maintenance */
        #maint-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
    </style>
</head>
<body class="pb-24">

    <div id="loader" class="loader-wrap">
        <div class="diamond"></div>
        <p class="mt-8 text-[#D4AF37] text-xs font-bold tracking-[0.5em] animate-pulse">SYSTEM LOADING</p>
    </div>

    <div id="maint-overlay" class="hidden">
        <i class="fa-solid fa-triangle-exclamation text-6xl text-red-500 mb-6 animate-bounce"></i>
        <h1 class="text-4xl font-bold text-white mb-2">SYSTEM OFF</h1>
        <p class="text-gray-400">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</p>
        <button onclick="UI.contact()" class="mt-8 border border-[#D4AF37] text-[#D4AF37] px-6 py-2 rounded-full hover:bg-[#D4AF37] hover:text-black transition">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</button>
    </div>

    <div id="auth-view" class="fixed inset-0 z-50 flex items-center justify-center p-6 hidden bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
        <div class="glass-panel w-full max-w-sm p-8 text-center animate__animated animate__zoomIn">
            <h1 id="site-title-auth" class="text-5xl font-black text-gold mb-2 font-['Cinzel']">ARENA</h1>
            <p class="text-gray-500 text-xs mb-8 uppercase tracking-[0.3em]">VIP MEMBER ACCESS</p>

            <div id="form-login">
                <div class="space-y-4">
                    <input id="l-email" class="input-lux" placeholder="Username / Email">
                    <input id="l-pass" type="password" class="input-lux" placeholder="Password">
                </div>
                <button onclick="Auth.login()" class="btn-premium w-full mt-6 shadow-lg shadow-[#D4AF37]/20">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <p class="mt-4 text-xs text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <span onclick="UI.toggleAuth('reg')" class="text-[#D4AF37] cursor-pointer hover:underline font-bold">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span></p>
            </div>

            <div id="form-reg" class="hidden">
                <div class="space-y-3">
                    <input id="r-name" class="input-lux" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
                    <input id="r-email" class="input-lux" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                    <input id="r-pass" type="password" class="input-lux" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                    <div class="grid grid-cols-2 gap-2">
                        <select id="r-bank" class="input-lux text-xs"><option>KBANK</option><option>SCB</option><option>BBL</option><option>WALLET</option></select>
                        <input id="r-acc" class="input-lux" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">
                    </div>
                </div>
                <button onclick="Auth.register()" class="btn-premium w-full mt-6">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
                <p class="mt-4 text-xs text-gray-500 cursor-pointer" onclick="UI.toggleAuth('log')">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</p>
            </div>
        </div>
    </div>

    <div id="app-view" class="hidden max-w-md mx-auto min-h-screen relative shadow-2xl border-x border-[#222]">
        
        <header class="p-6 bg-gradient-to-b from-[#111] to-transparent sticky top-0 z-40 backdrop-blur-md">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-11 h-11 rounded-full p-[2px] bg-gradient-to-tr from-[#D4AF37] to-[#000]">
                        <img id="u-img" class="w-full h-full rounded-full object-cover bg-black">
                    </div>
                    <div>
                        <p class="text-[10px] text-[#D4AF37] font-bold uppercase tracking-widest">CREDIT BALANCE</p>
                        <p id="u-bal" class="text-xl font-bold text-white font-mono tracking-tight">‡∏ø0.00</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="UI.contact()" class="w-9 h-9 rounded-lg bg-[#D4AF37]/10 text-[#D4AF37] border border-[#D4AF37]/30 flex items-center justify-center"><i class="fa-brands fa-line"></i></button>
                    <button onclick="Auth.logout()" class="w-9 h-9 rounded-lg bg-red-900/20 text-red-500 border border-red-900/50 flex items-center justify-center"><i class="fa-solid fa-power-off"></i></button>
                </div>
            </div>
            <div class="mt-4 bg-[#D4AF37]/5 border-l-2 border-[#D4AF37] py-1 px-2 rounded overflow-hidden">
                <marquee id="site-ann" class="text-xs text-gray-400">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...</marquee>
            </div>
        </header>

        <main class="px-5 space-y-6">
            
            <section id="p-home" class="page-enter">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button onclick="UI.page('deposit')" class="glass-panel p-4 flex flex-col items-center gap-2 hover:bg-[#222] transition group">
                        <div class="w-12 h-12 rounded-full bg-green-500/10 text-green-500 flex items-center justify-center text-xl group-hover:scale-110 transition"><i class="fa-solid fa-circle-arrow-down"></i></div>
                        <span class="font-bold text-sm">‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</span>
                    </button>
                    <button onclick="UI.page('withdraw')" class="glass-panel p-4 flex flex-col items-center gap-2 hover:bg-[#222] transition group">
                        <div class="w-12 h-12 rounded-full bg-red-500/10 text-red-500 flex items-center justify-center text-xl group-hover:scale-110 transition"><i class="fa-solid fa-circle-arrow-up"></i></div>
                        <span class="font-bold text-sm">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                    </button>
                </div>

                <h3 class="font-bold text-[#D4AF37] mb-3 border-l-4 border-[#D4AF37] pl-3">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏°‡∏≤‡πÅ‡∏£‡∏á üî•</h3>
                <div id="promo-list" class="space-y-3 mb-8">
                    </div>

                <h3 class="font-bold text-gray-500 mb-3 border-l-4 border-gray-600 pl-3">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</h3>
                <div id="tx-list" class="space-y-3 pb-20"></div>
            </section>

            <section id="p-deposit" class="hidden page-enter">
                <h2 class="text-2xl font-bold text-white mb-6">‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h2>
                
                <div class="mb-6">
                    <label class="text-xs text-gray-500 mb-2 block">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (Optional)</label>
                    <select id="dep-promo" class="input-lux text-sm cursor-pointer" onchange="Wallet.calcBonus()">
                        <option value="">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</option>
                    </select>
                </div>

                <div class="glass-panel p-6 mb-6 text-center">
                    <p class="text-gray-400 text-sm mb-2">‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏≠‡∏ô</p>
                    <input id="dep-amt" type="number" class="input-lux text-center text-2xl font-bold text-[#D4AF37]" placeholder="0.00" onkeyup="Wallet.calcBonus()">
                    <div id="bonus-info" class="mt-3 text-xs text-green-400 hidden">
                        +‡πÇ‡∏ö‡∏ô‡∏±‡∏™ <span id="bonus-val">0</span> (‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö <span id="total-get">0</span>)
                    </div>
                </div>

                <div class="bg-[#1a1a1a] p-4 rounded-xl border border-[#333] mb-6">
                    <p class="text-xs text-gray-500 mb-1">‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</p>
                    <div class="flex justify-between items-center">
                        <div class="text-left">
                            <p class="font-bold text-white">‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (KBANK)</p>
                            <p class="text-sm text-[#D4AF37]">000-0-00000-0</p>
                            <p class="text-xs text-gray-500">‡∏ö‡∏à‡∏Å. ‡∏≠‡∏≤‡∏£‡∏µ‡∏ô‡πà‡∏≤ ‡πÇ‡∏Å‡∏•‡∏î‡πå</p>
                        </div>
                        <i class="fa-solid fa-copy text-gray-600 cursor-pointer hover:text-white"></i>
                    </div>
                </div>

                <div class="space-y-3">
                    <input id="dep-time" class="input-lux" placeholder="‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 12.30)">
                    <button onclick="Wallet.deposit()" class="btn-premium w-full">‡πÅ‡∏à‡πâ‡∏á‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</button>
                </div>
                <button onclick="UI.page('home')" class="w-full text-center text-gray-600 text-xs mt-6">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            </section>

            <section id="p-withdraw" class="hidden page-enter">
                <h2 class="text-2xl font-bold text-white mb-6">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h2>
                <div class="glass-panel p-6 mb-6">
                    <div class="flex justify-between text-xs text-gray-500 mb-4">
                        <span>‡∏ñ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</span>
                        <span id="w-bank-info" class="text-[#D4AF37]">Checking...</span>
                    </div>
                    <label class="text-xs text-gray-400">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                    <input id="w-amt" type="number" class="input-lux mt-2 text-center text-2xl font-bold" placeholder="0.00">
                    <p class="text-[10px] text-gray-600 mt-2 text-right">* ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 100 ‡∏ö‡∏≤‡∏ó</p>
                </div>
                <button onclick="Wallet.withdraw()" class="btn-premium w-full">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô</button>
                <button onclick="UI.page('home')" class="w-full text-center text-gray-600 text-xs mt-6">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            </section>

            <section id="p-profile" class="hidden page-enter">
                <h2 class="text-2xl font-bold text-white mb-6">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</h2>
                <div class="glass-panel p-6 space-y-4">
                    <div><label class="text-xs text-gray-500">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input id="pf-name" class="input-lux mt-1"></div>
                    <div><label class="text-xs text-gray-500">‡πÄ‡∏ü‡∏™‡∏ö‡∏∏‡πä‡∏Ñ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠)</label><input id="pf-fb" class="input-lux mt-1"></div>
                    <div class="pt-4 border-t border-white/10">
                        <label class="text-xs text-[#D4AF37] font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</label>
                        <div class="grid grid-cols-3 gap-2 mt-2">
                            <select id="pf-bank" class="input-lux col-span-1 text-xs"><option>KBANK</option><option>SCB</option><option>WALLET</option></select>
                            <input id="pf-acc" class="input-lux col-span-2" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">
                        </div>
                    </div>
                    <button onclick="User.save()" class="btn-premium w-full mt-2">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </section>

        </main>

        <nav class="fixed bottom-0 left-0 w-full h-[70px] bg-[#111] border-t border-[#222] flex justify-around items-center px-4 z-50 max-w-md mx-auto right-0">
            <button onclick="UI.page('home')" class="text-[#D4AF37] flex flex-col items-center gap-1"><i class="fa-solid fa-house text-xl"></i><span class="text-[9px]">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span></button>
            <button onclick="UI.page('deposit')" class="text-gray-500 hover:text-white flex flex-col items-center gap-1"><i class="fa-solid fa-wallet text-xl"></i><span class="text-[9px]">‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</span></button>
            <button onclick="UI.page('profile')" class="text-gray-500 hover:text-white flex flex-col items-center gap-1"><i class="fa-solid fa-user-gear text-xl"></i><span class="text-[9px]">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span></button>
        </nav>

    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyAochx_FIKbXLrbhhcLdVrpaurjjk4aQYc", authDomain: "paoshuv-c260d.firebaseapp.com", databaseURL: "https://paoshuv-c260d-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "paoshuv-c260d" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(); const auth = firebase.auth();

        let user=null, userData={}, promos=[], siteConfig={};

        // AUTH
        auth.onAuthStateChanged(u => {
            if(u) {
                user=u; document.getElementById('loader').style.display='none';
                document.getElementById('auth-view').style.display='none';
                document.getElementById('app-view').classList.remove('hidden');
                App.init();
            } else {
                document.getElementById('loader').style.display='none';
                document.getElementById('auth-view').style.display='block';
                document.getElementById('app-view').classList.add('hidden');
            }
        });

        const Auth = {
            login: () => auth.signInWithEmailAndPassword(document.getElementById('l-email').value, document.getElementById('l-pass').value).catch(e=>Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',e.message,'error')),
            register: () => {
                const d = {e:document.getElementById('r-email').value, p:document.getElementById('r-pass').value, n:document.getElementById('r-name').value};
                auth.createUserWithEmailAndPassword(d.e,d.p).then(c=>{
                    db.ref('users/'+c.user.uid).set({
                        name:d.n, email:d.e, balance:0, bank:document.getElementById('r-bank').value, acc:document.getElementById('r-acc').value
                    });
                }).catch(e=>Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',e.message,'error'));
            },
            logout: () => auth.signOut()
        };

        const App = {
            init: () => {
                // User Data
                db.ref('users/'+user.uid).on('value', s => {
                    userData = s.val() || {};
                    document.getElementById('u-bal').innerText = `‡∏ø${(userData.balance||0).toLocaleString()}`;
                    document.getElementById('u-img').src = `https://ui-avatars.com/api/?name=${userData.name}&background=D4AF37&color=000`;
                    document.getElementById('w-bank-info').innerText = `${userData.bank} - ${userData.acc}`;
                    
                    document.getElementById('pf-name').value = userData.name;
                    document.getElementById('pf-fb').value = userData.fb_link || '';
                    document.getElementById('pf-bank').value = userData.bank;
                    document.getElementById('pf-acc').value = userData.acc;
                });

                // Settings & Maintenance
                db.ref('settings').on('value', s => {
                    siteConfig = s.val() || {};
                    document.getElementById('site-ann').innerText = siteConfig.announcement || '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö';
                    document.title = siteConfig.siteName || 'ARENA';
                    document.getElementById('site-title-auth').innerText = siteConfig.siteName || 'ARENA';
                    
                    if(siteConfig.isMaintenance) {
                        document.getElementById('maint-overlay').classList.remove('hidden');
                        document.getElementById('app-view').classList.add('filter','blur-md');
                    } else {
                        document.getElementById('maint-overlay').classList.add('hidden');
                        document.getElementById('app-view').classList.remove('filter','blur-md');
                    }
                });

                // Promotions
                db.ref('promotions').on('value', s => {
                    const l = document.getElementById('promo-list'); l.innerHTML='';
                    const sel = document.getElementById('dep-promo'); sel.innerHTML='<option value="">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</option>';
                    promos = [];
                    s.forEach(d => {
                        const p = {id:d.key, ...d.val()};
                        promos.push(p);
                        sel.innerHTML += `<option value="${p.id}">${p.title}</option>`;
                        l.innerHTML += `
                            <div class="glass-panel p-3 flex gap-3 items-center border border-[#333] hover:border-[#D4AF37] transition">
                                <img src="${p.img}" class="w-16 h-16 rounded-lg object-cover bg-[#222]">
                                <div class="flex-1">
                                    <h4 class="font-bold text-[#D4AF37]">${p.title}</h4>
                                    <p class="text-xs text-gray-400">‡∏ù‡∏≤‡∏Å ${p.minDep} ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ${p.bonus}%</p>
                                </div>
                                <button onclick="UI.page('deposit'); document.getElementById('dep-promo').value='${p.id}'" class="text-xs bg-[#D4AF37] text-black px-3 py-1 rounded font-bold">‡∏£‡∏±‡∏ö</button>
                            </div>`;
                    });
                });

                // History
                db.ref('transactions').orderByChild('uid').equalTo(user.uid).limitToLast(20).on('value', s => {
                    const l = document.getElementById('tx-list'); l.innerHTML = '';
                    const arr = []; s.forEach(d => arr.unshift(d.val()));
                    arr.forEach(t => {
                        const color = t.status=='approved'?'text-green-500':(t.status=='rejected'?'text-red-500':'text-yellow-500');
                        let title = t.type.toUpperCase();
                        if(t.type==='adjust') title = t.amount > 0 ? 'ADMIN ADD' : 'ADMIN DEDUCT';
                        l.innerHTML += `
                            <div class="bg-[#111] p-3 rounded-xl border border-[#222] flex justify-between items-center">
                                <div>
                                    <div class="font-bold text-gray-300 text-sm">${title}</div>
                                    <div class="text-[10px] text-gray-600">${moment(t.timestamp).fromNow()} ${t.reason ? '‚Ä¢ '+t.reason : ''}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold ${t.amount>0 && t.type!=='withdraw'?'text-green-400':'text-red-400'}">${t.type==='withdraw' || t.amount<0 ? '-' : '+'}‡∏ø${Math.abs(t.amount)}</div>
                                    <div class="text-[9px] uppercase ${color}">${t.status}</div>
                                </div>
                            </div>`;
                    });
                });
            }
        };

        const Wallet = {
            calcBonus: () => {
                const amt = Number(document.getElementById('dep-amt').value);
                const pid = document.getElementById('dep-promo').value;
                const info = document.getElementById('bonus-info');
                
                if(pid && amt > 0) {
                    const p = promos.find(x => x.id === pid);
                    if(amt < p.minDep) { info.innerHTML='<span class="text-red-500">‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÇ‡∏õ‡∏£</span>'; info.classList.remove('hidden'); return; }
                    
                    const bonus = Math.floor(amt * (p.bonus/100));
                    document.getElementById('bonus-val').innerText = bonus;
                    document.getElementById('total-get').innerText = amt + bonus;
                    info.innerHTML = `+‡πÇ‡∏ö‡∏ô‡∏±‡∏™ <span id="bonus-val">${bonus}</span> (‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö <span id="total-get">${amt+bonus}</span>)`;
                    info.classList.remove('hidden');
                } else {
                    info.classList.add('hidden');
                }
            },
            deposit: () => {
                const amt = Number(document.getElementById('dep-amt').value);
                const time = document.getElementById('dep-time').value;
                const pid = document.getElementById('dep-promo').value;
                
                if(!amt || !time) return Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô','‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö','warning');
                
                let bonus = 0;
                let promoName = '';
                if(pid) {
                    const p = promos.find(x => x.id === pid);
                    if(amt >= p.minDep) {
                        bonus = Math.floor(amt * (p.bonus/100));
                        promoName = p.title;
                    }
                }

                db.ref('transactions').push({
                    uid: user.uid, name: userData.name, type: 'deposit', 
                    amount: amt, bonus: bonus, promo: promoName,
                    total: amt+bonus, time: time, status: 'pending', timestamp: Date.now()
                });
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÅ‡∏à‡πâ‡∏á‡∏ù‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö','success'); UI.page('home');
            },
            withdraw: () => {
                const amt = Number(document.getElementById('w-amt').value);
                if(amt > userData.balance || amt < 100) return Swal.fire('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô','‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 100','error');
                
                db.ref('transactions').push({
                    uid: user.uid, name: userData.name, type: 'withdraw', 
                    amount: amt, status: 'pending', timestamp: Date.now(),
                    bank_info: `${userData.bank} ${userData.acc}`
                });
                db.ref('users/'+user.uid).update({balance: userData.balance - amt});
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÅ‡∏à‡πâ‡∏á‡∏ñ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß','success'); UI.page('home');
            }
        };

        const User = {
            save: () => {
                db.ref('users/'+user.uid).update({
                    name: document.getElementById('pf-name').value,
                    fb_link: document.getElementById('pf-fb').value,
                    bank: document.getElementById('pf-bank').value,
                    acc: document.getElementById('pf-acc').value
                }).then(()=>Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å','','success'));
            }
        };

        const UI = {
            toggleAuth: (m) => { document.getElementById('form-login').style.display=m=='log'?'block':'none'; document.getElementById('form-reg').style.display=m=='reg'?'block':'none'; },
            page: (p) => {
                ['home','deposit','withdraw','profile'].forEach(id => document.getElementById('p-'+id).classList.add('hidden'));
                document.getElementById('p-'+p).classList.remove('hidden');
                document.getElementById('p-'+p).classList.add('page-enter');
            },
            contact: () => window.open(siteConfig.contactLink || '#')
        };
    </script>
</body>
</html>
