<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RS INFINITY | ULTIMATE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Kanit:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/th.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Kanit', 'sans-serif'], tech: ['Rajdhani', 'sans-serif'] },
                    colors: { 
                        gold: '#FFD700', 
                        goldDark: '#B8860B', 
                        bg: '#050505', 
                        glass: 'rgba(20, 20, 20, 0.85)',
                        border: 'rgba(255, 255, 255, 0.1)'
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050505; color: #fff; height: 100vh; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        .glass-panel { background: var(--glass); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid var(--border); border-radius: 1.5rem; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); }
        .gold-gradient-text { background: linear-gradient(to bottom, #FFD700, #FDB931); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .btn-main { background: linear-gradient(135deg, #FFD700 0%, #B8860B 100%); color: #000; font-weight: 700; border-radius: 1rem; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
        .btn-main:active { transform: scale(0.95); box-shadow: 0 0 10px rgba(255, 215, 0, 0.1); }
        .nav-item { transition: 0.3s; color: #666; }
        .nav-item.active { color: #FFD700; transform: translateY(-5px); }
        .nav-item.active i { filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6)); }
        .coin-card { background: linear-gradient(145deg, #1a1a1a, #0f0f0f); border: 1px solid #333; transition: 0.3s; }
        .coin-card:active { transform: scale(0.95); border-color: #FFD700; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .input-dark { background: #111; border: 1px solid #333; color: white; border-radius: 12px; padding: 14px; width: 100%; outline: none; transition: 0.3s; }
        .input-dark:focus { border-color: #FFD700; box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.1); }
        .member-card { background: linear-gradient(135deg, #1c1c1c 0%, #000000 100%); border: 1px solid rgba(255, 215, 0, 0.3); position: relative; overflow: hidden; }
        .member-card::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 60%); animation: rotate 10s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col font-sans">

    <div id="loader" class="fixed inset-0 z-[9999] bg-bg flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="relative w-24 h-24 mb-6">
            <div class="absolute inset-0 border-4 border-zinc-800 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-t-gold border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"></div>
            <i class="fas fa-gem absolute inset-0 flex items-center justify-center text-gold text-2xl animate-pulse"></i>
        </div>
        <h1 class="text-2xl font-black italic tracking-widest text-white">RS <span class="text-gold">INFINITY</span></h1>
    </div>

    <div id="authPage" class="hidden fixed inset-0 z-[5000] bg-bg flex flex-col justify-center items-center p-8 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
        <div class="w-full max-w-sm glass-panel p-8 text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-gold to-transparent"></div>
            <h1 class="text-4xl font-black text-white italic mb-2">WELCOME</h1>
            <p class="text-zinc-500 text-xs mb-8">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô RS INTELLIGENCE</p>
            <div id="loginForm" class="space-y-4">
                <input id="lEmail" type="email" class="input-dark" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                <input id="lPass" type="password" class="input-dark" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                <button onclick="app.login()" class="btn-main w-full py-4 text-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <div class="mt-4 flex justify-between text-xs text-zinc-400">
                    <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ?</span>
                    <button onclick="ui.toggleAuth(false)" class="text-gold font-bold hover:underline">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
                </div>
            </div>
            <div id="regForm" class="hidden space-y-4">
                <input id="rName" class="input-dark" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô (Display Name)">
                <input id="rEmail" type="email" class="input-dark" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                <input id="rPass" type="password" class="input-dark" placeholder="‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                <button onclick="app.register()" class="btn-main w-full py-4 text-lg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
                <button onclick="ui.toggleAuth(true)" class="text-zinc-500 text-xs mt-4 underline">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden flex-1 flex flex-col h-screen relative bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
        <header class="pt-12 pb-4 px-6 flex justify-between items-center bg-gradient-to-b from-black/90 to-transparent z-20">
            <div>
                <h1 class="text-xl font-black italic tracking-tighter text-white">RS <span class="text-gold">INFINITY</span></h1>
                <div id="statusBadge" class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-zinc-500"></span> LOADING...
                </div>
            </div>
            <div onclick="ui.view('profile')" class="w-10 h-10 rounded-full border border-gold/30 p-0.5 cursor-pointer">
                <img src="https://ui-avatars.com/api/?name=User&background=000&color=FFD700" id="headerAvatar" class="w-full h-full rounded-full object-cover">
            </div>
        </header>

        <main id="view-home" class="flex-1 overflow-y-auto px-6 pb-32 no-scrollbar">
            <div onclick="ui.openSearch()" class="glass-panel p-5 mb-6 flex items-center justify-between cursor-pointer active:scale-95 transition-transform group">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 rounded-full bg-zinc-900 border border-zinc-700 flex items-center justify-center text-2xl group-hover:border-gold transition-colors">
                        <i id="assetIcon" class="fab fa-bitcoin text-gold"></i>
                    </div>
                    <div>
                        <p class="text-[10px] text-zinc-400 font-bold uppercase tracking-widest">Selected Asset</p>
                        <h2 id="assetName" class="text-3xl font-black italic text-white leading-none">BTCUSDT</h2>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-[10px] text-zinc-400">Live Price</p>
                    <p id="livePrice" class="text-lg font-mono text-gold font-bold">0.00</p>
                </div>
            </div>

            <div class="mb-8">
                <div class="flex justify-between items-end mb-3">
                    <h3 class="text-sm font-bold text-zinc-400 uppercase">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (Duration)</h3>
                    <span class="text-xs text-gold font-bold bg-gold/10 px-2 py-1 rounded">AI MODE</span>
                </div>
                <div class="grid grid-cols-4 gap-3">
                    <button onclick="app.setTime(1)" class="time-btn bg-zinc-900 border border-zinc-800 rounded-xl py-3 text-sm font-bold hover:border-gold focus:bg-gold focus:text-black transition">1m</button>
                    <button onclick="app.setTime(5)" class="time-btn bg-gold text-black border-gold rounded-xl py-3 text-sm font-bold hover:border-gold focus:bg-gold focus:text-black transition active-time">5m</button>
                    <button onclick="app.setTime(15)" class="time-btn bg-zinc-900 border border-zinc-800 rounded-xl py-3 text-sm font-bold hover:border-gold focus:bg-gold focus:text-black transition">15m</button>
                    <button onclick="app.setTime(30)" class="time-btn bg-zinc-900 border border-zinc-800 rounded-xl py-3 text-sm font-bold hover:border-gold focus:bg-gold focus:text-black transition">30m</button>
                </div>
                <input type="hidden" id="selectedTime" value="5">
            </div>

            <button onclick="app.checkSubscription()" id="startBtn" class="btn-main w-full h-24 rounded-2xl flex flex-col items-center justify-center gap-1 shadow-[0_0_40px_rgba(255,215,0,0.2)] animate-float">
                <i class="fas fa-fingerprint text-3xl"></i>
                <span class="text-xl font-black italic tracking-widest uppercase">SCAN MARKET</span>
                <span class="text-[10px] font-normal opacity-70">‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ AI</span>
            </button>

            <div id="lockMessage" class="hidden mt-6 p-4 rounded-xl bg-red-500/10 border border-red-500/30 text-center">
                <i class="fas fa-lock text-red-500 text-2xl mb-2"></i>
                <h3 class="text-red-500 font-bold">Membership Expired</h3>
                <p class="text-xs text-zinc-400 mb-3">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
                <button onclick="app.contactAdmin()" class="bg-red-500 text-white px-6 py-2 rounded-lg text-sm font-bold w-full">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
            </div>
        </main>

        <main id="view-chart" class="hidden flex-1 flex flex-col h-full pb-24">
            <div class="px-6 pb-2">
                <h2 class="text-xl font-bold text-white"><i class="fas fa-chart-area text-gold mr-2"></i>Live Chart</h2>
            </div>
            <div class="flex-1 bg-black border-y border-zinc-800 relative">
                <div id="tv-mount" class="w-full h-full"></div>
            </div>
        </main>

        <main id="view-profile" class="hidden flex-1 overflow-y-auto px-6 pb-32 no-scrollbar">
            <h2 class="text-2xl font-black italic text-white mb-6">MY PROFILE</h2>
            
            <div class="member-card rounded-2xl p-6 mb-6 shadow-2xl relative z-10">
                <div class="flex justify-between items-start mb-8">
                    <i class="fas fa-microchip text-4xl text-white/20"></i>
                    <div class="text-right">
                        <p class="text-[10px] text-gold font-bold tracking-widest uppercase">MEMBERSHIP CARD</p>
                        <p class="text-xs text-zinc-400">RS INFINITY PRIME</p>
                    </div>
                </div>
                <div>
                    <h3 id="pName" class="text-2xl font-bold text-white tracking-tight">Loading...</h3>
                    <p id="pEmail" class="text-xs text-zinc-400 font-mono mb-4">...</p>
                    
                    <div class="mb-4 bg-black/60 rounded-xl p-4 border border-white/10 backdrop-blur-md">
                        <p class="text-[10px] text-zinc-500 uppercase font-bold mb-1">Time Remaining</p>
                        <div id="expireCountdown" class="text-xl font-tech font-bold text-white tracking-wider">
                            00D : 00H : 00M : 00S
                        </div>
                    </div>

                    <div class="flex items-center gap-2 bg-black/40 rounded-lg p-2 backdrop-blur-sm inline-flex border border-white/10">
                        <div id="pStatusIcon" class="w-2 h-2 rounded-full bg-zinc-500"></div>
                        <span id="pPlan" class="text-xs font-bold text-white uppercase">CHECKING</span>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <div class="glass-panel p-1">
                    <button onclick="app.contactAdmin()" class="w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-blue-600/20 text-blue-500 flex items-center justify-center"><i class="fab fa-facebook-messenger text-lg"></i></div>
                            <div class="text-left">
                                <h4 class="text-sm font-bold text-white">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h4>
                                <p class="text-[10px] text-zinc-500">‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ / ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-zinc-600 text-xs"></i>
                    </button>
                    <div class="h-[1px] bg-white/5 mx-4"></div>
                    <button onclick="app.logout()" class="w-full p-4 rounded-xl flex items-center justify-between hover:bg-red-500/10 group transition">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-red-500/20 text-red-500 flex items-center justify-center group-hover:bg-red-500 group-hover:text-white transition"><i class="fas fa-power-off text-lg"></i></div>
                            <div class="text-left">
                                <h4 class="text-sm font-bold text-red-500">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</h4>
                                <p class="text-[10px] text-zinc-500">Log out form this device</p>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </main>

        <nav class="fixed bottom-0 w-full px-6 py-4 bg-black/90 backdrop-blur-xl border-t border-white/10 flex justify-between items-end z-40 rounded-t-3xl pb-8">
            <button onclick="ui.view('home')" id="nav-home" class="nav-item flex-1 flex flex-col items-center gap-1 active"><i class="fas fa-home text-2xl mb-1"></i><span class="text-[9px] font-bold tracking-widest">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span></button>
            <button onclick="ui.view('chart')" id="nav-chart" class="nav-item flex-1 flex flex-col items-center gap-1"><i class="fas fa-chart-line text-2xl mb-1"></i><span class="text-[9px] font-bold tracking-widest">‡∏Å‡∏£‡∏≤‡∏ü</span></button>
            <button onclick="ui.view('profile')" id="nav-profile" class="nav-item flex-1 flex flex-col items-center gap-1"><i class="fas fa-user text-2xl mb-1"></i><span class="text-[9px] font-bold tracking-widest">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span></button>
        </nav>
    </div>

    <div id="searchModal" class="hidden fixed inset-0 z-[6000] bg-black/95 backdrop-blur-xl flex flex-col">
        <div class="p-6 flex items-center gap-4 border-b border-white/10">
            <button onclick="ui.closeSearch()" class="text-zinc-500 hover:text-white"><i class="fas fa-arrow-left text-xl"></i></button>
            <input id="searchInput" oninput="app.filterAssets(this.value)" class="bg-transparent text-xl font-bold text-white w-full outline-none placeholder-zinc-700" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç (‡πÄ‡∏ä‡πà‡∏ô BTC)..." autofocus>
        </div>
        <div class="flex-1 overflow-y-auto p-6"><div id="searchResults" class="space-y-2"></div></div>
    </div>

    <div id="aiModal" class="hidden fixed inset-0 z-[7000] bg-black/95 flex flex-col items-center justify-center p-8">
        <div id="scan-ui" class="text-center w-full">
            <div class="relative w-48 h-48 mx-auto mb-8"><div class="absolute inset-0 rounded-full border border-gold/20 animate-ping"></div><div class="absolute inset-4 rounded-full border-t-2 border-gold animate-spin"></div><div class="absolute inset-0 flex items-center justify-center"><span class="text-6xl">ü§ñ</span></div></div>
            <h2 class="text-2xl font-black italic text-white animate-pulse">AI PROCESSING...</h2>
        </div>
        <div id="result-ui" class="hidden w-full max-w-sm glass-panel p-8 border-gold/50 relative overflow-hidden fade-in-up">
            <div class="flex justify-between items-center mb-6"><span class="bg-zinc-800 text-zinc-400 px-3 py-1 rounded-full text-[10px] font-bold border border-zinc-700">SIGNAL ID: #<span id="resId">884</span></span><span id="countdownDisplay" class="text-gold font-mono font-bold text-lg">00:00</span></div>
            <div class="text-center mb-8"><p class="text-xs text-zinc-500 uppercase tracking-widest mb-2">DIRECTION</p><h1 id="resType" class="text-7xl font-black italic">BUY</h1><p id="resAsset" class="text-gold font-bold text-xl mt-2">BTCUSDT</p></div>
            <button onclick="document.getElementById('aiModal').classList.add('hidden')" class="btn-main w-full py-4 text-sm font-bold uppercase tracking-widest">‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBNfTBQthLLRbJP9BXZ-UQptFsdU324Mv0", authDomain: "fafada-d9899.firebaseapp.com", projectId: "fafada-d9899", storageBucket: "fafada-d9899.firebasestorage.app", messagingSenderId: "484777586908", appId: "1:484777586908:web:16a8f0367ad15737364419" };
        const fbApp = initializeApp(firebaseConfig);
        const auth = getAuth(fbApp);
        const db = getFirestore(fbApp);

        let curAsset = 'BTCUSDT', userData = null, timerInt, countdownInterval;
        const assetsList = [{s:'BTCUSDT', n:'Bitcoin', t:'CRYPTO'}, {s:'ETHUSDT', n:'Ethereum', t:'CRYPTO'}, {s:'XAUUSD', n:'Gold Spot', t:'FOREX'}, {s:'EURUSD', n:'Euro', t:'FOREX'}];

        // ‚è≥ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á Real-time ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
        const startExpiryCountdown = (expiryDate) => {
            if (countdownInterval) clearInterval(countdownInterval);
            const el = document.getElementById('expireCountdown');
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = expiryDate.getTime() - now;
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    el.innerText = "00D : 00H : 00M : 00S";
                    el.className = "text-xl font-tech font-bold text-red-500 tracking-wider";
                    return;
                }
                const d = Math.floor(distance / (1000 * 60 * 60 * 24));
                const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((distance % (1000 * 60)) / 1000);
                el.innerText = `${d.toString().padStart(2,'0')}D : ${h.toString().padStart(2,'0')}H : ${m.toString().padStart(2,'0')}M : ${s.toString().padStart(2,'0')}S`;
            }, 1000);
        };

        window.ui = {
            toggleAuth: (login) => { document.getElementById('loginForm').classList.toggle('hidden', !login); document.getElementById('regForm').classList.toggle('hidden', login); },
            view: (v) => {
                document.querySelectorAll('main').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                document.getElementById('view-'+v).classList.remove('hidden');
                document.getElementById('nav-'+v).classList.add('active');
                if(v === 'chart') app.renderChart();
            },
            openSearch: () => { document.getElementById('searchModal').classList.remove('hidden'); app.filterAssets(''); },
            closeSearch: () => document.getElementById('searchModal').classList.add('hidden')
        };

        window.app = {
            login: async () => { try { await signInWithEmailAndPassword(auth, document.getElementById('lEmail').value, document.getElementById('lPass').value); } catch(e){ Swal.fire('Error','‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','error'); } },
            register: async () => {
                try {
                    const res = await createUserWithEmailAndPassword(auth, document.getElementById('rEmail').value, document.getElementById('rPass').value);
                    await setDoc(doc(db, "users", res.user.uid), { displayName: document.getElementById('rName').value, email: res.user.email, expiryDate: null, planName: 'Free User' });
                    location.reload();
                } catch(e){ Swal.fire('Error',e.message,'error'); }
            },
            logout: () => signOut(auth).then(()=>location.reload()),

            // üõ† ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å System Config ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            contactAdmin: async () => {
                try {
                    const docSnap = await getDoc(doc(db, "system", "config"));
                    if (docSnap.exists()) {
                        const link = docSnap.data().fb || docSnap.data().line;
                        if(link) { window.open(link, '_blank'); return; }
                    }
                    Swal.fire('Info', '‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠', 'info');
                } catch(e) { window.open('https://m.me/yourpage', '_blank'); }
            },

            filterAssets: (q) => {
                const list = document.getElementById('searchResults'); list.innerHTML = '';
                assetsList.filter(a => a.s.includes(q.toUpperCase())).forEach(a => {
                    list.innerHTML += `<div onclick="app.selectAsset('${a.s}')" class="p-4 rounded-xl bg-white/5 text-white font-bold cursor-pointer">${a.s}</div>`;
                });
            },
            selectAsset: (s) => { curAsset = s; document.getElementById('assetName').innerText = s; ui.closeSearch(); app.fetchPrice(); },
            fetchPrice: async () => {
                try {
                    const ticker = curAsset === 'XAUUSD' ? 'PAXGUSDT' : curAsset;
                    const res = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${ticker}`);
                    const d = await res.json();
                    document.getElementById('livePrice').innerText = parseFloat(d.price).toFixed(2);
                } catch(e) {}
            },
            setTime: (m) => {
                document.querySelectorAll('.time-btn').forEach(b => {
                    b.classList.remove('bg-gold', 'text-black');
                    if(b.innerText.includes(m)) b.classList.add('bg-gold', 'text-black');
                });
                document.getElementById('selectedTime').value = m;
            },
            renderChart: () => {
                const mount = document.getElementById('tv-mount'); mount.innerHTML = '';
                const script = document.createElement('script'); script.src = "https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js";
                script.async = true;
                script.innerHTML = JSON.stringify({ "autosize": true, "symbol": "BINANCE:"+curAsset, "interval": "15", "theme": "dark", "style": "1", "locale": "th" });
                mount.appendChild(script);
            },
            checkSubscription: () => {
                const expiry = userData?.expiryDate ? userData.expiryDate.toDate() : null;
                if (!expiry || expiry < new Date()) {
                    Swal.fire({ title: 'Expired', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡πà‡∏≠‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', icon: 'error', confirmButtonText: '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô' }).then(r => { if(r.isConfirmed) app.contactAdmin(); });
                    return;
                }
                app.runAI();
            },
            runAI: async () => {
                const mins = parseInt(document.getElementById('selectedTime').value);
                const modal = document.getElementById('aiModal');
                modal.classList.remove('hidden');
                document.getElementById('scan-ui').classList.remove('hidden');
                document.getElementById('result-ui').classList.add('hidden');
                await new Promise(r => setTimeout(r, 2000));
                document.getElementById('scan-ui').classList.add('hidden');
                document.getElementById('result-ui').classList.remove('hidden');
                document.getElementById('resType').innerText = Math.random() > 0.5 ? 'BUY' : 'SELL';
                document.getElementById('resAsset').innerText = curAsset;
                document.getElementById('resId').innerText = Math.floor(Math.random()*900)+100;
            }
        };

        onAuthStateChanged(auth, u => {
            if(u) {
                document.getElementById('authPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                onSnapshot(doc(db, "users", u.uid), s => {
                    if(s.exists()){
                        userData = s.data();
                        document.getElementById('headerAvatar').src = `https://ui-avatars.com/api/?name=${userData.displayName}&background=000&color=FFD700`;
                        document.getElementById('pName').innerText = userData.displayName;
                        document.getElementById('pEmail').innerText = userData.email;
                        
                        const now = new Date();
                        const expiry = userData.expiryDate ? userData.expiryDate.toDate() : null;
                        if(expiry) startExpiryCountdown(expiry);

                        const badge = document.getElementById('statusBadge');
                        const isActive = expiry && expiry > now;
                        if(isActive) {
                            badge.innerHTML = `<span class="w-2 h-2 rounded-full bg-green-500"></span> ONLINE`;
                            document.getElementById('pPlan').innerText = userData.planName + " (ACTIVE)";
                            document.getElementById('lockMessage').classList.add('hidden');
                        } else {
                            badge.innerHTML = `<span class="w-2 h-2 rounded-full bg-red-500"></span> EXPIRED`;
                            document.getElementById('pPlan').innerText = "EXPIRED";
                            document.getElementById('lockMessage').classList.remove('hidden');
                        }
                    }
                });
                app.fetchPrice(); setInterval(app.fetchPrice, 5000);
            } else {
                document.getElementById('authPage').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
            setTimeout(() => document.getElementById('loader').classList.add('opacity-0', 'pointer-events-none'), 1500);
        });
    </script>
</body>
</html>
