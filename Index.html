<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RS INFINITY V7 PRO</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <style>
        /* --- CORE THEME --- */
        :root {
            --gold: #FFD700;
            --gold-glow: rgba(255, 215, 0, 0.4);
            --bg-deep: #050505;
            --glass: rgba(18, 18, 18, 0.85);
            --neon-green: #00ff9d;
            --neon-red: #ff0055;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-deep);
            background-image: radial-gradient(circle at 50% 10%, #1a1a1a 0%, #000 100%);
            color: white;
            height: 100dvh;
            overflow: hidden;
        }

        .font-tech { font-family: 'Rajdhani', sans-serif; }
        .hide-scroll::-webkit-scrollbar { display: none; }

        /* --- UI COMPONENTS --- */
        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        /* ปุ่มกด Animation (Click Effect) */
        .btn-effect {
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .btn-effect:active {
            transform: scale(0.95);
        }
        .btn-effect::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        .btn-effect:active::after {
            width: 200%; height: 200%;
        }

        /* Gold Button */
        .btn-gold {
            background: linear-gradient(135deg, #FFD700 0%, #d4af37 100%);
            color: black;
            font-weight: bold;
            box-shadow: 0 0 15px var(--gold-glow);
        }

        /* --- ANIMATIONS --- */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px var(--gold-glow); }
            50% { box-shadow: 0 0 25px var(--gold-glow); }
        }
        @keyframes scan-line {
            0% { top: 0%; opacity: 0; }
            50% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        
        .animate-scan {
            animation: scan-line 2s linear infinite;
        }

        /* Chart Fullscreen Fix */
        .full-chart-height {
            height: calc(100dvh - 80px); /* ลบความสูง Nav bar */
        }
    </style>
</head>
<body class="flex flex-col">

    <div id="auth-screen" class="fixed inset-0 z-50 bg-black flex flex-col justify-center items-center p-6 bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')]">
        <div class="mb-8 text-center relative">
            <div class="absolute inset-0 bg-yellow-500 blur-[60px] opacity-20 rounded-full"></div>
            <i class="fa-solid fa-microchip text-6xl text-yellow-500 mb-4 relative z-10 drop-shadow-[0_0_15px_rgba(255,215,0,0.8)]"></i>
            <h1 class="text-4xl font-black italic tracking-tighter relative z-10">RS <span class="text-yellow-500">INFINITY</span></h1>
            <p class="text-xs text-gray-400 font-tech tracking-[0.5em] mt-2">AI TRADING V7 PRO</p>
        </div>

        <div class="glass-panel w-full max-w-sm p-8">
            <h2 id="auth-title" class="text-xl font-bold text-center mb-6">เข้าระบบสมาชิก</h2>
            <form id="auth-form" class="space-y-4">
                <div id="field-username" class="hidden">
                    <input type="text" id="inp-username" placeholder="ตั้งชื่อผู้ใช้" class="w-full bg-black/50 border border-gray-700 p-3 rounded-xl text-white focus:border-yellow-500 outline-none">
                </div>
                <input type="email" id="inp-email" required placeholder="อีเมล" class="w-full bg-black/50 border border-gray-700 p-3 rounded-xl text-white focus:border-yellow-500 outline-none">
                <input type="password" id="inp-password" required placeholder="รหัสผ่าน" class="w-full bg-black/50 border border-gray-700 p-3 rounded-xl text-white focus:border-yellow-500 outline-none">
                
                <button type="submit" id="btn-submit" class="btn-effect btn-gold w-full py-3 rounded-xl">เข้าสู่ระบบ</button>
            </form>
            <div class="mt-4 text-center">
                <button onclick="toggleAuth()" id="auth-toggle" class="text-sm text-yellow-500/80 hover:text-white underline">สมัครสมาชิกใหม่</button>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden flex flex-col h-full relative">
        
        <header class="flex justify-between items-center p-4 bg-black/40 backdrop-blur-md border-b border-white/5 sticky top-0 z-20">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-yellow-600 to-yellow-400 p-[2px]">
                    <img src="https://api.dicebear.com/7.x/bottts/svg?seed=RS" class="w-full h-full bg-black rounded-full">
                </div>
                <div>
                    <div id="disp-username" class="font-bold text-sm">Guest</div>
                    <div class="flex items-center gap-1">
                        <div id="status-dot" class="w-2 h-2 rounded-full bg-red-500"></div>
                        <span id="status-text" class="text-[10px] text-gray-400 uppercase">EXPIRED</span>
                    </div>
                </div>
            </div>
            
            <div class="glass-panel px-3 py-1 flex items-center gap-2">
                <i class="fa-regular fa-clock text-yellow-500 text-xs"></i>
                <span id="header-timer" class="font-tech text-yellow-500 font-bold text-sm">00:00:00</span>
            </div>
        </header>

        <main class="flex-1 overflow-y-auto hide-scroll bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]">
            
            <div id="tab-home" class="p-5 space-y-6 pb-24">
                
                <div class="glass-panel p-4 border-l-4 border-yellow-500 relative overflow-hidden">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xs font-bold text-yellow-500 uppercase flex items-center gap-2">
                            <i class="fa-solid fa-brain"></i> AI Market Insight
                        </h3>
                        <span class="text-[10px] text-gray-500 animate-pulse">LIVE UPDATING</span>
                    </div>
                    <p id="ai-insight-text" class="text-sm text-gray-200 leading-relaxed">
                        วิเคราะห์ตลาด: สภาพคล่องเริ่มสูงในคู่เงิน EUR/USD และ Gold แนะนำให้จับตา Timeframe 15m มีโอกาสกลับตัวสูง...
                    </p>
                </div>

                <div class="flex flex-col items-center justify-center py-4">
                    <div class="relative group">
                        <div class="absolute inset-0 bg-yellow-500/20 rounded-full blur-xl group-hover:bg-yellow-500/40 transition-all duration-500"></div>
                        <div class="absolute inset-[-10px] border border-yellow-500/30 rounded-full animate-[spin_8s_linear_infinite]"></div>
                        
                        <button onclick="openAssetSelect()" id="btn-scan-main" class="btn-effect relative w-44 h-44 rounded-full bg-gradient-to-b from-[#222] to-[#000] border-2 border-[#333] flex flex-col items-center justify-center z-10 shadow-2xl">
                            <i class="fa-solid fa-fingerprint text-5xl text-gray-500 group-hover:text-yellow-500 transition-colors duration-300"></i>
                            <span class="mt-3 text-lg font-bold text-white tracking-widest">START SCAN</span>
                            <span class="text-[10px] text-gray-500 font-tech">AI ALGORITHM V7</span>
                            
                            <div id="lock-overlay" class="absolute inset-0 bg-black/80 backdrop-blur-sm rounded-full flex flex-col items-center justify-center z-20">
                                <i class="fa-solid fa-lock text-2xl text-red-500 mb-1"></i>
                                <span class="text-xs text-red-500 font-bold">EXPIRED</span>
                            </div>
                        </button>
                    </div>
                </div>

                <div>
                    <h3 class="text-gray-400 text-xs uppercase font-bold mb-3 tracking-wider">Last AI Signals</h3>
                    <div class="space-y-3">
                        <div class="glass-panel p-3 flex items-center justify-between border-l-2 border-green-500">
                            <div class="flex items-center gap-3">
                                <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" class="w-8 h-8 rounded-full">
                                <div>
                                    <div class="font-bold text-sm">BTC/USDT</div>
                                    <div class="text-[10px] text-green-400">TP HIT (+1.5%)</div>
                                </div>
                            </div>
                            <span class="text-xs font-tech text-gray-400">5 min ago</span>
                        </div>
                        <div class="glass-panel p-3 flex items-center justify-between border-l-2 border-green-500">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-yellow-500/20 flex items-center justify-center border border-yellow-500/50 text-[10px] font-bold text-yellow-500">GLD</div>
                                <div>
                                    <div class="font-bold text-sm">XAU/USD</div>
                                    <div class="text-[10px] text-green-400">TP HIT (+0.8%)</div>
                                </div>
                            </div>
                            <span class="text-xs font-tech text-gray-400">12 min ago</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-chart" class="hidden h-full flex flex-col">
                <div class="bg-black/80 p-2 flex gap-2 overflow-x-auto border-b border-white/10">
                    <button onclick="changeChart('BTCUSDT')" class="px-3 py-1 rounded bg-gray-800 text-xs text-gray-300 hover:text-yellow-500">BTC</button>
                    <button onclick="changeChart('ETHUSDT')" class="px-3 py-1 rounded bg-gray-800 text-xs text-gray-300 hover:text-yellow-500">ETH</button>
                    <button onclick="changeChart('XAUUSD')" class="px-3 py-1 rounded bg-gray-800 text-xs text-gray-300 hover:text-yellow-500">GOLD</button>
                    <button onclick="changeChart('EURUSD')" class="px-3 py-1 rounded bg-gray-800 text-xs text-gray-300 hover:text-yellow-500">EURUSD</button>
                </div>
                <div id="tv-chart-container" class="flex-1 bg-black w-full relative"></div>
            </div>

            <div id="tab-profile" class="hidden p-5 space-y-6 pb-24">
                <div class="glass-panel p-6 text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-yellow-500 to-transparent"></div>
                    <div class="w-24 h-24 mx-auto rounded-full p-1 border-2 border-dashed border-yellow-500 mb-4">
                        <img src="https://api.dicebear.com/7.x/bottts/svg?seed=RS" class="w-full h-full rounded-full bg-gray-900">
                    </div>
                    <h2 id="profile-name" class="text-xl font-bold text-white">Loading...</h2>
                    <div class="inline-block mt-2 px-3 py-1 rounded-full bg-yellow-500/10 border border-yellow-500/30 text-yellow-500 text-xs font-bold tracking-wider">
                        PREMIUM MEMBER
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <a id="btn-line" href="#" target="_blank" class="btn-effect glass-panel p-4 flex flex-col items-center justify-center gap-2 hover:border-green-500 transition">
                        <i class="fa-brands fa-line text-3xl text-green-500"></i>
                        <span class="text-xs font-bold">ติดต่อ LINE</span>
                    </a>
                    <a id="btn-fb" href="#" target="_blank" class="btn-effect glass-panel p-4 flex flex-col items-center justify-center gap-2 hover:border-blue-500 transition">
                        <i class="fa-brands fa-facebook text-3xl text-blue-500"></i>
                        <span class="text-xs font-bold">ติดต่อ Facebook</span>
                    </a>
                </div>

                <button onclick="logout()" class="btn-effect w-full glass-panel p-4 flex items-center justify-center gap-2 text-red-500 border-red-900/30 hover:bg-red-900/10">
                    <i class="fa-solid fa-power-off"></i>
                    <span class="font-bold">ออกจากระบบ</span>
                </button>
            </div>
        </main>

        <nav class="h-[80px] bg-[#020202] border-t border-white/10 grid grid-cols-3 items-center pb-4 px-2 z-30">
            <button onclick="nav('home')" id="nav-home" class="btn-effect flex flex-col items-center gap-1 text-yellow-500">
                <i class="fa-solid fa-house text-xl mb-1"></i>
                <span class="text-[10px] font-medium">หน้าหลัก</span>
            </button>
            <button onclick="nav('chart')" id="nav-chart" class="btn-effect flex flex-col items-center gap-1 text-gray-600">
                <i class="fa-solid fa-chart-simple text-xl mb-1"></i>
                <span class="text-[10px] font-medium">กราฟเต็มจอ</span>
            </button>
            <button onclick="nav('profile')" id="nav-profile" class="btn-effect flex flex-col items-center gap-1 text-gray-600">
                <i class="fa-solid fa-user-gear text-xl mb-1"></i>
                <span class="text-[10px] font-medium">โปรไฟล์</span>
            </button>
        </nav>
    </div>

    <div id="modal-assets" class="hidden fixed inset-0 z-50 bg-black/90 backdrop-blur-md flex items-end sm:items-center justify-center">
        <div class="w-full sm:w-[400px] bg-[#111] rounded-t-3xl border-t border-yellow-500/30 p-6 animate-[slideInUp_0.3s]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-white"><i class="fa-solid fa-earth-americas text-yellow-500 mr-2"></i>เลือกสินทรัพย์</h3>
                <button onclick="closeModal('modal-assets')" class="text-gray-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>

            <div class="grid grid-cols-3 gap-3 mb-6">
                <button onclick="selectAsset('BTCUSDT', 'Bitcoin')" class="btn-effect glass-panel p-3 flex flex-col items-center gap-2 hover:border-yellow-500">
                    <img src="https://cryptologos.cc/logos/bitcoin-btc-logo.png" class="w-8 h-8">
                    <span class="text-xs font-bold">BTC</span>
                </button>
                <button onclick="selectAsset('ETHUSDT', 'Ethereum')" class="btn-effect glass-panel p-3 flex flex-col items-center gap-2 hover:border-yellow-500">
                    <img src="https://cryptologos.cc/logos/ethereum-eth-logo.png" class="w-8 h-8">
                    <span class="text-xs font-bold">ETH</span>
                </button>
                <button onclick="selectAsset('XRPUSDT', 'Ripple')" class="btn-effect glass-panel p-3 flex flex-col items-center gap-2 hover:border-yellow-500">
                    <img src="https://cryptologos.cc/logos/xrp-xrp-logo.png" class="w-8 h-8">
                    <span class="text-xs font-bold">XRP</span>
                </button>
                <button onclick="selectAsset('XAUUSD', 'Gold')" class="btn-effect glass-panel p-3 flex flex-col items-center gap-2 border-yellow-500/20 hover:border-yellow-500">
                    <div class="w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center text-black font-bold text-[10px]">GOLD</div>
                    <span class="text-xs font-bold text-yellow-500">GOLD</span>
                </button>
                <button onclick="selectAsset('EURUSD', 'EUR/USD')" class="btn-effect glass-panel p-3 flex flex-col items-center gap-2 hover:border-yellow-500">
                    <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-[10px]">$</div>
                    <span class="text-xs font-bold">EU</span>
                </button>
                <button onclick="selectAsset('GBPUSD', 'GBP/USD')" class="btn-effect glass-panel p-3 flex flex-col items-center gap-2 hover:border-yellow-500">
                    <div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center text-white font-bold text-[10px]">$</div>
                    <span class="text-xs font-bold">GU</span>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="text-xs text-gray-500 mb-2 block">Timeframe</label>
                    <div class="flex gap-2">
                        <button class="flex-1 py-2 bg-gray-800 rounded text-xs border border-gray-700 focus:bg-yellow-500 focus:text-black focus:border-yellow-500 transition">5M</button>
                        <button class="flex-1 py-2 bg-gray-800 rounded text-xs border border-gray-700 focus:bg-yellow-500 focus:text-black focus:border-yellow-500 transition">15M</button>
                        <button class="flex-1 py-2 bg-gray-800 rounded text-xs border border-gray-700 focus:bg-yellow-500 focus:text-black focus:border-yellow-500 transition">1H</button>
                    </div>
                </div>
                <button id="btn-start-process" class="btn-effect btn-gold w-full py-4 rounded-xl text-lg flex items-center justify-center gap-2">
                    <i class="fa-solid fa-bolt"></i> เริ่มวิเคราะห์ทันที
                </button>
            </div>
        </div>
    </div>

    <div id="screen-process" class="hidden fixed inset-0 z-[60] bg-black flex flex-col font-tech">
        <div class="h-16 flex items-center justify-between px-6 border-b border-gray-800">
            <span class="text-yellow-500 font-bold animate-pulse">AI PROCESSING...</span>
            <span id="proc-target" class="text-white font-bold">BTC/USDT</span>
        </div>
        
        <div class="h-[35%] w-full relative border-b border-gray-800 bg-[#0a0a0a]">
            <div id="tv-mini-chart" class="w-full h-full opacity-50 pointer-events-none"></div>
            <div class="absolute inset-0 w-[2px] bg-yellow-500 h-full left-1/2 blur-[2px] animate-scan shadow-[0_0_15px_#FFD700]"></div>
            <div class="absolute bottom-2 right-2 text-[10px] text-yellow-500">SCANNING PIVOT POINTS...</div>
        </div>

        <div class="flex-1 p-6 space-y-3 relative overflow-hidden">
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
            
            <div id="logs-container" class="relative z-10 text-xs font-mono space-y-2">
                <div class="text-green-500">> Connecting to Global Exchange API... [OK]</div>
                <div id="log-1" class="text-gray-400 opacity-0 transition">> Fetching Volatility Index...</div>
                <div id="log-2" class="text-gray-400 opacity-0 transition">> Analyzing EMA (50, 200) Crossover...</div>
                <div id="log-3" class="text-yellow-500 opacity-0 transition">> DETECTED: Bullish Divergence on RSI</div>
                <div id="log-4" class="text-blue-400 opacity-0 transition">> Calculating Optimal Entry/Exit...</div>
                <div id="log-5" class="text-white font-bold border-t border-gray-700 pt-2 opacity-0 transition mt-4">> GENERATING SIGNAL [100%]</div>
            </div>
        </div>
    </div>

    <div id="modal-result" class="hidden fixed inset-0 z-[70] bg-black/95 backdrop-blur-xl flex items-center justify-center p-4">
        <div class="w-full max-w-md glass-panel border border-yellow-500/50 relative overflow-hidden animate-[zoomIn_0.4s]">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 via-yellow-500 to-green-500"></div>

            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <div class="text-xs text-gray-400">AI RECOMMENDATION</div>
                    <div class="px-2 py-0.5 rounded bg-yellow-500/20 text-yellow-500 text-[10px] border border-yellow-500/50">CONFIDENCE 96%</div>
                </div>

                <div class="text-center mb-6">
                    <div id="res-pair-name" class="text-xl font-bold text-white mb-2">BTC/USDT</div>
                    <div id="res-action-bg" class="inline-flex items-center gap-3 px-6 py-2 rounded-full bg-green-500/20 border border-green-500 text-green-500 mb-2">
                        <i id="res-icon" class="fa-solid fa-arrow-up text-2xl"></i>
                        <span id="res-action-text" class="text-3xl font-black italic">BUY</span>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-black/40 p-3 rounded-lg border border-white/5">
                        <div class="text-[10px] text-gray-500">ENTRY (จุดเข้า)</div>
                        <div class="text-lg font-bold text-white">Market Price</div>
                    </div>
                    <div class="bg-black/40 p-3 rounded-lg border border-white/5">
                        <div class="text-[10px] text-gray-500">DURATION (ระยะเวลา)</div>
                        <div class="text-lg font-bold text-yellow-500 font-tech">15 - 30 Min</div>
                    </div>
                </div>

                <div class="space-y-2 mb-6">
                    <div class="flex justify-between items-center p-2 rounded bg-green-900/10 border border-green-500/20">
                        <span class="text-xs text-green-400">TP (จุดทำกำไร)</span>
                        <span id="res-tp" class="text-sm font-bold text-white">Target +1.5%</span>
                    </div>
                    <div class="flex justify-between items-center p-2 rounded bg-red-900/10 border border-red-500/20">
                        <span class="text-xs text-red-400">SL (จุดตัดขาดทุน)</span>
                        <span id="res-sl" class="text-sm font-bold text-white">Low of prev candle</span>
                    </div>
                </div>

                <div class="mb-6">
                    <div class="text-[10px] text-gray-500 mb-1">TECHNICAL REASON (เหตุผล)</div>
                    <p id="res-reason" class="text-xs text-gray-300 leading-relaxed">
                        กราฟเกิดรูปแบบกลับตัว Bullish Engulfing ที่แนวรับสำคัญ RSI เริ่มยกตัวออกจากโซน Oversold พร้อม Volume ซื้อกลับเข้ามาสนับสนุน
                    </p>
                </div>

                <button onclick="closeResult()" class="btn-effect w-full py-3 bg-gray-800 hover:bg-gray-700 rounded-xl text-white font-bold">รับทราบ</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBNfTBQthLLRbJP9BXZ-UQptFsdU324Mv0",
            authDomain: "fafada-d9899.firebaseapp.com",
            projectId: "fafada-d9899",
            storageBucket: "fafada-d9899.appspot.com",
            messagingSenderId: "484777586908",
            appId: "1:484777586908:web:16a8f0367ad15737364419"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- STATE VARIABLES ---
        let isExpired = true;
        let selectedPair = "";
        let selectedPairName = "";

        // --- AUTH ---
        let isRegister = false;
        window.toggleAuth = () => {
            isRegister = !isRegister;
            document.getElementById('field-username').classList.toggle('hidden');
            document.getElementById('auth-title').innerText = isRegister ? "สมัครสมาชิกใหม่" : "เข้าระบบสมาชิก";
            document.getElementById('btn-submit').innerText = isRegister ? "ยืนยันการสมัคร" : "เข้าสู่ระบบ";
            document.getElementById('auth-toggle').innerText = isRegister ? "มีบัญชีอยู่แล้ว? เข้าสู่ระบบ" : "สมัครสมาชิกใหม่";
        }

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('inp-email').value;
            const pass = document.getElementById('inp-password').value;
            const btn = document.getElementById('btn-submit');
            
            try {
                btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> รอสักครู่...';
                if(isRegister) {
                    const name = document.getElementById('inp-username').value;
                    const cred = await createUserWithEmailAndPassword(auth, email, pass);
                    // Register = Expired by default
                    const past = new Date(); past.setDate(past.getDate() - 1);
                    await setDoc(doc(db, "users", cred.user.uid), {
                        username: name, email, expiryDate: past, createdAt: serverTimestamp()
                    });
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                }
            } catch(err) {
                alert(err.message);
                btn.innerText = "ลองใหม่";
            }
        });

        window.logout = () => signOut(auth);

        // --- APP LOGIC ---
        onAuthStateChanged(auth, (user) => {
            if(user) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                loadUserData(user.uid);
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('app-container').classList.add('hidden');
            }
        });

        function loadUserData(uid) {
            // User Data
            onSnapshot(doc(db, "users", uid), (snap) => {
                if(snap.exists()) {
                    const d = snap.data();
                    document.getElementById('disp-username').innerText = d.username || "User";
                    document.getElementById('profile-name').innerText = d.username || "User";
                    checkExpiry(d.expiryDate.toDate());
                }
            });

            // System Config (Admin Links)
            onSnapshot(doc(db, "system", "config"), (snap) => {
                if(snap.exists()) {
                    const cfg = snap.data();
                    document.getElementById('btn-line').href = cfg.lineLink || "#";
                    document.getElementById('btn-fb').href = cfg.fbLink || "#";
                }
            });

            // Load Initial Chart
            loadChart('BTCUSDT', 'tv-chart-container');
            
            // Randomize AI Insight Text
            setInterval(updateInsight, 10000);
            updateInsight();
        }

        function checkExpiry(date) {
            const now = new Date();
            const diff = date - now;
            
            if(diff <= 0) {
                isExpired = true;
                document.getElementById('status-text').innerText = "EXPIRED";
                document.getElementById('status-dot').className = "w-2 h-2 rounded-full bg-red-500";
                document.getElementById('lock-overlay').classList.remove('hidden');
                document.getElementById('header-timer').innerText = "00:00:00";
                document.getElementById('header-timer').classList.add('text-red-500');
            } else {
                isExpired = false;
                document.getElementById('status-text').innerText = "ONLINE";
                document.getElementById('status-dot').className = "w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#0f0]";
                document.getElementById('lock-overlay').classList.add('hidden');
                document.getElementById('header-timer').classList.remove('text-red-500');
                
                // Countdown Loop
                setInterval(() => {
                    const n = new Date();
                    const d = date - n;
                    if(d > 0) {
                        const h = Math.floor((d % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const m = Math.floor((d % (1000 * 60 * 60)) / (1000 * 60));
                        const s = Math.floor((d % (1000 * 60)) / 1000);
                        document.getElementById('header-timer').innerText = `${pad(h)}:${pad(m)}:${pad(s)}`;
                    }
                }, 1000);
            }
        }
        function pad(n) { return n < 10 ? '0'+n : n; }

        function updateInsight() {
            const msgs = [
                "สภาพคล่อง BTC เริ่มสูง แนะนำ Timeframe 15M...",
                "ระวังข่าวเศรษฐกิจ USD อาจเกิดความผันผวนรุนแรง...",
                "GOLD มีแรงซื้อที่แนวรับสำคัญ 2025.50...",
                "AI ตรวจพบสัญญาณ Divergence ในคู่ EUR/USD..."
            ];
            document.getElementById('ai-insight-text').innerText = msgs[Math.floor(Math.random()*msgs.length)];
        }

        // --- NAVIGATION ---
        window.nav = (page) => {
            ['home', 'chart', 'profile'].forEach(p => document.getElementById('tab-'+p).classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-yellow-500', 'text-gray-600'));
            
            document.getElementById('tab-'+page).classList.remove('hidden');
            document.getElementById('nav-'+page).classList.replace('text-gray-600', 'text-yellow-500');
            
            if(page === 'chart') loadChart('BTCUSDT', 'tv-chart-container');
        }

        // --- SCANNER SYSTEM ---
        window.openAssetSelect = () => {
            if(isExpired) return alert("กรุณาต่ออายุการใช้งาน");
            document.getElementById('modal-assets').classList.remove('hidden');
        }
        window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
        window.closeResult = () => document.getElementById('modal-result').classList.add('hidden');

        window.selectAsset = (pair, name) => {
            selectedPair = pair;
            selectedPairName = name;
            // Highlight logic here if needed (omitted for brevity)
        }

        document.getElementById('btn-start-process').addEventListener('click', () => {
            if(!selectedPair) return alert("กรุณาเลือกเหรียญ");
            closeModal('modal-assets');
            
            const proc = document.getElementById('screen-process');
            proc.classList.remove('hidden');
            document.getElementById('proc-target').innerText = selectedPair;
            loadChart(selectedPair, 'tv-mini-chart', true); // Mini Chart

            // Fake Logs Sequence
            setTimeout(() => document.getElementById('log-1').style.opacity=1, 800);
            setTimeout(() => document.getElementById('log-2').style.opacity=1, 1600);
            setTimeout(() => document.getElementById('log-3').style.opacity=1, 2400);
            setTimeout(() => document.getElementById('log-4').style.opacity=1, 3200);
            setTimeout(() => document.getElementById('log-5').style.opacity=1, 4000);

            setTimeout(() => {
                proc.classList.add('hidden');
                showResult();
            }, 4500);
        });

        function showResult() {
            const isBuy = Math.random() > 0.5;
            document.getElementById('res-pair-name').innerText = selectedPair;
            
            const bg = document.getElementById('res-action-bg');
            const icon = document.getElementById('res-icon');
            const txt = document.getElementById('res-action-text');
            const reason = document.getElementById('res-reason');

            if(isBuy) {
                bg.className = "inline-flex items-center gap-3 px-6 py-2 rounded-full bg-green-500/20 border border-green-500 text-green-500 mb-2";
                icon.className = "fa-solid fa-arrow-up text-2xl";
                txt.innerText = "BUY";
                reason.innerText = "กราฟยืนเหนือ EMA 200 เกิดสัญญาณ Golden Cross พร้อมแรงซื้อ Volume สูง";
                document.getElementById('res-tp').innerText = "Next Resistance / +1.2%";
                document.getElementById('res-sl').innerText = "Recent Swing Low";
            } else {
                bg.className = "inline-flex items-center gap-3 px-6 py-2 rounded-full bg-red-500/20 border border-red-500 text-red-500 mb-2";
                icon.className = "fa-solid fa-arrow-down text-2xl";
                txt.innerText = "SELL";
                reason.innerText = "ราคาติดแนวต้านสำคัญ เกิดแท่งเทียน Bearish Engulfing และ RSI ทำ Bearish Divergence";
                document.getElementById('res-tp').innerText = "Next Support / -1.0%";
                document.getElementById('res-sl').innerText = "Recent Swing High";
            }

            document.getElementById('modal-result').classList.remove('hidden');
        }

        // --- TRADING VIEW ---
        window.changeChart = (pair) => loadChart(pair, 'tv-chart-container');

        window.loadChart = (symbol, containerId, isMini = false) => {
            let tvSym = "BINANCE:" + symbol;
            if(symbol === "XAUUSD") tvSym = "OANDA:XAUUSD";
            if(symbol.includes("USD") && !symbol.includes("USDT")) tvSym = "FX:" + symbol;

            new TradingView.widget({
                "container_id": containerId,
                "autosize": true,
                "symbol": tvSym,
                "interval": "15",
                "timezone": "Asia/Bangkok",
                "theme": "dark",
                "style": "1",
                "locale": "th_TH",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "hide_top_toolbar": isMini,
                "hide_legend": isMini,
                "save_image": false,
                "backgroundColor": "#000000"
            });
        }
    </script>
</body>
</html>
