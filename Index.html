<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LOADING...</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --gold: #D4AF37; --bg: #050505; --card: #121212; 
        }
        body { font-family: 'Kanit', sans-serif; background-color: var(--bg); color: #fff; overflow-x: hidden; }
        
        /* Design Elements */
        .glass-panel {
            background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(15px); border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .text-gold { color: var(--gold); }
        .bg-gold-grad { background: linear-gradient(135deg, #D4AF37 0%, #AA8A26 100%); }
        
        .input-lux {
            background: #0a0a0a; border: 1px solid #333; color: white;
            padding: 14px; border-radius: 12px; width: 100%; transition: 0.3s; outline: none;
        }
        .input-lux:focus { border-color: var(--gold); }

        .btn-main {
            background: linear-gradient(to right, var(--gold), #bfa15f); color: black; 
            font-weight: 800; padding: 12px; border-radius: 12px; width: 100%; 
            transition: 0.2s; box-shadow: 0 5px 15px rgba(212, 175, 55, 0.2);
        }
        .btn-main:active { transform: scale(0.97); }

        /* Loader & Maintenance */
        #loader { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .spinner { width: 40px; height: 40px; border: 3px solid #333; border-top-color: var(--gold); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }

        #maint-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body class="pb-24">

    <div id="loader">
        <div class="spinner"></div>
        <p class="absolute mt-16 text-[#D4AF37] text-xs tracking-widest animate-pulse">LOADING SYSTEM</p>
    </div>

    <div id="maint-overlay" class="hidden">
        <i class="fa-solid fa-screwdriver-wrench text-6xl text-[#D4AF37] mb-6 animate-pulse"></i>
        <h1 class="text-3xl font-bold text-white mb-2">‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</h1>
        <p class="text-gray-500 text-sm mb-8">System Under Maintenance</p>
        <button onclick="UI.contact()" class="border border-[#D4AF37] text-[#D4AF37] px-8 py-2 rounded-full hover:bg-[#D4AF37] hover:text-black transition">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
    </div>

    <div id="auth-view" class="fixed inset-0 z-50 flex items-center justify-center p-6 hidden bg-black">
        <div class="glass-panel w-full max-w-sm p-8 text-center animate__animated animate__fadeInUp">
            <h1 id="site-title-auth" class="text-4xl font-black text-gold mb-2">ARENA</h1>
            <p class="text-gray-500 text-xs mb-8 tracking-widest">MEMBER LOGIN</p>

            <div id="form-login">
                <input id="l-email" class="input-lux mb-4" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ / ‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                <input id="l-pass" type="password" class="input-lux mb-6" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                <button onclick="Auth.login()" class="btn-main">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                <p class="mt-6 text-xs text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <span onclick="UI.toggleAuth('reg')" class="text-[#D4AF37] cursor-pointer hover:underline font-bold">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span></p>
            </div>

            <div id="form-reg" class="hidden space-y-3">
                <input id="r-name" class="input-lux" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
                <input id="r-email" class="input-lux" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                <input id="r-pass" type="password" class="input-lux" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (6 ‡∏ï‡∏±‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)">
                <div class="grid grid-cols-2 gap-2">
                    <select id="r-bank" class="input-lux text-xs"><option>KBANK</option><option>SCB</option><option>BBL</option><option>WALLET</option></select>
                    <input id="r-acc" class="input-lux" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">
                </div>
                <button onclick="Auth.register()" class="btn-main mt-4">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£</button>
                <p class="mt-4 text-xs text-gray-500 cursor-pointer" onclick="UI.toggleAuth('log')">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</p>
            </div>
        </div>
    </div>

    <div id="app-view" class="hidden max-w-md mx-auto min-h-screen relative shadow-2xl border-x border-[#222]">
        
        <header class="p-6 bg-gradient-to-b from-[#111] to-transparent sticky top-0 z-40 backdrop-blur-lg">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-11 h-11 rounded-full p-[2px] bg-gold-grad">
                        <img id="u-img" class="w-full h-full rounded-full object-cover bg-black">
                    </div>
                    <div>
                        <p class="text-[10px] text-[#D4AF37] font-bold tracking-widest">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                        <p id="u-bal" class="text-2xl font-bold text-white tracking-tight">‡∏ø0.00</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="UI.contact()" class="w-9 h-9 rounded-lg bg-[#D4AF37]/10 text-[#D4AF37] flex items-center justify-center"><i class="fa-brands fa-line"></i></button>
                    <button onclick="Auth.logout()" class="w-9 h-9 rounded-lg bg-red-900/20 text-red-500 flex items-center justify-center"><i class="fa-solid fa-power-off"></i></button>
                </div>
            </div>
            <div class="mt-4 bg-[#D4AF37]/5 border-l-2 border-[#D4AF37] py-1 px-3 rounded overflow-hidden">
                <marquee id="site-ann" class="text-xs text-gray-400">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...</marquee>
            </div>
        </header>

        <main class="px-5 space-y-6">
            
            <section id="p-home" class="animate__animated animate__fadeIn">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <button onclick="UI.page('deposit')" class="glass-panel p-4 flex flex-col items-center gap-2 hover:bg-[#222] transition border border-transparent hover:border-green-900">
                        <div class="w-12 h-12 rounded-full bg-green-500/10 text-green-500 flex items-center justify-center text-xl"><i class="fa-solid fa-circle-arrow-down"></i></div>
                        <span class="font-bold text-sm">‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</span>
                    </button>
                    <button onclick="UI.page('withdraw')" class="glass-panel p-4 flex flex-col items-center gap-2 hover:bg-[#222] transition border border-transparent hover:border-red-900">
                        <div class="w-12 h-12 rounded-full bg-red-500/10 text-red-500 flex items-center justify-center text-xl"><i class="fa-solid fa-circle-arrow-up"></i></div>
                        <span class="font-bold text-sm">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                    </button>
                </div>

                <div class="mb-8">
                    <h3 class="font-bold text-[#D4AF37] mb-3 flex items-center gap-2"><i class="fa-solid fa-gift"></i> ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
                    <div id="promo-list" class="space-y-3"></div>
                </div>

                <div>
                    <h3 class="font-bold text-gray-500 mb-3 text-sm uppercase tracking-wider">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°</h3>
                    <div id="tx-list" class="space-y-3 pb-20"></div>
                </div>
            </section>

            <section id="p-deposit" class="hidden animate__animated animate__fadeIn">
                <h2 class="text-2xl font-bold text-white mb-6">‡πÅ‡∏à‡πâ‡∏á‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h2>
                
                <div class="mb-6">
                    <label class="text-xs text-gray-500 mb-2 block">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                    <select id="dep-promo" class="input-lux text-sm cursor-pointer text-gray-300" onchange="Wallet.calcBonus()">
                        <option value="">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥)</option>
                    </select>
                </div>

                <div class="glass-panel p-6 mb-6 text-center">
                    <p class="text-gray-400 text-sm mb-2">‡∏£‡∏∞‡∏ö‡∏∏‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô</p>
                    <input id="dep-amt" type="number" class="input-lux text-center text-3xl font-bold text-[#D4AF37] bg-transparent border-none focus:ring-0 p-0" placeholder="0.00" onkeyup="Wallet.calcBonus()">
                    <div id="bonus-info" class="mt-3 text-sm text-green-400 hidden bg-green-900/20 py-1 rounded border border-green-900">
                        +‡πÇ‡∏ö‡∏ô‡∏±‡∏™ <span id="bonus-val">0</span> (‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö <span id="total-get">0</span>)
                    </div>
                </div>

                <div class="bg-[#151515] p-4 rounded-xl border border-[#333] mb-6 flex items-center gap-4">
                    <div class="w-12 h-12 bg-green-600 rounded flex items-center justify-center text-2xl text-white font-bold">K</div>
                    <div class="flex-1">
                        <p class="font-bold text-white">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢</p>
                        <p class="text-lg text-[#D4AF37] font-mono tracking-wider">000-0-00000-0</p>
                        <p class="text-xs text-gray-500">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ: ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡πÇ‡∏ï‡πâ</p>
                    </div>
                </div>

                <div class="space-y-3">
                    <input id="dep-time" class="input-lux" placeholder="‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 12.30)">
                    <button onclick="Wallet.deposit()" class="btn-main">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ù‡∏≤‡∏Å</button>
                </div>
                <button onclick="UI.page('home')" class="w-full text-center text-gray-600 text-xs mt-6 hover:text-white">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            </section>

            <section id="p-withdraw" class="hidden animate__animated animate__fadeIn">
                <h2 class="text-2xl font-bold text-white mb-6">‡πÅ‡∏à‡πâ‡∏á‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h2>
                <div class="glass-panel p-6 mb-6">
                    <div class="flex justify-between text-xs text-gray-500 mb-4 border-b border-gray-800 pb-2">
                        <span>‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</span>
                        <span id="w-bank-info" class="text-white font-bold">...</span>
                    </div>
                    <label class="text-xs text-gray-400">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                    <input id="w-amt" type="number" class="input-lux mt-2 text-center text-3xl font-bold" placeholder="0.00">
                    <p class="text-[10px] text-gray-600 mt-4 text-center">* ‡∏ñ‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 100 ‡∏ö‡∏≤‡∏ó</p>
                </div>
                <button onclick="Wallet.withdraw()" class="btn-main">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô</button>
                <button onclick="UI.page('home')" class="w-full text-center text-gray-600 text-xs mt-6 hover:text-white">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            </section>

            <section id="p-profile" class="hidden animate__animated animate__fadeIn">
                <h2 class="text-2xl font-bold text-white mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
                <div class="glass-panel p-6 space-y-4">
                    <div><label class="text-xs text-gray-500">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input id="pf-name" class="input-lux mt-1"></div>
                    <div class="pt-4 border-t border-white/10">
                        <label class="text-xs text-[#D4AF37] font-bold">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô)</label>
                        <div class="grid grid-cols-3 gap-2 mt-2">
                            <select id="pf-bank" class="input-lux col-span-1 text-xs px-1"><option>KBANK</option><option>SCB</option><option>WALLET</option></select>
                            <input id="pf-acc" class="input-lux col-span-2" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">
                        </div>
                    </div>
                    <button onclick="User.save()" class="btn-main mt-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
                <button onclick="UI.page('home')" class="w-full text-center text-gray-600 text-xs mt-6 hover:text-white">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            </section>

        </main>

        <nav class="fixed bottom-0 left-0 w-full h-[70px] bg-[#0a0a0a] border-t border-[#222] flex justify-around items-center px-4 z-50 max-w-md mx-auto right-0">
            <button onclick="UI.page('home')" class="text-[#D4AF37] flex flex-col items-center gap-1"><i class="fa-solid fa-house text-xl"></i><span class="text-[9px]">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span></button>
            <button onclick="UI.page('deposit')" class="text-gray-500 hover:text-white flex flex-col items-center gap-1"><i class="fa-solid fa-wallet text-xl"></i><span class="text-[9px]">‡∏ù‡∏≤‡∏Å</span></button>
            <button onclick="UI.page('withdraw')" class="text-gray-500 hover:text-white flex flex-col items-center gap-1"><i class="fa-solid fa-money-bill-transfer text-xl"></i><span class="text-[9px]">‡∏ñ‡∏≠‡∏ô</span></button>
            <button onclick="UI.page('profile')" class="text-gray-500 hover:text-white flex flex-col items-center gap-1"><i class="fa-solid fa-user-gear text-xl"></i><span class="text-[9px]">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span></button>
        </nav>

    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyAochx_FIKbXLrbhhcLdVrpaurjjk4aQYc", authDomain: "paoshuv-c260d.firebaseapp.com", databaseURL: "https://paoshuv-c260d-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "paoshuv-c260d" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database(); const auth = firebase.auth();

        let user=null, userData={}, promos=[], siteConfig={};

        // AUTH & LOADING
        auth.onAuthStateChanged(u => {
            document.getElementById('loader').style.display='none';
            if(u) {
                user=u;
                document.getElementById('auth-view').style.display='none';
                document.getElementById('app-view').classList.remove('hidden');
                App.init();
            } else {
                document.getElementById('auth-view').style.display='flex';
                document.getElementById('app-view').classList.add('hidden');
            }
        });

        const Auth = {
            login: () => auth.signInWithEmailAndPassword(document.getElementById('l-email').value, document.getElementById('l-pass').value).catch(e=>Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',e.message,'error')),
            register: () => {
                const d = {e:document.getElementById('r-email').value, p:document.getElementById('r-pass').value, n:document.getElementById('r-name').value};
                auth.createUserWithEmailAndPassword(d.e,d.p).then(c=>{
                    db.ref('users/'+c.user.uid).set({
                        name:d.n, email:d.e, balance:0, bank:document.getElementById('r-bank').value, acc:document.getElementById('r-acc').value
                    });
                }).catch(e=>Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',e.message,'error'));
            },
            logout: () => auth.signOut()
        };

        const App = {
            init: () => {
                // Settings & Maintenance Logic (FIXED: Default OPEN)
                db.ref('settings').on('value', s => {
                    siteConfig = s.val() || {};
                    document.getElementById('site-ann').innerText = siteConfig.announcement || '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ 24 ‡∏ä‡∏°.';
                    document.getElementById('site-title-auth').innerText = siteConfig.siteName || 'ARENA';
                    
                    // Logic: ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô isMaintenance === true ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á/null ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏¥‡∏î)
                    if(siteConfig.isMaintenance === true) {
                        document.getElementById('maint-overlay').classList.remove('hidden');
                        document.getElementById('app-view').classList.add('blur-sm', 'pointer-events-none');
                    } else {
                        document.getElementById('maint-overlay').classList.add('hidden');
                        document.getElementById('app-view').classList.remove('blur-sm', 'pointer-events-none');
                    }
                });

                // User Data
                db.ref('users/'+user.uid).on('value', s => {
                    userData = s.val() || {};
                    document.getElementById('u-bal').innerText = `‡∏ø${(userData.balance||0).toLocaleString()}`;
                    document.getElementById('u-img').src = `https://ui-avatars.com/api/?name=${userData.name}&background=D4AF37&color=000`;
                    document.getElementById('w-bank-info').innerText = `${userData.bank} - ${userData.acc}`;
                    
                    document.getElementById('pf-name').value = userData.name;
                    document.getElementById('pf-bank').value = userData.bank;
                    document.getElementById('pf-acc').value = userData.acc;
                });

                // Promotions
                db.ref('promotions').on('value', s => {
                    const l = document.getElementById('promo-list'); l.innerHTML='';
                    const sel = document.getElementById('dep-promo'); 
                    sel.innerHTML='<option value="">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (‡∏¢‡∏≠‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥)</option>';
                    promos = [];
                    
                    if(!s.exists()) l.innerHTML = '<p class="text-center text-gray-600 text-xs">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</p>';
                    else s.forEach(d => {
                        const p = {id:d.key, ...d.val()};
                        promos.push(p);
                        sel.innerHTML += `<option value="${p.id}">üëâ ${p.title}</option>`;
                        l.innerHTML += `
                            <div class="glass-panel p-3 flex gap-3 items-center border border-[#333] hover:border-[#D4AF37] transition cursor-pointer" onclick="UI.page('deposit'); document.getElementById('dep-promo').value='${p.id}'; Wallet.calcBonus();">
                                <img src="${p.img}" class="w-14 h-14 rounded-lg object-cover bg-[#222]">
                                <div class="flex-1">
                                    <h4 class="font-bold text-[#D4AF37] text-sm">${p.title}</h4>
                                    <p class="text-xs text-gray-400">‡∏ù‡∏≤‡∏Å ${p.minDep} ‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° ${p.bonus}%</p>
                                </div>
                                <span class="text-xs bg-[#D4AF37] text-black px-3 py-1 rounded font-bold">‡∏£‡∏±‡∏ö</span>
                            </div>`;
                    });
                });

                // History
                db.ref('transactions').orderByChild('uid').equalTo(user.uid).limitToLast(15).on('value', s => {
                    const l = document.getElementById('tx-list'); l.innerHTML = '';
                    const arr = []; s.forEach(d => arr.unshift(d.val()));
                    
                    if(arr.length === 0) l.innerHTML = '<p class="text-center text-gray-600 text-xs py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>';
                    else arr.forEach(t => {
                        const color = t.status=='approved'?'text-green-500':(t.status=='rejected'?'text-red-500':'text-yellow-500');
                        let title = t.type.toUpperCase();
                        let icon = t.type=='deposit' ? 'fa-arrow-down' : (t.type=='withdraw'?'fa-arrow-up':'fa-sliders');
                        
                        if(t.type==='adjust') {
                            title = t.amount > 0 ? 'Admin ‡πÄ‡∏û‡∏¥‡πà‡∏°' : 'Admin ‡∏´‡∏±‡∏Å';
                            icon = 'fa-user-shield';
                        }

                        l.innerHTML += `
                            <div class="glass-panel p-3 flex justify-between items-center border border-white/5">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-[#222] flex items-center justify-center text-gray-400 text-xs">
                                        <i class="fa-solid ${icon}"></i>
                                    </div>
                                    <div>
                                        <div class="font-bold text-gray-300 text-sm">${title}</div>
                                        <div class="text-[10px] text-gray-600">${moment(t.timestamp).fromNow()} ${t.reason?'‚Ä¢ '+t.reason:''}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold ${t.amount>0 && t.type!=='withdraw'?'text-green-400':'text-red-400'}">${t.type==='withdraw' || t.amount<0 ? '-' : '+'}‡∏ø${Math.abs(t.amount)}</div>
                                    <div class="text-[9px] uppercase ${color} tracking-wider">${t.status}</div>
                                </div>
                            </div>`;
                    });
                });
            }
        };

        const Wallet = {
            calcBonus: () => {
                const amt = Number(document.getElementById('dep-amt').value);
                const pid = document.getElementById('dep-promo').value;
                const info = document.getElementById('bonus-info');
                
                if(pid && amt > 0) {
                    const p = promos.find(x => x.id === pid);
                    if(amt < p.minDep) { info.innerHTML='<span class="text-red-400 font-bold">‚ö†Ô∏è ‡∏¢‡∏≠‡∏î‡∏ù‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡πÇ‡∏õ‡∏£</span>'; info.classList.remove('hidden'); return; }
                    
                    const bonus = Math.floor(amt * (p.bonus/100));
                    info.innerHTML = `+‡πÇ‡∏ö‡∏ô‡∏±‡∏™ <span id="bonus-val">${bonus}</span> (‡∏£‡∏ß‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö <span id="total-get" class="font-bold text-white">${amt+bonus}</span>)`;
                    info.classList.remove('hidden');
                } else {
                    info.classList.add('hidden');
                }
            },
            deposit: () => {
                const amt = Number(document.getElementById('dep-amt').value);
                const time = document.getElementById('dep-time').value;
                const pid = document.getElementById('dep-promo').value;
                
                if(!amt || !time) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö','‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤','warning');
                
                let bonus = 0;
                let promoName = '';
                if(pid) {
                    const p = promos.find(x => x.id === pid);
                    if(amt >= p.minDep) {
                        bonus = Math.floor(amt * (p.bonus/100));
                        promoName = p.title;
                    }
                }

                db.ref('transactions').push({
                    uid: user.uid, name: userData.name, type: 'deposit', 
                    amount: amt, bonus: bonus, promo: promoName,
                    total: amt+bonus, time: time, status: 'pending', timestamp: Date.now()
                });
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÅ‡∏à‡πâ‡∏á‡∏ù‡∏≤‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö','success'); 
                UI.page('home');
                document.getElementById('dep-amt').value = '';
            },
            withdraw: () => {
                const amt = Number(document.getElementById('w-amt').value);
                if(amt > userData.balance || amt < 100) return Swal.fire('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô','‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 100','error');
                
                db.ref('transactions').push({
                    uid: user.uid, name: userData.name, type: 'withdraw', 
                    amount: amt, status: 'pending', timestamp: Date.now(),
                    bank_info: `${userData.bank} ${userData.acc}`
                });
                db.ref('users/'+user.uid).update({balance: userData.balance - amt});
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÅ‡∏à‡πâ‡∏á‡∏ñ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß','success'); UI.page('home');
                document.getElementById('w-amt').value = '';
            }
        };

        const User = {
            save: () => {
                db.ref('users/'+user.uid).update({
                    name: document.getElementById('pf-name').value,
                    bank: document.getElementById('pf-bank').value,
                    acc: document.getElementById('pf-acc').value
                }).then(()=>Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å','','success'));
            }
        };

        const UI = {
            toggleAuth: (m) => { document.getElementById('form-login').style.display=m=='log'?'block':'none'; document.getElementById('form-reg').style.display=m=='reg'?'block':'none'; },
            page: (p) => {
                ['home','deposit','withdraw','profile'].forEach(id => document.getElementById('p-'+id).classList.add('hidden'));
                document.getElementById('p-'+p).classList.remove('hidden');
                document.getElementById('p-'+p).classList.add('page-enter');
            },
            contact: () => window.open(siteConfig.contactLink || '#')
        };
    </script>
</body>
</html>
