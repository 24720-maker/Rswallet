<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RS INFINITY | MASTERPIECE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600&family=Rajdhani:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: '#D4AF37',
                        'gold-light': '#FDD043',
                        'gold-dark': '#8a6c1e',
                        dark: '#050505',
                        panel: '#0a0a0a',
                    },
                    fontFamily: {
                        sans: ['Kanit', 'sans-serif'],
                        tech: ['Rajdhani', 'sans-serif'],
                    },
                    animation: {
                        'spin-slow': 'spin 8s linear infinite',
                        'pulse-gold': 'pulseGold 2s infinite',
                        'scan': 'scanLine 2s linear infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        pulseGold: {
                            '0%, 100%': { boxShadow: '0 0 5px rgba(212, 175, 55, 0.2)' },
                            '50%': { boxShadow: '0 0 20px rgba(212, 175, 55, 0.6)' },
                        },
                        scanLine: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #000;
            background-image: 
                radial-gradient(circle at 50% 0%, #1a1a1a 0%, #000 70%);
            color: #e5e5e5;
            -webkit-tap-highlight-color: transparent;
        }

        /* Glassmorphism Classes */
        .glass {
            background: rgba(18, 18, 18, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .glass-gold {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(0,0,0,0));
            border: 1px solid rgba(212, 175, 55, 0.3);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .glass-card {
            background: linear-gradient(135deg, #111 0%, #050505 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.8);
        }

        /* Utilities */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .text-glow { text-shadow: 0 0 10px rgba(212, 175, 55, 0.6); }
        .btn-press:active { transform: scale(0.96); transition: 0.1s; }
        
        /* Custom Loading Animation */
        .loader-ring {
            border: 2px solid transparent;
            border-top: 2px solid #D4AF37;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Input Reset */
        input:focus { outline: none; border-color: #D4AF37; box-shadow: 0 0 15px rgba(212,175,55,0.1); }

        /* Hidden Classes for JS Toggling */
        .page-content { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .page-content.active { display: block; opacity: 1; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden text-sm">

    <div id="loading-screen" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center">
        <div class="relative w-32 h-32">
            <div class="absolute inset-0 rounded-full border-t-2 border-gold animate-spin"></div>
            <div class="absolute inset-2 rounded-full border-r-2 border-white/20 animate-spin-slow"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i class="fa-solid fa-fingerprint text-4xl text-gold animate-pulse"></i>
            </div>
        </div>
        <div class="mt-6 text-center">
            <h1 class="text-2xl font-bold font-tech tracking-[0.2em] text-white">RS INFINITY</h1>
            <p id="system-log" class="text-[10px] text-gold font-mono mt-2 h-4">System Initializing...</p>
        </div>
    </div>

    <header class="h-16 px-6 glass flex justify-between items-center z-20 shrink-0 border-b border-gray-800/50">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-gold to-yellow-800 flex items-center justify-center shadow-lg shadow-gold/20">
                <i class="fa-solid fa-layer-group text-black"></i>
            </div>
            <div>
                <div class="text-xs text-gold font-bold tracking-widest leading-none">AI SYSTEM</div>
                <div class="text-lg font-bold text-white font-tech leading-none tracking-wide">RS INFINITY</div>
            </div>
        </div>
        
        <div class="flex flex-col items-end">
            <div class="flex items-center gap-1.5">
                <div class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                <span class="text-[9px] font-bold text-green-400">SERVER ONLINE</span>
            </div>
            <span class="text-[9px] text-gray-500 font-mono">v4.2.0 (Stable)</span>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto no-scrollbar relative bg-[#050505]">
        
        <div id="page-home" class="page-content active p-5 pb-24 space-y-6">
            
            <div class="glass-card p-5 rounded-2xl relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 text-6xl group-hover:scale-110 transition duration-700">
                    <i class="fa-solid fa-chart-area"></i>
                </div>
                
                <div class="relative z-10">
                    <label class="text-[10px] text-gold uppercase tracking-widest font-bold mb-1">Current Asset</label>
                    <div onclick="openModal('search-modal')" class="flex items-center gap-3 cursor-pointer group-hover:translate-x-1 transition">
                        <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center text-xl text-white border border-gray-700" id="asset-icon-display">₿</div>
                        <div>
                            <div id="asset-name-display" class="text-2xl font-bold text-white font-tech leading-none">BTC/USDT</div>
                            <div class="text-[10px] text-gray-400">Click to change</div>
                        </div>
                        <i class="fa-solid fa-chevron-right text-gold text-xs ml-auto"></i>
                    </div>
                </div>
                
                <div class="mt-4 pt-3 border-t border-gray-800 flex gap-4 overflow-hidden">
                    <div class="flex gap-4 animate-[marquee_10s_linear_infinite] whitespace-nowrap">
                        <span class="text-[9px] text-green-500">BTC +2.4%</span>
                        <span class="text-[9px] text-red-500">ETH -0.8%</span>
                        <span class="text-[9px] text-green-500">XAU +0.15%</span>
                        <span class="text-[9px] text-green-500">EURUSD +0.02%</span>
                    </div>
                </div>
            </div>

            <div class="flex flex-col items-center justify-center py-6">
                <div class="relative w-64 h-64 flex items-center justify-center">
                    <div class="absolute w-full h-full rounded-full border border-gold/10 animate-[spin_10s_linear_infinite]"></div>
                    <div class="absolute w-[80%] h-[80%] rounded-full border border-dashed border-gold/30 animate-[spin_15s_linear_infinite_reverse]"></div>
                    <div class="absolute w-[90%] h-[90%] rounded-full border-t border-gold opacity-50 animate-spin"></div>
                    
                    <button onclick="openModal('config-modal')" class="relative z-10 w-48 h-48 rounded-full bg-gradient-to-b from-[#151515] to-black border border-gold/40 shadow-[0_0_50px_rgba(212,175,55,0.15)] flex flex-col items-center justify-center btn-press group overflow-hidden">
                        <div class="absolute inset-0 bg-gold/5 opacity-0 group-hover:opacity-100 transition duration-500"></div>
                        <i class="fa-solid fa-crosshairs text-5xl text-gray-500 group-hover:text-gold transition duration-500 mb-2 drop-shadow-[0_0_10px_rgba(212,175,55,0.5)]"></i>
                        <span class="text-2xl font-bold text-white tracking-widest font-tech group-hover:text-glow transition">SCAN</span>
                        <span class="text-[9px] text-gold uppercase mt-1 tracking-[0.2em]">AI Protocol</span>
                    </button>
                </div>
                <p class="text-gray-600 text-[10px] mt-[-20px] bg-[#050505] px-2 z-10">กดปุ่มเพื่อเริ่มวิเคราะห์กราฟ</p>
            </div>

            <div class="glass p-3 rounded-xl flex items-center gap-3">
                <div class="w-8 h-8 rounded bg-green-900/20 flex items-center justify-center text-green-500 animate-pulse">
                    <i class="fa-solid fa-wifi"></i>
                </div>
                <div class="flex-1 overflow-hidden">
                    <div class="text-[10px] text-gray-400 uppercase">Recent AI Activity</div>
                    <div class="text-xs text-white font-mono truncate">Signal #8842: XAUUSD Buy Profit hit TP1 just now...</div>
                </div>
            </div>
        </div>

        <div id="page-chart" class="page-content h-full flex flex-col bg-[#0a0a0a]">
            <div class="h-12 border-b border-gray-800 flex items-center justify-between px-4 bg-[#111]">
                <span class="text-xs font-bold text-gold font-tech" id="chart-title">BTC/USDT</span>
                <div class="flex gap-1">
                    <button onclick="changeChartTimeframe('1')" class="px-2 py-1 rounded text-[10px] bg-gray-800 text-gray-400 hover:text-white">1m</button>
                    <button onclick="changeChartTimeframe('5')" class="px-2 py-1 rounded text-[10px] bg-gold text-black font-bold">5m</button>
                    <button onclick="changeChartTimeframe('15')" class="px-2 py-1 rounded text-[10px] bg-gray-800 text-gray-400 hover:text-white">15m</button>
                </div>
            </div>
            <div class="flex-1 relative">
                <div id="tradingview_main" class="w-full h-full"></div>
            </div>
        </div>

        <div id="page-profile" class="page-content p-5 pb-24 space-y-6">
            
            <div class="w-full aspect-[1.58] rounded-2xl p-6 relative overflow-hidden flex flex-col justify-between shadow-2xl">
                <div class="absolute inset-0 bg-gradient-to-br from-[#2a2a2a] to-black"></div>
                <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-30"></div>
                <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-gold blur-[60px] opacity-20"></div>
                
                <div class="relative z-10 flex justify-between items-start">
                    <i class="fa-solid fa-infinity text-gold text-3xl"></i>
                    <div class="text-right">
                        <div class="text-[10px] text-gold/80 tracking-widest uppercase">Member Status</div>
                        <div class="text-lg font-bold text-white font-tech tracking-wide italic text-glow">VVIP DIRECTOR</div>
                    </div>
                </div>
                
                <div class="relative z-10">
                    <div class="text-xl font-mono text-white/90 tracking-widest shadow-black drop-shadow-md">0000 8842 1993 ADM</div>
                    <div class="flex justify-between items-end mt-4">
                        <div>
                            <div class="text-[9px] text-gray-400 uppercase">Card Holder</div>
                            <div class="text-sm font-bold text-white">ADMIN USER</div>
                        </div>
                        <div>
                            <div class="text-[9px] text-gray-400 uppercase">Expires</div>
                            <div class="text-sm font-bold text-white">30/12/2030</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="glass p-4 rounded-xl text-center">
                    <div class="text-[10px] text-gray-400 uppercase">Win Rate</div>
                    <div class="text-2xl font-tech font-bold text-green-500">92.4%</div>
                </div>
                <div class="glass p-4 rounded-xl text-center">
                    <div class="text-[10px] text-gray-400 uppercase">Total Profit</div>
                    <div class="text-2xl font-tech font-bold text-gold">$12,450</div>
                </div>
            </div>

            <div class="glass rounded-xl overflow-hidden">
                <div class="p-4 border-b border-gray-800 flex items-center justify-between cursor-pointer hover:bg-white/5">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-blue-900/20 flex items-center justify-center text-blue-500"><i class="fa-brands fa-line"></i></div>
                        <span class="text-sm text-white">ติดต่อซัพพอร์ต (LINE)</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-xs text-gray-600"></i>
                </div>
                <div class="p-4 border-b border-gray-800 flex items-center justify-between cursor-pointer hover:bg-white/5">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-purple-900/20 flex items-center justify-center text-purple-500"><i class="fa-solid fa-key"></i></div>
                        <span class="text-sm text-white">เปลี่ยนรหัสผ่าน</span>
                    </div>
                    <i class="fa-solid fa-chevron-right text-xs text-gray-600"></i>
                </div>
                <div onclick="logout()" class="p-4 flex items-center justify-between cursor-pointer hover:bg-red-900/10 transition">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-red-900/20 flex items-center justify-center text-red-500"><i class="fa-solid fa-power-off"></i></div>
                        <span class="text-sm text-red-500">ออกจากระบบ</span>
                    </div>
                </div>
            </div>
            
            <div class="text-center text-[10px] text-gray-600 mt-4">
                RS Infinity &copy; 2025 All Rights Reserved.
            </div>
        </div>

    </main>

    <nav class="h-20 bg-[#080808] border-t border-gray-800 flex justify-between items-center px-8 z-30 shrink-0">
        <button onclick="switchPage('home')" class="nav-btn flex flex-col items-center gap-1 text-gold transition" id="nav-home">
            <i class="fa-solid fa-house text-xl"></i>
            <span class="text-[10px] font-bold">Scanner</span>
        </button>
        <button onclick="switchPage('chart')" class="nav-btn flex flex-col items-center gap-1 text-gray-600 hover:text-white transition" id="nav-chart">
            <i class="fa-solid fa-chart-line text-xl"></i>
            <span class="text-[10px] font-bold">Live Chart</span>
        </button>
        <button onclick="switchPage('profile')" class="nav-btn flex flex-col items-center gap-1 text-gray-600 hover:text-white transition" id="nav-profile">
            <i class="fa-solid fa-user-astronaut text-xl"></i>
            <span class="text-[10px] font-bold">Profile</span>
        </button>
    </nav>

    <div id="search-modal" class="fixed inset-0 z-[60] bg-black/95 hidden flex flex-col">
        <div class="p-4 border-b border-gray-800 flex items-center gap-4 bg-[#0a0a0a]">
            <button onclick="closeModal('search-modal')" class="text-gray-400"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" placeholder="Search Asset (e.g. Gold)..." class="flex-1 bg-transparent text-white font-bold text-lg placeholder-gray-700">
        </div>
        <div class="p-4 grid grid-cols-1 gap-3 overflow-y-auto no-scrollbar">
            <div onclick="selectAsset('BTC/USDT', '₿')" class="glass p-4 rounded-xl flex items-center justify-between border hover:border-gold cursor-pointer">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-yellow-500/20 text-yellow-500 flex items-center justify-center"><i class="fa-brands fa-bitcoin"></i></div>
                    <div>
                        <div class="font-bold text-white">BTC/USDT</div>
                        <div class="text-[10px] text-gray-500">Bitcoin</div>
                    </div>
                </div>
                <div class="text-green-500 font-mono">+2.1%</div>
            </div>
            <div onclick="selectAsset('XAUUSD', '⚜')" class="glass p-4 rounded-xl flex items-center justify-between border hover:border-gold cursor-pointer">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-yellow-200/20 text-yellow-200 flex items-center justify-center"><i class="fa-solid fa-gem"></i></div>
                    <div>
                        <div class="font-bold text-white">XAUUSD</div>
                        <div class="text-[10px] text-gray-500">Gold Spot</div>
                    </div>
                </div>
                <div class="text-red-500 font-mono">-0.4%</div>
            </div>
             <div onclick="selectAsset('EURUSD', '€')" class="glass p-4 rounded-xl flex items-center justify-between border hover:border-gold cursor-pointer">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-blue-500/20 text-blue-500 flex items-center justify-center"><i class="fa-solid fa-euro-sign"></i></div>
                    <div>
                        <div class="font-bold text-white">EURUSD</div>
                        <div class="text-[10px] text-gray-500">Forex</div>
                    </div>
                </div>
                <div class="text-green-500 font-mono">+0.01%</div>
            </div>
        </div>
    </div>

    <div id="config-modal" class="fixed inset-0 z-[70] bg-black/90 backdrop-blur-sm hidden flex items-end sm:items-center justify-center">
        <div class="w-full sm:max-w-md bg-[#111] border-t border-gold/30 rounded-t-3xl sm:rounded-3xl p-6 pb-10 shadow-2xl animate-[fadeIn_0.3s]">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-xl font-bold text-white font-tech">SYSTEM CONFIG</h3>
                    <p class="text-[10px] text-gray-500">Setup Parameters</p>
                </div>
                <button onclick="closeModal('config-modal')" class="text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div class="space-y-5">
                <div class="bg-gray-900 p-4 rounded-xl border border-gray-800">
                    <label class="text-[10px] text-gold uppercase font-bold mb-2 block"><i class="fa-solid fa-wallet mr-1"></i> Capital ($)</label>
                    <input type="number" id="inp-capital" value="1000" class="w-full bg-transparent text-3xl font-tech font-bold text-white placeholder-gray-700" placeholder="0.00">
                </div>

                <div>
                    <label class="text-[10px] text-gray-500 uppercase mb-2 block">Timeframe</label>
                    <div class="flex gap-2">
                        <button onclick="selectTF('1m')" class="tf-btn flex-1 py-3 bg-gray-800 rounded-lg text-xs text-gray-400 font-bold border border-transparent">1M</button>
                        <button onclick="selectTF('5m')" class="tf-btn flex-1 py-3 bg-gold text-black rounded-lg text-xs font-bold border border-gold shadow-lg shadow-gold/20">5M</button>
                        <button onclick="selectTF('15m')" class="tf-btn flex-1 py-3 bg-gray-800 rounded-lg text-xs text-gray-400 font-bold border border-transparent">15M</button>
                    </div>
                </div>

                <button onclick="startScan()" class="w-full mt-4 bg-gradient-to-r from-gold-dark to-gold text-black font-bold font-tech text-lg py-4 rounded-xl shadow-[0_0_20px_rgba(212,175,55,0.3)] btn-press">
                    START AI ANALYSIS <i class="fa-solid fa-bolt ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="result-modal" class="fixed inset-0 z-[80] bg-[#050505] hidden flex flex-col h-full overflow-hidden">
        <div class="h-14 px-4 flex justify-between items-center border-b border-gray-800 bg-[#0a0a0a]">
            <div class="flex items-center gap-2">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                </span>
                <span class="text-xs font-bold text-red-500 tracking-widest">LIVE SIGNAL</span>
            </div>
            <button onclick="closeModal('result-modal')" class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center text-gray-400"><i class="fa-solid fa-xmark"></i></button>
        </div>

        <div class="flex-1 overflow-y-auto no-scrollbar pb-10">
            <div class="h-64 w-full bg-[#111] relative border-b border-gray-800">
                <div id="tradingview_result" class="w-full h-full"></div>
                <div class="absolute top-2 left-2 z-10 bg-black/80 backdrop-blur border border-gold/50 px-3 py-1 rounded-lg">
                    <div class="text-[9px] text-gray-400 uppercase">Signal Valid For</div>
                    <div id="countdown" class="text-lg font-tech font-bold text-gold">04:59</div>
                </div>
            </div>

            <div class="p-5 -mt-6 relative z-20">
                <div class="glass p-6 rounded-3xl border border-gray-700 shadow-2xl backdrop-blur-xl">
                    
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-3xl font-bold font-tech text-white" id="res-asset">BTC/USDT</div>
                        <div class="px-3 py-1 rounded bg-gray-800 border border-gray-700 text-xs text-white" id="res-tf">M5</div>
                    </div>

                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <div class="text-[10px] text-gray-400 uppercase tracking-widest">Action</div>
                            <div id="res-action" class="text-5xl font-black text-green-500 tracking-tighter drop-shadow-md">BUY</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[10px] text-gray-400 uppercase tracking-widest">Confidence</div>
                            <div class="text-3xl font-tech font-bold text-white">98%</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-2 mb-4">
                        <div class="bg-gray-900/80 p-2 rounded-lg border border-gray-700 text-center">
                            <div class="text-[9px] text-gray-500 uppercase">ENTRY</div>
                            <div id="res-entry" class="text-sm font-bold text-white font-tech">--</div>
                        </div>
                        <div class="bg-green-900/20 p-2 rounded-lg border border-green-500/30 text-center">
                            <div class="text-[9px] text-green-500 uppercase">TP</div>
                            <div id="res-tp" class="text-sm font-bold text-green-400 font-tech">--</div>
                        </div>
                        <div class="bg-red-900/20 p-2 rounded-lg border border-red-500/30 text-center">
                            <div class="text-[9px] text-red-500 uppercase">SL</div>
                            <div id="res-sl" class="text-sm font-bold text-red-400 font-tech">--</div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-gold/10 to-transparent border-l-4 border-gold p-3 rounded-r-lg mb-4">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gold font-bold uppercase"><i class="fa-solid fa-coins mr-1"></i> Lot Size</span>
                            <span id="res-lot" class="text-xl font-bold text-white font-tech">0.10</span>
                        </div>
                        <div class="text-[10px] text-gray-400">Calculated from balance: $<span id="res-balance">1000</span></div>
                    </div>

                    <div class="space-y-2">
                        <div class="text-[10px] text-gray-500 uppercase flex items-center gap-1"><i class="fa-solid fa-brain"></i> AI Reasoning</div>
                        <p id="res-reason" class="text-xs text-gray-300 font-light leading-relaxed">
                            ระบบตรวจพบสัญญาณ Bullish Divergence ที่ชัดเจนใน TF M5 พร้อมกับ Volume ซื้อที่พุ่งสูงขึ้นทะลุแนวต้าน 42,500 บ่งบอกถึงแรงส่งขาขึ้นที่แข็งแกร่ง
                        </p>
                    </div>

                </div>
            </div>
        </div>

        <div class="p-4 border-t border-gray-800 bg-black">
            <button onclick="closeModal('result-modal')" class="w-full bg-gray-800 hover:bg-gray-700 text-white py-4 rounded-xl font-bold transition">Close Signal</button>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentAsset = 'BTC/USDT';
        let currentSymbol = '₿';
        let currentTimeframe = '5m';
        let countdownInterval;

        // --- INITIALIZATION ---
        window.onload = () => {
            // Fake Loading Process
            const logs = [
                "Connecting to Neural Network...",
                "Loading Market Data...",
                "Syncing with Binance/Exness...",
                "System Ready."
            ];
            let i = 0;
            const logEl = document.getElementById('system-log');
            const interval = setInterval(() => {
                if(i < logs.length) { logEl.innerText = logs[i]; i++; }
            }, 800);

            setTimeout(() => {
                clearInterval(interval);
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    initMainChart(); // Load chart when ready
                }, 500);
            }, 3500);
        };

        // --- NAVIGATION ---
        function switchPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(p => {
                p.classList.remove('active');
                setTimeout(() => { if(!p.classList.contains('active')) p.style.display = 'none'; }, 300); // fade out effect
            });
            
            // Show target page
            const target = document.getElementById('page-' + pageId);
            target.style.display = 'block'; // set display first
            setTimeout(() => target.classList.add('active'), 10); // then fade in

            // Update Nav Icons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-gold');
                btn.classList.add('text-gray-600');
            });
            document.getElementById('nav-' + pageId).classList.add('text-gold');
            document.getElementById('nav-' + pageId).classList.remove('text-gray-600');

            // Specific Actions
            if(pageId === 'chart') {
                document.getElementById('chart-title').innerText = currentAsset;
                initMainChart();
            }
        }

        // --- MODALS ---
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        // --- ASSET SELECTION ---
        function selectAsset(pair, symbol) {
            currentAsset = pair;
            currentSymbol = symbol;
            
            // Update UI Home
            document.getElementById('asset-name-display').innerText = pair;
            document.getElementById('asset-icon-display').innerText = symbol;
            
            // Update Charts
            closeModal('search-modal');
        }

        function selectTF(tf) {
            currentTimeframe = tf;
            document.querySelectorAll('.tf-btn').forEach(b => {
                b.className = "tf-btn flex-1 py-3 bg-gray-800 rounded-lg text-xs text-gray-400 font-bold border border-transparent";
            });
            event.target.className = "tf-btn flex-1 py-3 bg-gold text-black rounded-lg text-xs font-bold border border-gold shadow-lg shadow-gold/20";
        }

        // --- AI LOGIC (SIMULATION) ---
        function startScan() {
            closeModal('config-modal');
            
            // Show Loading again briefly for effect
            const loader = document.getElementById('loading-screen');
            loader.style.display = 'flex';
            loader.style.opacity = '1';
            document.getElementById('system-log').innerText = "AI ANALYZING PATTERNS...";

            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => loader.style.display = 'none', 500);
                showResult();
            }, 2000);
        }

        function showResult() {
            // 1. Get Inputs
            const capital = parseFloat(document.getElementById('inp-capital').value) || 1000;
            const isBuy = Math.random() > 0.45; // Random Signal
            
            // 2. Generate Price Logic
            let price = currentAsset.includes('BTC') ? 43500 : (currentAsset.includes('XAU') ? 2030 : 1.0850);
            // Randomize slightly
            price = price + (Math.random() * (price * 0.001));
            
            let gapTP = currentAsset.includes('BTC') ? 200 : (currentAsset.includes('XAU') ? 3 : 0.0020);
            let gapSL = currentAsset.includes('BTC') ? 150 : (currentAsset.includes('XAU') ? 2 : 0.0015);
            
            let dir = isBuy ? 1 : -1;
            let entry = price;
            let tp = price + (gapTP * dir);
            let sl = price - (gapSL * dir);

            // 3. Money Management (Risk 1-2%)
            let riskAmount = capital * 0.02;
            // Lot = Risk / Distance (Simplified formula for demo)
            let lot = (riskAmount / 100).toFixed(2); 
            if(lot < 0.01) lot = 0.01;

            // 4. Render UI
            document.getElementById('res-asset').innerText = currentAsset;
            document.getElementById('res-tf').innerText = currentTimeframe.toUpperCase();
            document.getElementById('res-balance').innerText = capital;
            
            const actionEl = document.getElementById('res-action');
            actionEl.innerText = isBuy ? "BUY" : "SELL";
            actionEl.className = `text-5xl font-black tracking-tighter drop-shadow-md ${isBuy ? 'text-green-500' : 'text-red-500'}`;
            
            document.getElementById('res-entry').innerText = entry.toFixed(currentAsset.includes('USD') && !currentAsset.includes('XAU') && !currentAsset.includes('BTC') ? 4 : 2);
            document.getElementById('res-tp').innerText = tp.toFixed(4); // simplify decimal for demo
            document.getElementById('res-sl').innerText = sl.toFixed(4);
            document.getElementById('res-lot').innerText = lot;

            // Generate Reasoning
            const technicalTerms = ["EMA 200", "RSI Oversold", "Fibonacci 61.8%", "Supply Zone", "Demand Zone", "MACD Crossover"];
            const term = technicalTerms[Math.floor(Math.random() * technicalTerms.length)];
            const reason = `AI ตรวจพบโครงสร้างราคาแบบ ${isBuy ? 'Uptrend' : 'Downtrend'} ชัดเจน โดยมีการยืนยันจากสัญญาณ ${term} ใน Timeframe ${currentTimeframe} แนะนำให้เข้าออเดอร์ตามแผน`;
            document.getElementById('res-reason').innerText = reason;

            // 5. Chart & Timer
            openModal('result-modal');
            renderChart('tradingview_result', currentAsset, true);
            startCountdown();
        }

        function startCountdown() {
            clearInterval(countdownInterval);
            let duration = (parseInt(currentTimeframe) || 5) * 60;
            const el = document.getElementById('countdown');
            
            countdownInterval = setInterval(() => {
                let m = Math.floor(duration / 60);
                let s = duration % 60;
                el.innerText = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
                
                if(--duration < 0) {
                    clearInterval(countdownInterval);
                    el.innerText = "EXPIRED";
                    el.classList.add('text-red-500');
                }
            }, 1000);
        }

        // --- TRADINGVIEW INTEGRATION ---
        function initMainChart() {
            renderChart('tradingview_main', currentAsset, false);
        }

        function changeChartTimeframe(tf) {
            renderChart('tradingview_main', currentAsset, false, tf);
        }

        function renderChart(containerId, symbol, isMini, intervalOverride) {
            // Map symbol to TV format
            let tvSymbol = "BINANCE:" + symbol.replace('/', '');
            if(symbol.includes('XAU')) tvSymbol = "OANDA:XAUUSD";
            if(symbol.includes('EUR') || symbol.includes('GBP')) tvSymbol = "FX:" + symbol.replace('/', '');

            let interval = intervalOverride || currentTimeframe.replace('m','');

            new TradingView.widget({
                "width": "100%",
                "height": "100%",
                "symbol": tvSymbol,
                "interval": interval,
                "timezone": "Asia/Bangkok",
                "theme": "dark",
                "style": "1", // Candles
                "locale": "th_TH",
                "toolbar_bg": "#000",
                "enable_publishing": false,
                "hide_top_toolbar": isMini,
                "hide_legend": isMini,
                "save_image": false,
                "container_id": containerId,
                "backgroundColor": "rgba(0,0,0,1)",
                "allow_symbol_change": !isMini
            });
        }

        function logout() {
            if(confirm('ต้องการออกจากระบบ?')) {
                location.reload(); // Simple reload for demo
            }
        }
    </script>
</body>
</html>
