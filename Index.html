<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MY WALLET - Minimal Luxury</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root {
            --primary: #c5a059; /* Luxury Gold */
            --primary-dark: #8a6d3b;
            --bg-body: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #333333;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* --- Components --- */
        .card-shadow {
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.03);
        }

        .gold-gradient {
            background: linear-gradient(135deg, #c5a059 0%, #e6c88b 100%);
        }

        .text-gradient {
            background: linear-gradient(135deg, #c5a059 0%, #8a6d3b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .input-clean {
            background: #f3f4f6;
            border: 1px solid transparent;
            padding: 16px;
            border-radius: 16px;
            width: 100%;
            transition: 0.3s;
            outline: none;
            font-size: 1rem;
            color: #333;
        }
        .input-clean:focus {
            background: #fff;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(197, 160, 89, 0.1);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            font-weight: 600;
            padding: 14px;
            border-radius: 16px;
            width: 100%;
            transition: 0.3s;
            box-shadow: 0 5px 20px rgba(197, 160, 89, 0.3);
        }
        .btn-primary:active { transform: scale(0.98); }

        .nav-item {
            color: #9ca3af;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .nav-item.active { color: var(--primary); }
        .nav-item.active i { transform: translateY(-2px); }

        /* --- Animations --- */
        .fade-in-up { animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Loader */
        .loader-wrap { position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .circle-loader { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="pb-28">

    <div id="loader" class="loader-wrap">
        <div class="circle-loader"></div>
        <p class="mt-4 text-gray-400 text-xs tracking-widest animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <div id="auth-screen" class="fixed inset-0 z-50 bg-white flex flex-col justify-center px-8 hidden">
        <div class="text-center mb-10 animate__animated animate__fadeInDown">
            <div class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl">üíé</div>
            <h1 class="text-3xl font-bold text-gray-800">MEMBER LOGIN</h1>
            <p class="text-gray-400 text-sm mt-1">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô</p>
        </div>

        <div id="form-login" class="animate__animated animate__fadeInUp">
            <div class="space-y-4">
                <input id="l-email" class="input-clean" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• / ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
                <input id="l-pass" type="password" class="input-clean" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            </div>
            <button onclick="Auth.login()" class="btn-primary mt-6">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <p class="text-center mt-6 text-sm text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <span onclick="UI.toggleAuth('reg')" class="text-[#c5a059] font-bold cursor-pointer underline">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span></p>
        </div>

        <div id="form-reg" class="hidden animate__animated animate__fadeInUp">
            <div class="space-y-3">
                <input id="r-name" class="input-clean" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                <input id="r-email" class="input-clean" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
                <input id="r-pass" type="password" class="input-clean" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
                <input id="r-fb" class="input-clean" placeholder="‡∏•‡∏¥‡πâ‡∏á‡∏Å‡πå‡πÄ‡∏ü‡∏™‡∏ö‡∏∏‡πä‡∏Ñ (‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠)">
            </div>
            <button onclick="Auth.register()" class="btn-primary mt-6">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
            <p class="text-center mt-6 text-sm text-gray-500">‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <span onclick="UI.toggleAuth('log')" class="text-[#c5a059] font-bold cursor-pointer underline">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</span></p>
        </div>
    </div>

    <div id="app-view" class="hidden max-w-md mx-auto min-h-screen relative bg-white shadow-2xl">
        
        <header class="sticky top-0 z-40 bg-white/90 backdrop-blur-md border-b border-gray-100 px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gray-100 p-0.5 overflow-hidden border border-gray-200">
                    <img id="u-img" class="w-full h-full object-cover">
                </div>
                <div>
                    <p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Welcome</p>
                    <p id="u-name" class="text-sm font-bold text-gray-800 truncate w-24">Loading...</p>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="UI.contact()" class="w-9 h-9 rounded-full bg-gray-50 text-gray-600 hover:bg-[#c5a059] hover:text-white transition flex items-center justify-center"><i class="fa-solid fa-headset"></i></button>
                <button onclick="Auth.logout()" class="w-9 h-9 rounded-full bg-red-50 text-red-500 hover:bg-red-100 transition flex items-center justify-center"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </header>

        <main class="p-6 space-y-8">

            <section id="p-home" class="fade-in-up">
                <div class="gold-gradient rounded-3xl p-6 text-white shadow-xl shadow-yellow-500/20 relative overflow-hidden mb-6">
                    <div class="absolute -right-5 -top-5 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
                    <p class="text-white/80 text-xs font-medium mb-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                    <h2 id="u-bal" class="text-4xl font-bold mb-6">‡∏ø0.00</h2>
                    <div class="flex justify-between items-end border-t border-white/20 pt-4">
                        <div>
                            <p class="text-[10px] text-white/70 uppercase">Bank Account</p>
                            <p class="text-sm font-medium tracking-wide" id="u-bank-full">Connecting...</p>
                        </div>
                        <i class="fa-solid fa-wallet text-2xl text-white/50"></i>
                    </div>
                </div>

                <div id="turnover-box" class="hidden bg-gray-50 p-4 rounded-xl border border-gray-100 mb-6">
                    <div class="flex justify-between text-xs mb-2 font-bold text-gray-600">
                        <span class="flex items-center gap-1"><i class="fa-solid fa-lock text-yellow-500"></i> ‡∏ï‡∏¥‡∏î‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ñ‡∏≠‡∏ô</span>
                        <span id="turnover-val">0 / 0</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="turnover-fill" class="bg-yellow-500 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <p class="text-[10px] text-gray-400 mt-2 text-center">* ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏ñ‡∏≠‡∏ô‡πÑ‡∏î‡πâ</p>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-8">
                    <button onclick="UI.page('deposit')" class="bg-white border border-gray-100 p-4 rounded-2xl shadow-sm hover:shadow-md transition flex flex-col items-center gap-2 group">
                        <div class="w-12 h-12 bg-green-50 text-green-500 rounded-full flex items-center justify-center text-xl group-hover:scale-110 transition"><i class="fa-solid fa-arrow-down"></i></div>
                        <span class="text-sm font-bold text-gray-700">‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</span>
                    </button>
                    <button onclick="UI.page('withdraw')" class="bg-white border border-gray-100 p-4 rounded-2xl shadow-sm hover:shadow-md transition flex flex-col items-center gap-2 group">
                        <div class="w-12 h-12 bg-red-50 text-red-500 rounded-full flex items-center justify-center text-xl group-hover:scale-110 transition"><i class="fa-solid fa-arrow-up"></i></div>
                        <span class="text-sm font-bold text-gray-700">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
                    </button>
                </div>

                <div>
                    <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2 text-lg">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î <span class="text-[10px] bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full" id="tx-count">0</span></h3>
                    <div id="tx-list" class="space-y-3 pb-10"></div>
                </div>
            </section>

            <section id="p-promos" class="hidden fade-in-up">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</h2>
                <div id="promo-list" class="space-y-4 pb-20"></div>
            </section>

            <section id="p-deposit" class="hidden fade-in-up">
                <div class="flex items-center gap-3 mb-6">
                    <button onclick="UI.page('home')" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
                    <h2 class="text-xl font-bold text-gray-800">‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</h2>
                </div>

                <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 mb-6">
                    <p class="text-xs text-gray-400 mb-1">‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</p>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">K</div>
                        <div>
                            <p class="font-bold text-gray-800">000-000-0000</p>
                            <p class="text-xs text-gray-500">‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ (‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡πÇ‡∏ï‡πâ)</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500 ml-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
                        <select id="dep-promo" class="input-clean mt-1 bg-white border border-gray-200" onchange="Wallet.calcBonus()">
                            <option value="">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</option>
                        </select>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-gray-500 ml-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                        <input id="dep-amt" type="number" class="input-clean mt-1 bg-gray-50 text-center text-2xl font-bold text-[#c5a059]" placeholder="0.00" onkeyup="Wallet.calcBonus()">
                    </div>
                    
                    <div id="bonus-info" class="hidden bg-yellow-50 p-3 rounded-xl border border-yellow-100 text-center">
                        <p class="text-xs text-yellow-700">‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™ <span class="font-bold" id="bonus-val">0</span> ‡∏ö‡∏≤‡∏ó</p>
                        <p class="text-sm font-bold text-yellow-800">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ <span id="total-get">0</span></p>
                    </div>

                    <div>
                        <label class="text-xs font-bold text-gray-500 ml-1">‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏≠‡∏ô (‡∏ï‡∏≤‡∏°‡∏™‡∏•‡∏¥‡∏õ)</label>
                        <input id="dep-time" type="text" class="input-clean mt-1" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12.30">
                    </div>

                    <button onclick="Wallet.deposit()" class="btn-primary py-4 shadow-xl">‡πÅ‡∏à‡πâ‡∏á‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô</button>
                </div>
            </section>

            <section id="p-withdraw" class="hidden fade-in-up">
                <div class="flex items-center gap-3 mb-6">
                    <button onclick="UI.page('home')" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600"><i class="fa-solid fa-arrow-left"></i></button>
                    <h2 class="text-xl font-bold text-gray-800">‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h2>
                </div>

                <div class="bg-gray-900 text-white p-6 rounded-2xl shadow-lg mb-6">
                    <p class="text-xs text-gray-400 mb-1">‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                    <p id="w-bank-info" class="text-lg font-bold">Connecting...</p>
                    <div class="mt-4 pt-4 border-t border-gray-700">
                        <label class="text-xs text-gray-400">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</label>
                        <div class="flex items-center mt-2">
                            <span class="text-2xl mr-2">‡∏ø</span>
                            <input id="w-amt" type="number" class="bg-transparent text-3xl font-bold w-full outline-none placeholder-gray-600" placeholder="0">
                        </div>
                    </div>
                </div>

                <button onclick="Wallet.withdraw()" class="btn-primary py-4 shadow-xl">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡∏≠‡∏ô</button>
                <p class="text-center text-xs text-gray-400 mt-4">* ‡∏ñ‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 100 ‡∏ö‡∏≤‡∏ó</p>
            </section>

            <section id="p-profile" class="hidden fade-in-up">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                
                <div class="space-y-4">
                    <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-xs font-bold text-[#c5a059] uppercase mb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</p>
                        <div class="space-y-3">
                            <input id="pf-name" class="input-clean" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                            <input id="pf-fb" class="input-clean" placeholder="Facebook Link">
                        </div>
                    </div>

                    <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
                        <p class="text-xs font-bold text-[#c5a059] uppercase mb-3">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</p>
                        <div class="space-y-3">
                            <select id="pf-bank" class="input-clean bg-white">
                                <option value="KBANK">‡∏ò.‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢</option>
                                <option value="SCB">‡∏ò.‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå</option>
                                <option value="BBL">‡∏ò.‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û</option>
                                <option value="KTB">‡∏ò.‡∏Å‡∏£‡∏∏‡∏á‡πÑ‡∏ó‡∏¢</option>
                                <option value="WALLET">TrueMoney Wallet</option>
                            </select>
                            <input id="pf-acc" class="input-clean" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ">
                        </div>
                    </div>
                </div>
                
                <button onclick="User.save()" class="btn-primary mt-6">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </section>

        </main>

        <nav class="fixed bottom-0 left-0 w-full h-[80px] bg-white border-t border-gray-100 flex justify-around items-center px-6 z-50 max-w-md mx-auto right-0">
            <div onclick="UI.page('home')" class="nav-item active" id="nav-home">
                <i class="fa-solid fa-house text-xl"></i>
                <span class="text-[10px] font-bold">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
            </div>
            <div onclick="UI.page('promos')" class="nav-item" id="nav-promos">
                <i class="fa-solid fa-gift text-xl"></i>
                <span class="text-[10px] font-bold">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</span>
            </div>
            <div onclick="UI.page('profile')" class="nav-item" id="nav-profile">
                <i class="fa-solid fa-user-gear text-xl"></i>
                <span class="text-[10px] font-bold">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</span>
            </div>
        </nav>

    </div>

    <script>
        // CONFIG
        const firebaseConfig = { apiKey: "AIzaSyAochx_FIKbXLrbhhcLdVrpaurjjk4aQYc", authDomain: "paoshuv-c260d.firebaseapp.com", databaseURL: "https://paoshuv-c260d-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "paoshuv-c260d" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        let user = null, userData = {}, promos = [], config = {};

        // AUTH
        auth.onAuthStateChanged(u => {
            document.getElementById('loader').style.display='none';
            if(u) {
                user = u;
                document.getElementById('auth-screen').style.display='none';
                document.getElementById('app-view').classList.remove('hidden');
                App.init();
            } else {
                document.getElementById('auth-screen').style.display='flex';
                document.getElementById('app-view').classList.add('hidden');
            }
        });

        const Auth = {
            login: () => auth.signInWithEmailAndPassword(document.getElementById('l-email').value, document.getElementById('l-pass').value).catch(e=>Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',e.message,'error')),
            register: () => {
                const d = {e:document.getElementById('r-email').value, p:document.getElementById('r-pass').value, n:document.getElementById('r-name').value, fb:document.getElementById('r-fb').value};
                auth.createUserWithEmailAndPassword(d.e,d.p).then(c=>{
                    db.ref('users/'+c.user.uid).set({
                        name:d.n, email:d.e, fb_link:d.fb, balance:0, bank:'-', acc:'-', is_free_credit:false, turnover_target:0
                    });
                }).catch(e=>Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',e.message,'error'));
            },
            logout: () => auth.signOut()
        };

        const App = {
            init: () => {
                // User Data
                db.ref('users/'+user.uid).on('value', s => {
                    userData = s.val() || {};
                    document.getElementById('u-bal').innerText = `‡∏ø${(userData.balance||0).toLocaleString()}`;
                    document.getElementById('u-name').innerText = userData.name;
                    document.getElementById('u-img').src = `https://ui-avatars.com/api/?name=${userData.name}&background=c5a059&color=fff`;
                    document.getElementById('u-bank-full').innerText = `${userData.bank} ‚Ä¢ ${userData.acc}`;
                    document.getElementById('w-bank-info').innerText = `${userData.bank} - ${userData.acc}`;

                    // Forms
                    document.getElementById('pf-name').value = userData.name;
                    document.getElementById('pf-fb').value = userData.fb_link || '';
                    document.getElementById('pf-bank').value = userData.bank || 'KBANK';
                    document.getElementById('pf-acc').value = userData.acc || '';

                    // Turnover
                    const tb = document.getElementById('turnover-box');
                    if(userData.is_free_credit && userData.turnover_target > 0) {
                        tb.classList.remove('hidden');
                        const per = Math.min((userData.balance/userData.turnover_target)*100, 100);
                        document.getElementById('turnover-val').innerText = `${userData.balance.toLocaleString()} / ${userData.turnover_target.toLocaleString()}`;
                        document.getElementById('turnover-fill').style.width = per+'%';
                    } else {
                        tb.classList.add('hidden');
                    }
                });

                // Settings
                db.ref('settings').on('value', s => config = s.val() || {});

                // Promotions
                db.ref('promotions').on('value', s => {
                    const l = document.getElementById('promo-list'); l.innerHTML='';
                    const sel = document.getElementById('dep-promo'); sel.innerHTML='<option value="">‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</option>';
                    promos = [];
                    if(s.exists()) s.forEach(d => {
                        const p = {id:d.key, ...d.val()};
                        promos.push(p);
                        sel.innerHTML += `<option value="${p.id}">${p.title}</option>`;
                        l.innerHTML += `
                            <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex gap-4 items-center cursor-pointer transition hover:border-[#c5a059]" onclick="UI.page('deposit'); document.getElementById('dep-promo').value='${p.id}'; Wallet.calcBonus();">
                                <img src="${p.img}" class="w-16 h-16 rounded-xl object-cover bg-gray-200">
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-800 text-sm">${p.title}</h4>
                                    <p class="text-xs text-gray-500 mt-1">‡∏ù‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ ${p.minDep} ‡∏£‡∏±‡∏ö‡πÇ‡∏ö‡∏ô‡∏±‡∏™ ${p.bonus}%</p>
                                </div>
                                <button class="text-xs bg-[#c5a059] text-white px-3 py-1.5 rounded-lg font-bold">‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£</button>
                            </div>`;
                    });
                    else l.innerHTML = '<p class="text-center text-gray-400 mt-10">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</p>';
                });

                // History
                db.ref('transactions').orderByChild('uid').equalTo(user.uid).limitToLast(10).on('value', s => {
                    const l = document.getElementById('tx-list'); l.innerHTML='';
                    const arr = []; s.forEach(d => arr.unshift(d.val()));
                    document.getElementById('tx-count').innerText = arr.length;
                    
                    if(arr.length===0) l.innerHTML='<p class="text-center text-gray-300 py-6 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>';
                    else arr.forEach(t => {
                        let icon = t.type=='deposit'?'fa-arrow-down text-green-500 bg-green-50':'fa-arrow-up text-red-500 bg-red-50';
                        if(t.type=='adjust') icon = 'fa-sliders text-blue-500 bg-blue-50';
                        const st = t.status=='approved'?'text-green-500':(t.status=='pending'?'text-yellow-500':'text-red-500');
                        
                        l.innerHTML += `
                            <div class="bg-white p-3 rounded-xl border border-gray-100 flex justify-between items-center card-shadow">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm ${icon}"><i class="fa-solid ${t.type=='deposit'?'fa-plus':(t.type=='withdraw'?'fa-minus':'fa-cog')}"></i></div>
                                    <div>
                                        <p class="font-bold text-sm text-gray-700 capitalize">${t.type}</p>
                                        <p class="text-[10px] text-gray-400">${moment(t.timestamp).format('DD/MM HH:mm')} ${t.reason?'‚Ä¢ '+t.reason:''}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-gray-800">‡∏ø${t.amount.toLocaleString()}</p>
                                    <p class="text-[10px] font-bold uppercase ${st}">${t.status}</p>
                                </div>
                            </div>`;
                    });
                });
            }
        };

        const Wallet = {
            calcBonus: () => {
                const amt = Number(document.getElementById('dep-amt').value);
                const pid = document.getElementById('dep-promo').value;
                const info = document.getElementById('bonus-info');
                
                if(pid && amt > 0) {
                    const p = promos.find(x => x.id === pid);
                    if(amt < p.minDep) { info.classList.add('hidden'); return; }
                    const bonus = Math.floor(amt * (p.bonus/100));
                    document.getElementById('bonus-val').innerText = bonus;
                    document.getElementById('total-get').innerText = amt+bonus;
                    info.classList.remove('hidden');
                } else info.classList.add('hidden');
            },
            deposit: () => {
                const amt=document.getElementById('dep-amt').value, time=document.getElementById('dep-time').value, pid=document.getElementById('dep-promo').value;
                if(!amt||!time) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö','','warning');
                
                let bonus=0, pName='';
                if(pid) {
                    const p = promos.find(x=>x.id===pid);
                    if(Number(amt)>=p.minDep) { bonus=Math.floor(Number(amt)*(p.bonus/100)); pName=p.title; }
                }

                db.ref('transactions').push({uid:user.uid, name:userData.name, type:'deposit', amount:Number(amt), bonus:bonus, promo:pName, total:Number(amt)+bonus, time:time, status:'pending', timestamp:Date.now()});
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÅ‡∏à‡πâ‡∏á‡∏ù‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö','success'); UI.page('home');
            },
            withdraw: () => {
                if(userData.is_free_credit && userData.balance < userData.turnover_target) return Swal.fire('‡∏ñ‡∏≠‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ',`‡∏ï‡∏¥‡∏î‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô ${userData.turnover_target}`,'error');
                const amt = Number(document.getElementById('w-amt').value);
                if(amt > userData.balance || amt < 100) return Swal.fire('‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô','‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 100','error');
                
                db.ref('transactions').push({uid:user.uid, name:userData.name, type:'withdraw', amount:amt, status:'pending', timestamp:Date.now(), bank_info:`${userData.bank} ${userData.acc}`});
                db.ref('users/'+user.uid).update({balance: userData.balance-amt});
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÅ‡∏à‡πâ‡∏á‡∏ñ‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß','success'); UI.page('home');
            }
        };

        const User = {
            save: () => db.ref('users/'+user.uid).update({
                name:document.getElementById('pf-name').value, fb_link:document.getElementById('pf-fb').value,
                bank:document.getElementById('pf-bank').value, acc:document.getElementById('pf-acc').value
            }).then(()=>Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','','success'))
        };

        const UI = {
            toggleAuth: (m) => { document.getElementById('form-login').style.display=m=='log'?'block':'none'; document.getElementById('form-reg').style.display=m=='reg'?'block':'none'; },
            page: (p) => {
                ['home','promos','deposit','withdraw','profile'].forEach(id => {
                    document.getElementById('p-'+id).classList.add('hidden');
                    if(document.getElementById('nav-'+id)) document.getElementById('nav-'+id).classList.remove('active');
                });
                document.getElementById('p-'+p).classList.remove('hidden');
                document.getElementById('p-'+p).classList.add('fade-in-up');
                if(document.getElementById('nav-'+p)) document.getElementById('nav-'+p).classList.add('active');
            },
            contact: () => window.open(config.admin_contact || '#')
        };
    </script>
</body>
</html>
